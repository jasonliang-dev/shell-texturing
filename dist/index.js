(()=>{function Gn(u,f){return class extends u{constructor(...E){super(...E),f(this)}}}var En=Gn(Array,u=>u.fill(0)),_=1e-6;function Un(u){function f(t=0,c=0){let n=new u(2);return t!==void 0&&(n[0]=t,c!==void 0&&(n[1]=c)),n}let E=f;function U(t,c,n){let e=n??new u(2);return e[0]=t,e[1]=c,e}function B(t,c){let n=c??new u(2);return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n}function V(t,c){let n=c??new u(2);return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n}function tt(t,c){let n=c??new u(2);return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n}function J(t,c=0,n=1,e){let a=e??new u(2);return a[0]=Math.min(n,Math.max(c,t[0])),a[1]=Math.min(n,Math.max(c,t[1])),a}function K(t,c,n){let e=n??new u(2);return e[0]=t[0]+c[0],e[1]=t[1]+c[1],e}function rt(t,c,n,e){let a=e??new u(2);return a[0]=t[0]+c[0]*n,a[1]=t[1]+c[1]*n,a}function st(t,c){let n=t[0],e=t[1],a=c[0],M=c[1],y=Math.sqrt(n*n+e*e),s=Math.sqrt(a*a+M*M),i=y*s,d=i&&Tt(t,c)/i;return Math.acos(d)}function nt(t,c,n){let e=n??new u(2);return e[0]=t[0]-c[0],e[1]=t[1]-c[1],e}let Ut=nt;function it(t,c){return Math.abs(t[0]-c[0])<_&&Math.abs(t[1]-c[1])<_}function vt(t,c){return t[0]===c[0]&&t[1]===c[1]}function dt(t,c,n,e){let a=e??new u(2);return a[0]=t[0]+n*(c[0]-t[0]),a[1]=t[1]+n*(c[1]-t[1]),a}function pt(t,c,n,e){let a=e??new u(2);return a[0]=t[0]+n[0]*(c[0]-t[0]),a[1]=t[1]+n[1]*(c[1]-t[1]),a}function ut(t,c,n){let e=n??new u(2);return e[0]=Math.max(t[0],c[0]),e[1]=Math.max(t[1],c[1]),e}function ct(t,c,n){let e=n??new u(2);return e[0]=Math.min(t[0],c[0]),e[1]=Math.min(t[1],c[1]),e}function et(t,c,n){let e=n??new u(2);return e[0]=t[0]*c,e[1]=t[1]*c,e}let wt=et;function St(t,c,n){let e=n??new u(2);return e[0]=t[0]/c,e[1]=t[1]/c,e}function Bt(t,c){let n=c??new u(2);return n[0]=1/t[0],n[1]=1/t[1],n}let bt=Bt;function zt(t,c,n){let e=n??new u(3),a=t[0]*c[1]-t[1]*c[0];return e[0]=0,e[1]=0,e[2]=a,e}function Tt(t,c){return t[0]*c[0]+t[1]*c[1]}function lt(t){let c=t[0],n=t[1];return Math.sqrt(c*c+n*n)}let It=lt;function Y(t){let c=t[0],n=t[1];return c*c+n*n}let Q=Y;function $(t,c){let n=t[0]-c[0],e=t[1]-c[1];return Math.sqrt(n*n+e*e)}let h=$;function P(t,c){let n=t[0]-c[0],e=t[1]-c[1];return n*n+e*e}let g=P;function S(t,c){let n=c??new u(2),e=t[0],a=t[1],M=Math.sqrt(e*e+a*a);return M>1e-5?(n[0]=e/M,n[1]=a/M):(n[0]=0,n[1]=0),n}function q(t,c){let n=c??new u(2);return n[0]=-t[0],n[1]=-t[1],n}function z(t,c){let n=c??new u(2);return n[0]=t[0],n[1]=t[1],n}let O=z;function R(t,c,n){let e=n??new u(2);return e[0]=t[0]*c[0],e[1]=t[1]*c[1],e}let X=R;function b(t,c,n){let e=n??new u(2);return e[0]=t[0]/c[0],e[1]=t[1]/c[1],e}let I=b;function H(t=1,c){let n=c??new u(2),e=Math.random()*2*Math.PI;return n[0]=Math.cos(e)*t,n[1]=Math.sin(e)*t,n}function x(t){let c=t??new u(2);return c[0]=0,c[1]=0,c}function A(t,c,n){let e=n??new u(2),a=t[0],M=t[1];return e[0]=a*c[0]+M*c[4]+c[12],e[1]=a*c[1]+M*c[5]+c[13],e}function o(t,c,n){let e=n??new u(2),a=t[0],M=t[1];return e[0]=c[0]*a+c[4]*M+c[8],e[1]=c[1]*a+c[5]*M+c[9],e}function r(t,c,n,e){let a=e??new u(2),M=t[0]-c[0],y=t[1]-c[1],s=Math.sin(n),i=Math.cos(n);return a[0]=M*i-y*s+c[0],a[1]=M*s+y*i+c[1],a}function l(t,c,n){let e=n??new u(2);return S(t,e),et(e,c,e)}function w(t,c,n){let e=n??new u(2);return lt(t)>c?l(t,c,e):z(t,e)}function G(t,c,n){let e=n??new u(2);return dt(t,c,.5,e)}return{create:f,fromValues:E,set:U,ceil:B,floor:V,round:tt,clamp:J,add:K,addScaled:rt,angle:st,subtract:nt,sub:Ut,equalsApproximately:it,equals:vt,lerp:dt,lerpV:pt,max:ut,min:ct,mulScalar:et,scale:wt,divScalar:St,inverse:Bt,invert:bt,cross:zt,dot:Tt,length:lt,len:It,lengthSq:Y,lenSq:Q,distance:$,dist:h,distanceSq:P,distSq:g,normalize:S,negate:q,copy:z,clone:O,multiply:R,mul:X,divide:b,div:I,random:H,zero:x,transformMat4:A,transformMat3:o,rotate:r,setLength:l,truncate:w,midpoint:G}}var wn=new Map;function yn(u){let f=wn.get(u);return f||(f=Un(u),wn.set(u,f)),f}function Bn(u){let f=yn(u);function E(h,P,g,S,q,z,O,R,X){let b=new u(12);return b[3]=0,b[7]=0,b[11]=0,h!==void 0&&(b[0]=h,P!==void 0&&(b[1]=P,g!==void 0&&(b[2]=g,S!==void 0&&(b[4]=S,q!==void 0&&(b[5]=q,z!==void 0&&(b[6]=z,O!==void 0&&(b[8]=O,R!==void 0&&(b[9]=R,X!==void 0&&(b[10]=X))))))))),b}function U(h,P,g,S,q,z,O,R,X,b){let I=b??new u(12);return I[0]=h,I[1]=P,I[2]=g,I[3]=0,I[4]=S,I[5]=q,I[6]=z,I[7]=0,I[8]=O,I[9]=R,I[10]=X,I[11]=0,I}function B(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=0,g[4]=h[4],g[5]=h[5],g[6]=h[6],g[7]=0,g[8]=h[8],g[9]=h[9],g[10]=h[10],g[11]=0,g}function V(h,P){let g=P??new u(12),S=h[0],q=h[1],z=h[2],O=h[3],R=S+S,X=q+q,b=z+z,I=S*R,H=q*R,x=q*X,A=z*R,o=z*X,r=z*b,l=O*R,w=O*X,G=O*b;return g[0]=1-x-r,g[1]=H+G,g[2]=A-w,g[3]=0,g[4]=H-G,g[5]=1-I-r,g[6]=o+l,g[7]=0,g[8]=A+w,g[9]=o-l,g[10]=1-I-x,g[11]=0,g}function tt(h,P){let g=P??new u(12);return g[0]=-h[0],g[1]=-h[1],g[2]=-h[2],g[4]=-h[4],g[5]=-h[5],g[6]=-h[6],g[8]=-h[8],g[9]=-h[9],g[10]=-h[10],g}function J(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[4]=h[4],g[5]=h[5],g[6]=h[6],g[8]=h[8],g[9]=h[9],g[10]=h[10],g}let K=J;function rt(h,P){return Math.abs(h[0]-P[0])<_&&Math.abs(h[1]-P[1])<_&&Math.abs(h[2]-P[2])<_&&Math.abs(h[4]-P[4])<_&&Math.abs(h[5]-P[5])<_&&Math.abs(h[6]-P[6])<_&&Math.abs(h[8]-P[8])<_&&Math.abs(h[9]-P[9])<_&&Math.abs(h[10]-P[10])<_}function st(h,P){return h[0]===P[0]&&h[1]===P[1]&&h[2]===P[2]&&h[4]===P[4]&&h[5]===P[5]&&h[6]===P[6]&&h[8]===P[8]&&h[9]===P[9]&&h[10]===P[10]}function nt(h){let P=h??new u(12);return P[0]=1,P[1]=0,P[2]=0,P[4]=0,P[5]=1,P[6]=0,P[8]=0,P[9]=0,P[10]=1,P}function Ut(h,P){let g=P??new u(12);if(g===h){let x;return x=h[1],h[1]=h[4],h[4]=x,x=h[2],h[2]=h[8],h[8]=x,x=h[6],h[6]=h[9],h[9]=x,g}let S=h[0*4+0],q=h[0*4+1],z=h[0*4+2],O=h[1*4+0],R=h[1*4+1],X=h[1*4+2],b=h[2*4+0],I=h[2*4+1],H=h[2*4+2];return g[0]=S,g[1]=O,g[2]=b,g[4]=q,g[5]=R,g[6]=I,g[8]=z,g[9]=X,g[10]=H,g}function it(h,P){let g=P??new u(12),S=h[0*4+0],q=h[0*4+1],z=h[0*4+2],O=h[1*4+0],R=h[1*4+1],X=h[1*4+2],b=h[2*4+0],I=h[2*4+1],H=h[2*4+2],x=H*R-X*I,A=-H*O+X*b,o=I*O-R*b,r=1/(S*x+q*A+z*o);return g[0]=x*r,g[1]=(-H*q+z*I)*r,g[2]=(X*q-z*R)*r,g[4]=A*r,g[5]=(H*S-z*b)*r,g[6]=(-X*S+z*O)*r,g[8]=o*r,g[9]=(-I*S+q*b)*r,g[10]=(R*S-q*O)*r,g}function vt(h){let P=h[0],g=h[0*4+1],S=h[0*4+2],q=h[1*4+0],z=h[1*4+1],O=h[1*4+2],R=h[2*4+0],X=h[2*4+1],b=h[2*4+2];return P*(z*b-X*O)-q*(g*b-X*S)+R*(g*O-z*S)}let dt=it;function pt(h,P,g){let S=g??new u(12),q=h[0],z=h[1],O=h[2],R=h[4],X=h[5],b=h[6],I=h[8],H=h[9],x=h[10],A=P[0],o=P[1],r=P[2],l=P[4],w=P[5],G=P[6],t=P[8],c=P[9],n=P[10];return S[0]=q*A+R*o+I*r,S[1]=z*A+X*o+H*r,S[2]=O*A+b*o+x*r,S[4]=q*l+R*w+I*G,S[5]=z*l+X*w+H*G,S[6]=O*l+b*w+x*G,S[8]=q*t+R*c+I*n,S[9]=z*t+X*c+H*n,S[10]=O*t+b*c+x*n,S}let ut=pt;function ct(h,P,g){let S=g??nt();return h!==S&&(S[0]=h[0],S[1]=h[1],S[2]=h[2],S[4]=h[4],S[5]=h[5],S[6]=h[6]),S[8]=P[0],S[9]=P[1],S[10]=1,S}function et(h,P){let g=P??f.create();return g[0]=h[8],g[1]=h[9],g}function wt(h,P,g){let S=g??f.create(),q=P*4;return S[0]=h[q+0],S[1]=h[q+1],S}function St(h,P,g,S){let q=S===h?h:J(h,S),z=g*4;return q[z+0]=P[0],q[z+1]=P[1],q}function Bt(h,P){let g=P??f.create(),S=h[0],q=h[1],z=h[4],O=h[5];return g[0]=Math.sqrt(S*S+q*q),g[1]=Math.sqrt(z*z+O*O),g}function bt(h,P){let g=P??new u(12);return g[0]=1,g[1]=0,g[2]=0,g[4]=0,g[5]=1,g[6]=0,g[8]=h[0],g[9]=h[1],g[10]=1,g}function zt(h,P,g){let S=g??new u(12),q=P[0],z=P[1],O=h[0],R=h[1],X=h[2],b=h[1*4+0],I=h[1*4+1],H=h[1*4+2],x=h[2*4+0],A=h[2*4+1],o=h[2*4+2];return h!==S&&(S[0]=O,S[1]=R,S[2]=X,S[4]=b,S[5]=I,S[6]=H),S[8]=O*q+b*z+x,S[9]=R*q+I*z+A,S[10]=X*q+H*z+o,S}function Tt(h,P){let g=P??new u(12),S=Math.cos(h),q=Math.sin(h);return g[0]=S,g[1]=q,g[2]=0,g[4]=-q,g[5]=S,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function lt(h,P,g){let S=g??new u(12),q=h[0*4+0],z=h[0*4+1],O=h[0*4+2],R=h[1*4+0],X=h[1*4+1],b=h[1*4+2],I=Math.cos(P),H=Math.sin(P);return S[0]=I*q+H*R,S[1]=I*z+H*X,S[2]=I*O+H*b,S[4]=I*R-H*q,S[5]=I*X-H*z,S[6]=I*b-H*O,h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}function It(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=0,g[2]=0,g[4]=0,g[5]=h[1],g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function Y(h,P,g){let S=g??new u(12),q=P[0],z=P[1];return S[0]=q*h[0*4+0],S[1]=q*h[0*4+1],S[2]=q*h[0*4+2],S[4]=z*h[1*4+0],S[5]=z*h[1*4+1],S[6]=z*h[1*4+2],h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}function Q(h,P){let g=P??new u(12);return g[0]=h,g[1]=0,g[2]=0,g[4]=0,g[5]=h,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function $(h,P,g){let S=g??new u(12);return S[0]=P*h[0*4+0],S[1]=P*h[0*4+1],S[2]=P*h[0*4+2],S[4]=P*h[1*4+0],S[5]=P*h[1*4+1],S[6]=P*h[1*4+2],h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}return{clone:K,create:E,set:U,fromMat4:B,fromQuat:V,negate:tt,copy:J,equalsApproximately:rt,equals:st,identity:nt,transpose:Ut,inverse:it,invert:dt,determinant:vt,mul:ut,multiply:pt,setTranslation:ct,getTranslation:et,getAxis:wt,setAxis:St,getScaling:Bt,translation:bt,translate:zt,rotation:Tt,rotate:lt,scaling:It,scale:Y,uniformScaling:Q,uniformScale:$}}var Mn=new Map;function zn(u){let f=Mn.get(u);return f||(f=Bn(u),Mn.set(u,f)),f}function Tn(u){function f(s,i,d){let p=new u(3);return s!==void 0&&(p[0]=s,i!==void 0&&(p[1]=i,d!==void 0&&(p[2]=d))),p}let E=f;function U(s,i,d,p){let m=p??new u(3);return m[0]=s,m[1]=i,m[2]=d,m}function B(s,i){let d=i??new u(3);return d[0]=Math.ceil(s[0]),d[1]=Math.ceil(s[1]),d[2]=Math.ceil(s[2]),d}function V(s,i){let d=i??new u(3);return d[0]=Math.floor(s[0]),d[1]=Math.floor(s[1]),d[2]=Math.floor(s[2]),d}function tt(s,i){let d=i??new u(3);return d[0]=Math.round(s[0]),d[1]=Math.round(s[1]),d[2]=Math.round(s[2]),d}function J(s,i=0,d=1,p){let m=p??new u(3);return m[0]=Math.min(d,Math.max(i,s[0])),m[1]=Math.min(d,Math.max(i,s[1])),m[2]=Math.min(d,Math.max(i,s[2])),m}function K(s,i,d){let p=d??new u(3);return p[0]=s[0]+i[0],p[1]=s[1]+i[1],p[2]=s[2]+i[2],p}function rt(s,i,d,p){let m=p??new u(3);return m[0]=s[0]+i[0]*d,m[1]=s[1]+i[1]*d,m[2]=s[2]+i[2]*d,m}function st(s,i){let d=s[0],p=s[1],m=s[2],D=i[0],v=i[1],N=i[2],F=Math.sqrt(d*d+p*p+m*m),T=Math.sqrt(D*D+v*v+N*N),L=F*T,W=L&&Tt(s,i)/L;return Math.acos(W)}function nt(s,i,d){let p=d??new u(3);return p[0]=s[0]-i[0],p[1]=s[1]-i[1],p[2]=s[2]-i[2],p}let Ut=nt;function it(s,i){return Math.abs(s[0]-i[0])<_&&Math.abs(s[1]-i[1])<_&&Math.abs(s[2]-i[2])<_}function vt(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]}function dt(s,i,d,p){let m=p??new u(3);return m[0]=s[0]+d*(i[0]-s[0]),m[1]=s[1]+d*(i[1]-s[1]),m[2]=s[2]+d*(i[2]-s[2]),m}function pt(s,i,d,p){let m=p??new u(3);return m[0]=s[0]+d[0]*(i[0]-s[0]),m[1]=s[1]+d[1]*(i[1]-s[1]),m[2]=s[2]+d[2]*(i[2]-s[2]),m}function ut(s,i,d){let p=d??new u(3);return p[0]=Math.max(s[0],i[0]),p[1]=Math.max(s[1],i[1]),p[2]=Math.max(s[2],i[2]),p}function ct(s,i,d){let p=d??new u(3);return p[0]=Math.min(s[0],i[0]),p[1]=Math.min(s[1],i[1]),p[2]=Math.min(s[2],i[2]),p}function et(s,i,d){let p=d??new u(3);return p[0]=s[0]*i,p[1]=s[1]*i,p[2]=s[2]*i,p}let wt=et;function St(s,i,d){let p=d??new u(3);return p[0]=s[0]/i,p[1]=s[1]/i,p[2]=s[2]/i,p}function Bt(s,i){let d=i??new u(3);return d[0]=1/s[0],d[1]=1/s[1],d[2]=1/s[2],d}let bt=Bt;function zt(s,i,d){let p=d??new u(3),m=s[2]*i[0]-s[0]*i[2],D=s[0]*i[1]-s[1]*i[0];return p[0]=s[1]*i[2]-s[2]*i[1],p[1]=m,p[2]=D,p}function Tt(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]}function lt(s){let i=s[0],d=s[1],p=s[2];return Math.sqrt(i*i+d*d+p*p)}let It=lt;function Y(s){let i=s[0],d=s[1],p=s[2];return i*i+d*d+p*p}let Q=Y;function $(s,i){let d=s[0]-i[0],p=s[1]-i[1],m=s[2]-i[2];return Math.sqrt(d*d+p*p+m*m)}let h=$;function P(s,i){let d=s[0]-i[0],p=s[1]-i[1],m=s[2]-i[2];return d*d+p*p+m*m}let g=P;function S(s,i){let d=i??new u(3),p=s[0],m=s[1],D=s[2],v=Math.sqrt(p*p+m*m+D*D);return v>1e-5?(d[0]=p/v,d[1]=m/v,d[2]=D/v):(d[0]=0,d[1]=0,d[2]=0),d}function q(s,i){let d=i??new u(3);return d[0]=-s[0],d[1]=-s[1],d[2]=-s[2],d}function z(s,i){let d=i??new u(3);return d[0]=s[0],d[1]=s[1],d[2]=s[2],d}let O=z;function R(s,i,d){let p=d??new u(3);return p[0]=s[0]*i[0],p[1]=s[1]*i[1],p[2]=s[2]*i[2],p}let X=R;function b(s,i,d){let p=d??new u(3);return p[0]=s[0]/i[0],p[1]=s[1]/i[1],p[2]=s[2]/i[2],p}let I=b;function H(s=1,i){let d=i??new u(3),p=Math.random()*2*Math.PI,m=Math.random()*2-1,D=Math.sqrt(1-m*m)*s;return d[0]=Math.cos(p)*D,d[1]=Math.sin(p)*D,d[2]=m*s,d}function x(s){let i=s??new u(3);return i[0]=0,i[1]=0,i[2]=0,i}function A(s,i,d){let p=d??new u(3),m=s[0],D=s[1],v=s[2],N=i[3]*m+i[7]*D+i[11]*v+i[15]||1;return p[0]=(i[0]*m+i[4]*D+i[8]*v+i[12])/N,p[1]=(i[1]*m+i[5]*D+i[9]*v+i[13])/N,p[2]=(i[2]*m+i[6]*D+i[10]*v+i[14])/N,p}function o(s,i,d){let p=d??new u(3),m=s[0],D=s[1],v=s[2];return p[0]=m*i[0*4+0]+D*i[1*4+0]+v*i[2*4+0],p[1]=m*i[0*4+1]+D*i[1*4+1]+v*i[2*4+1],p[2]=m*i[0*4+2]+D*i[1*4+2]+v*i[2*4+2],p}function r(s,i,d){let p=d??new u(3),m=s[0],D=s[1],v=s[2];return p[0]=m*i[0]+D*i[4]+v*i[8],p[1]=m*i[1]+D*i[5]+v*i[9],p[2]=m*i[2]+D*i[6]+v*i[10],p}function l(s,i,d){let p=d??new u(3),m=i[0],D=i[1],v=i[2],N=i[3]*2,F=s[0],T=s[1],L=s[2],W=D*L-v*T,k=v*F-m*L,j=m*T-D*F;return p[0]=F+W*N+(D*j-v*k)*2,p[1]=T+k*N+(v*W-m*j)*2,p[2]=L+j*N+(m*k-D*W)*2,p}function w(s,i){let d=i??new u(3);return d[0]=s[12],d[1]=s[13],d[2]=s[14],d}function G(s,i,d){let p=d??new u(3),m=i*4;return p[0]=s[m+0],p[1]=s[m+1],p[2]=s[m+2],p}function t(s,i){let d=i??new u(3),p=s[0],m=s[1],D=s[2],v=s[4],N=s[5],F=s[6],T=s[8],L=s[9],W=s[10];return d[0]=Math.sqrt(p*p+m*m+D*D),d[1]=Math.sqrt(v*v+N*N+F*F),d[2]=Math.sqrt(T*T+L*L+W*W),d}function c(s,i,d,p){let m=p??new u(3),D=[],v=[];return D[0]=s[0]-i[0],D[1]=s[1]-i[1],D[2]=s[2]-i[2],v[0]=D[0],v[1]=D[1]*Math.cos(d)-D[2]*Math.sin(d),v[2]=D[1]*Math.sin(d)+D[2]*Math.cos(d),m[0]=v[0]+i[0],m[1]=v[1]+i[1],m[2]=v[2]+i[2],m}function n(s,i,d,p){let m=p??new u(3),D=[],v=[];return D[0]=s[0]-i[0],D[1]=s[1]-i[1],D[2]=s[2]-i[2],v[0]=D[2]*Math.sin(d)+D[0]*Math.cos(d),v[1]=D[1],v[2]=D[2]*Math.cos(d)-D[0]*Math.sin(d),m[0]=v[0]+i[0],m[1]=v[1]+i[1],m[2]=v[2]+i[2],m}function e(s,i,d,p){let m=p??new u(3),D=[],v=[];return D[0]=s[0]-i[0],D[1]=s[1]-i[1],D[2]=s[2]-i[2],v[0]=D[0]*Math.cos(d)-D[1]*Math.sin(d),v[1]=D[0]*Math.sin(d)+D[1]*Math.cos(d),v[2]=D[2],m[0]=v[0]+i[0],m[1]=v[1]+i[1],m[2]=v[2]+i[2],m}function a(s,i,d){let p=d??new u(3);return S(s,p),et(p,i,p)}function M(s,i,d){let p=d??new u(3);return lt(s)>i?a(s,i,p):z(s,p)}function y(s,i,d){let p=d??new u(3);return dt(s,i,.5,p)}return{create:f,fromValues:E,set:U,ceil:B,floor:V,round:tt,clamp:J,add:K,addScaled:rt,angle:st,subtract:nt,sub:Ut,equalsApproximately:it,equals:vt,lerp:dt,lerpV:pt,max:ut,min:ct,mulScalar:et,scale:wt,divScalar:St,inverse:Bt,invert:bt,cross:zt,dot:Tt,length:lt,len:It,lengthSq:Y,lenSq:Q,distance:$,dist:h,distanceSq:P,distSq:g,normalize:S,negate:q,copy:z,clone:O,multiply:R,mul:X,divide:b,div:I,random:H,zero:x,transformMat4:A,transformMat4Upper3x3:o,transformMat3:r,transformQuat:l,getTranslation:w,getAxis:G,getScaling:t,rotateX:c,rotateY:n,rotateZ:e,setLength:a,truncate:M,midpoint:y}}var xn=new Map;function Ct(u){let f=xn.get(u);return f||(f=Tn(u),xn.set(u,f)),f}function Ln(u){let f=Ct(u);function E(t,c,n,e,a,M,y,s,i,d,p,m,D,v,N,F){let T=new u(16);return t!==void 0&&(T[0]=t,c!==void 0&&(T[1]=c,n!==void 0&&(T[2]=n,e!==void 0&&(T[3]=e,a!==void 0&&(T[4]=a,M!==void 0&&(T[5]=M,y!==void 0&&(T[6]=y,s!==void 0&&(T[7]=s,i!==void 0&&(T[8]=i,d!==void 0&&(T[9]=d,p!==void 0&&(T[10]=p,m!==void 0&&(T[11]=m,D!==void 0&&(T[12]=D,v!==void 0&&(T[13]=v,N!==void 0&&(T[14]=N,F!==void 0&&(T[15]=F)))))))))))))))),T}function U(t,c,n,e,a,M,y,s,i,d,p,m,D,v,N,F,T){let L=T??new u(16);return L[0]=t,L[1]=c,L[2]=n,L[3]=e,L[4]=a,L[5]=M,L[6]=y,L[7]=s,L[8]=i,L[9]=d,L[10]=p,L[11]=m,L[12]=D,L[13]=v,L[14]=N,L[15]=F,L}function B(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=0,n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function V(t,c){let n=c??new u(16),e=t[0],a=t[1],M=t[2],y=t[3],s=e+e,i=a+a,d=M+M,p=e*s,m=a*s,D=a*i,v=M*s,N=M*i,F=M*d,T=y*s,L=y*i,W=y*d;return n[0]=1-D-F,n[1]=m+W,n[2]=v-L,n[3]=0,n[4]=m-W,n[5]=1-p-F,n[6]=N+T,n[7]=0,n[8]=v+L,n[9]=N-T,n[10]=1-p-D,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function tt(t,c){let n=c??new u(16);return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n[11]=-t[11],n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=-t[15],n}function J(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}let K=J;function rt(t,c){return Math.abs(t[0]-c[0])<_&&Math.abs(t[1]-c[1])<_&&Math.abs(t[2]-c[2])<_&&Math.abs(t[3]-c[3])<_&&Math.abs(t[4]-c[4])<_&&Math.abs(t[5]-c[5])<_&&Math.abs(t[6]-c[6])<_&&Math.abs(t[7]-c[7])<_&&Math.abs(t[8]-c[8])<_&&Math.abs(t[9]-c[9])<_&&Math.abs(t[10]-c[10])<_&&Math.abs(t[11]-c[11])<_&&Math.abs(t[12]-c[12])<_&&Math.abs(t[13]-c[13])<_&&Math.abs(t[14]-c[14])<_&&Math.abs(t[15]-c[15])<_}function st(t,c){return t[0]===c[0]&&t[1]===c[1]&&t[2]===c[2]&&t[3]===c[3]&&t[4]===c[4]&&t[5]===c[5]&&t[6]===c[6]&&t[7]===c[7]&&t[8]===c[8]&&t[9]===c[9]&&t[10]===c[10]&&t[11]===c[11]&&t[12]===c[12]&&t[13]===c[13]&&t[14]===c[14]&&t[15]===c[15]}function nt(t){let c=t??new u(16);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Ut(t,c){let n=c??new u(16);if(n===t){let k;return k=t[1],t[1]=t[4],t[4]=k,k=t[2],t[2]=t[8],t[8]=k,k=t[3],t[3]=t[12],t[12]=k,k=t[6],t[6]=t[9],t[9]=k,k=t[7],t[7]=t[13],t[13]=k,k=t[11],t[11]=t[14],t[14]=k,n}let e=t[0*4+0],a=t[0*4+1],M=t[0*4+2],y=t[0*4+3],s=t[1*4+0],i=t[1*4+1],d=t[1*4+2],p=t[1*4+3],m=t[2*4+0],D=t[2*4+1],v=t[2*4+2],N=t[2*4+3],F=t[3*4+0],T=t[3*4+1],L=t[3*4+2],W=t[3*4+3];return n[0]=e,n[1]=s,n[2]=m,n[3]=F,n[4]=a,n[5]=i,n[6]=D,n[7]=T,n[8]=M,n[9]=d,n[10]=v,n[11]=L,n[12]=y,n[13]=p,n[14]=N,n[15]=W,n}function it(t,c){let n=c??new u(16),e=t[0*4+0],a=t[0*4+1],M=t[0*4+2],y=t[0*4+3],s=t[1*4+0],i=t[1*4+1],d=t[1*4+2],p=t[1*4+3],m=t[2*4+0],D=t[2*4+1],v=t[2*4+2],N=t[2*4+3],F=t[3*4+0],T=t[3*4+1],L=t[3*4+2],W=t[3*4+3],k=v*W,j=L*N,at=d*W,ft=L*p,ht=d*N,Mt=v*p,xt=M*W,gt=L*y,mt=M*N,Dt=v*y,At=M*p,Pt=d*y,Gt=m*T,Et=F*D,Lt=s*T,qt=F*i,Nt=s*D,Wt=m*i,$t=e*T,Xt=F*a,kt=e*D,Yt=m*a,Ht=e*i,Zt=s*a,ln=k*i+ft*D+ht*T-(j*i+at*D+Mt*T),hn=j*a+xt*D+Dt*T-(k*a+gt*D+mt*T),dn=at*a+gt*i+At*T-(ft*a+xt*i+Pt*T),pn=Mt*a+mt*i+Pt*D-(ht*a+Dt*i+At*D),yt=1/(e*ln+s*hn+m*dn+F*pn);return n[0]=yt*ln,n[1]=yt*hn,n[2]=yt*dn,n[3]=yt*pn,n[4]=yt*(j*s+at*m+Mt*F-(k*s+ft*m+ht*F)),n[5]=yt*(k*e+gt*m+mt*F-(j*e+xt*m+Dt*F)),n[6]=yt*(ft*e+xt*s+Pt*F-(at*e+gt*s+At*F)),n[7]=yt*(ht*e+Dt*s+At*m-(Mt*e+mt*s+Pt*m)),n[8]=yt*(Gt*p+qt*N+Nt*W-(Et*p+Lt*N+Wt*W)),n[9]=yt*(Et*y+$t*N+Yt*W-(Gt*y+Xt*N+kt*W)),n[10]=yt*(Lt*y+Xt*p+Ht*W-(qt*y+$t*p+Zt*W)),n[11]=yt*(Wt*y+kt*p+Zt*N-(Nt*y+Yt*p+Ht*N)),n[12]=yt*(Lt*v+Wt*L+Et*d-(Nt*L+Gt*d+qt*v)),n[13]=yt*(kt*L+Gt*M+Xt*v-($t*v+Yt*L+Et*M)),n[14]=yt*($t*d+Zt*L+qt*M-(Ht*L+Lt*M+Xt*d)),n[15]=yt*(Ht*v+Nt*M+Yt*d-(kt*d+Zt*v+Wt*M)),n}function vt(t){let c=t[0],n=t[0*4+1],e=t[0*4+2],a=t[0*4+3],M=t[1*4+0],y=t[1*4+1],s=t[1*4+2],i=t[1*4+3],d=t[2*4+0],p=t[2*4+1],m=t[2*4+2],D=t[2*4+3],v=t[3*4+0],N=t[3*4+1],F=t[3*4+2],T=t[3*4+3],L=m*T,W=F*D,k=s*T,j=F*i,at=s*D,ft=m*i,ht=e*T,Mt=F*a,xt=e*D,gt=m*a,mt=e*i,Dt=s*a,At=L*y+j*p+at*N-(W*y+k*p+ft*N),Pt=W*n+ht*p+gt*N-(L*n+Mt*p+xt*N),Gt=k*n+Mt*y+mt*N-(j*n+ht*y+Dt*N),Et=ft*n+xt*y+Dt*p-(at*n+gt*y+mt*p);return c*At+M*Pt+d*Gt+v*Et}let dt=it;function pt(t,c,n){let e=n??new u(16),a=t[0],M=t[1],y=t[2],s=t[3],i=t[4],d=t[5],p=t[6],m=t[7],D=t[8],v=t[9],N=t[10],F=t[11],T=t[12],L=t[13],W=t[14],k=t[15],j=c[0],at=c[1],ft=c[2],ht=c[3],Mt=c[4],xt=c[5],gt=c[6],mt=c[7],Dt=c[8],At=c[9],Pt=c[10],Gt=c[11],Et=c[12],Lt=c[13],qt=c[14],Nt=c[15];return e[0]=a*j+i*at+D*ft+T*ht,e[1]=M*j+d*at+v*ft+L*ht,e[2]=y*j+p*at+N*ft+W*ht,e[3]=s*j+m*at+F*ft+k*ht,e[4]=a*Mt+i*xt+D*gt+T*mt,e[5]=M*Mt+d*xt+v*gt+L*mt,e[6]=y*Mt+p*xt+N*gt+W*mt,e[7]=s*Mt+m*xt+F*gt+k*mt,e[8]=a*Dt+i*At+D*Pt+T*Gt,e[9]=M*Dt+d*At+v*Pt+L*Gt,e[10]=y*Dt+p*At+N*Pt+W*Gt,e[11]=s*Dt+m*At+F*Pt+k*Gt,e[12]=a*Et+i*Lt+D*qt+T*Nt,e[13]=M*Et+d*Lt+v*qt+L*Nt,e[14]=y*Et+p*Lt+N*qt+W*Nt,e[15]=s*Et+m*Lt+F*qt+k*Nt,e}let ut=pt;function ct(t,c,n){let e=n??nt();return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]),e[12]=c[0],e[13]=c[1],e[14]=c[2],e[15]=1,e}function et(t,c){let n=c??f.create();return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function wt(t,c,n){let e=n??f.create(),a=c*4;return e[0]=t[a+0],e[1]=t[a+1],e[2]=t[a+2],e}function St(t,c,n,e){let a=e===t?e:J(t,e),M=n*4;return a[M+0]=c[0],a[M+1]=c[1],a[M+2]=c[2],a}function Bt(t,c){let n=c??f.create(),e=t[0],a=t[1],M=t[2],y=t[4],s=t[5],i=t[6],d=t[8],p=t[9],m=t[10];return n[0]=Math.sqrt(e*e+a*a+M*M),n[1]=Math.sqrt(y*y+s*s+i*i),n[2]=Math.sqrt(d*d+p*p+m*m),n}function bt(t,c,n,e,a){let M=a??new u(16),y=Math.tan(Math.PI*.5-.5*t);if(M[0]=y/c,M[1]=0,M[2]=0,M[3]=0,M[4]=0,M[5]=y,M[6]=0,M[7]=0,M[8]=0,M[9]=0,M[11]=-1,M[12]=0,M[13]=0,M[15]=0,Number.isFinite(e)){let s=1/(n-e);M[10]=e*s,M[14]=e*n*s}else M[10]=-1,M[14]=-n;return M}function zt(t,c,n,e=1/0,a){let M=a??new u(16),y=1/Math.tan(t*.5);if(M[0]=y/c,M[1]=0,M[2]=0,M[3]=0,M[4]=0,M[5]=y,M[6]=0,M[7]=0,M[8]=0,M[9]=0,M[11]=-1,M[12]=0,M[13]=0,M[15]=0,e===1/0)M[10]=0,M[14]=n;else{let s=1/(e-n);M[10]=n*s,M[14]=e*n*s}return M}function Tt(t,c,n,e,a,M,y){let s=y??new u(16);return s[0]=2/(c-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(e-n),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1/(a-M),s[11]=0,s[12]=(c+t)/(t-c),s[13]=(e+n)/(n-e),s[14]=a/(a-M),s[15]=1,s}function lt(t,c,n,e,a,M,y){let s=y??new u(16),i=c-t,d=e-n,p=a-M;return s[0]=2*a/i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*a/d,s[6]=0,s[7]=0,s[8]=(t+c)/i,s[9]=(e+n)/d,s[10]=M/p,s[11]=-1,s[12]=0,s[13]=0,s[14]=a*M/p,s[15]=0,s}function It(t,c,n,e,a,M=1/0,y){let s=y??new u(16),i=c-t,d=e-n;if(s[0]=2*a/i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*a/d,s[6]=0,s[7]=0,s[8]=(t+c)/i,s[9]=(e+n)/d,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,M===1/0)s[10]=0,s[14]=a;else{let p=1/(M-a);s[10]=a*p,s[14]=M*a*p}return s}let Y=f.create(),Q=f.create(),$=f.create();function h(t,c,n,e){let a=e??new u(16);return f.normalize(f.subtract(c,t,$),$),f.normalize(f.cross(n,$,Y),Y),f.normalize(f.cross($,Y,Q),Q),a[0]=Y[0],a[1]=Y[1],a[2]=Y[2],a[3]=0,a[4]=Q[0],a[5]=Q[1],a[6]=Q[2],a[7]=0,a[8]=$[0],a[9]=$[1],a[10]=$[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function P(t,c,n,e){let a=e??new u(16);return f.normalize(f.subtract(t,c,$),$),f.normalize(f.cross(n,$,Y),Y),f.normalize(f.cross($,Y,Q),Q),a[0]=Y[0],a[1]=Y[1],a[2]=Y[2],a[3]=0,a[4]=Q[0],a[5]=Q[1],a[6]=Q[2],a[7]=0,a[8]=$[0],a[9]=$[1],a[10]=$[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function g(t,c,n,e){let a=e??new u(16);return f.normalize(f.subtract(t,c,$),$),f.normalize(f.cross(n,$,Y),Y),f.normalize(f.cross($,Y,Q),Q),a[0]=Y[0],a[1]=Q[0],a[2]=$[0],a[3]=0,a[4]=Y[1],a[5]=Q[1],a[6]=$[1],a[7]=0,a[8]=Y[2],a[9]=Q[2],a[10]=$[2],a[11]=0,a[12]=-(Y[0]*t[0]+Y[1]*t[1]+Y[2]*t[2]),a[13]=-(Q[0]*t[0]+Q[1]*t[1]+Q[2]*t[2]),a[14]=-($[0]*t[0]+$[1]*t[1]+$[2]*t[2]),a[15]=1,a}function S(t,c){let n=c??new u(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function q(t,c,n){let e=n??new u(16),a=c[0],M=c[1],y=c[2],s=t[0],i=t[1],d=t[2],p=t[3],m=t[1*4+0],D=t[1*4+1],v=t[1*4+2],N=t[1*4+3],F=t[2*4+0],T=t[2*4+1],L=t[2*4+2],W=t[2*4+3],k=t[3*4+0],j=t[3*4+1],at=t[3*4+2],ft=t[3*4+3];return t!==e&&(e[0]=s,e[1]=i,e[2]=d,e[3]=p,e[4]=m,e[5]=D,e[6]=v,e[7]=N,e[8]=F,e[9]=T,e[10]=L,e[11]=W),e[12]=s*a+m*M+F*y+k,e[13]=i*a+D*M+T*y+j,e[14]=d*a+v*M+L*y+at,e[15]=p*a+N*M+W*y+ft,e}function z(t,c){let n=c??new u(16),e=Math.cos(t),a=Math.sin(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=a,n[7]=0,n[8]=0,n[9]=-a,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function O(t,c,n){let e=n??new u(16),a=t[4],M=t[5],y=t[6],s=t[7],i=t[8],d=t[9],p=t[10],m=t[11],D=Math.cos(c),v=Math.sin(c);return e[4]=D*a+v*i,e[5]=D*M+v*d,e[6]=D*y+v*p,e[7]=D*s+v*m,e[8]=D*i-v*a,e[9]=D*d-v*M,e[10]=D*p-v*y,e[11]=D*m-v*s,t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function R(t,c){let n=c??new u(16),e=Math.cos(t),a=Math.sin(t);return n[0]=e,n[1]=0,n[2]=-a,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=a,n[9]=0,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function X(t,c,n){let e=n??new u(16),a=t[0*4+0],M=t[0*4+1],y=t[0*4+2],s=t[0*4+3],i=t[2*4+0],d=t[2*4+1],p=t[2*4+2],m=t[2*4+3],D=Math.cos(c),v=Math.sin(c);return e[0]=D*a-v*i,e[1]=D*M-v*d,e[2]=D*y-v*p,e[3]=D*s-v*m,e[8]=D*i+v*a,e[9]=D*d+v*M,e[10]=D*p+v*y,e[11]=D*m+v*s,t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function b(t,c){let n=c??new u(16),e=Math.cos(t),a=Math.sin(t);return n[0]=e,n[1]=a,n[2]=0,n[3]=0,n[4]=-a,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function I(t,c,n){let e=n??new u(16),a=t[0*4+0],M=t[0*4+1],y=t[0*4+2],s=t[0*4+3],i=t[1*4+0],d=t[1*4+1],p=t[1*4+2],m=t[1*4+3],D=Math.cos(c),v=Math.sin(c);return e[0]=D*a+v*i,e[1]=D*M+v*d,e[2]=D*y+v*p,e[3]=D*s+v*m,e[4]=D*i-v*a,e[5]=D*d-v*M,e[6]=D*p-v*y,e[7]=D*m-v*s,t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function H(t,c,n){let e=n??new u(16),a=t[0],M=t[1],y=t[2],s=Math.sqrt(a*a+M*M+y*y);a/=s,M/=s,y/=s;let i=a*a,d=M*M,p=y*y,m=Math.cos(c),D=Math.sin(c),v=1-m;return e[0]=i+(1-i)*m,e[1]=a*M*v+y*D,e[2]=a*y*v-M*D,e[3]=0,e[4]=a*M*v-y*D,e[5]=d+(1-d)*m,e[6]=M*y*v+a*D,e[7]=0,e[8]=a*y*v+M*D,e[9]=M*y*v-a*D,e[10]=p+(1-p)*m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}let x=H;function A(t,c,n,e){let a=e??new u(16),M=c[0],y=c[1],s=c[2],i=Math.sqrt(M*M+y*y+s*s);M/=i,y/=i,s/=i;let d=M*M,p=y*y,m=s*s,D=Math.cos(n),v=Math.sin(n),N=1-D,F=d+(1-d)*D,T=M*y*N+s*v,L=M*s*N-y*v,W=M*y*N-s*v,k=p+(1-p)*D,j=y*s*N+M*v,at=M*s*N+y*v,ft=y*s*N-M*v,ht=m+(1-m)*D,Mt=t[0],xt=t[1],gt=t[2],mt=t[3],Dt=t[4],At=t[5],Pt=t[6],Gt=t[7],Et=t[8],Lt=t[9],qt=t[10],Nt=t[11];return a[0]=F*Mt+T*Dt+L*Et,a[1]=F*xt+T*At+L*Lt,a[2]=F*gt+T*Pt+L*qt,a[3]=F*mt+T*Gt+L*Nt,a[4]=W*Mt+k*Dt+j*Et,a[5]=W*xt+k*At+j*Lt,a[6]=W*gt+k*Pt+j*qt,a[7]=W*mt+k*Gt+j*Nt,a[8]=at*Mt+ft*Dt+ht*Et,a[9]=at*xt+ft*At+ht*Lt,a[10]=at*gt+ft*Pt+ht*qt,a[11]=at*mt+ft*Gt+ht*Nt,t!==a&&(a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a}let o=A;function r(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function l(t,c,n){let e=n??new u(16),a=c[0],M=c[1],y=c[2];return e[0]=a*t[0*4+0],e[1]=a*t[0*4+1],e[2]=a*t[0*4+2],e[3]=a*t[0*4+3],e[4]=M*t[1*4+0],e[5]=M*t[1*4+1],e[6]=M*t[1*4+2],e[7]=M*t[1*4+3],e[8]=y*t[2*4+0],e[9]=y*t[2*4+1],e[10]=y*t[2*4+2],e[11]=y*t[2*4+3],t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function w(t,c){let n=c??new u(16);return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function G(t,c,n){let e=n??new u(16);return e[0]=c*t[0*4+0],e[1]=c*t[0*4+1],e[2]=c*t[0*4+2],e[3]=c*t[0*4+3],e[4]=c*t[1*4+0],e[5]=c*t[1*4+1],e[6]=c*t[1*4+2],e[7]=c*t[1*4+3],e[8]=c*t[2*4+0],e[9]=c*t[2*4+1],e[10]=c*t[2*4+2],e[11]=c*t[2*4+3],t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}return{create:E,set:U,fromMat3:B,fromQuat:V,negate:tt,copy:J,clone:K,equalsApproximately:rt,equals:st,identity:nt,transpose:Ut,inverse:it,determinant:vt,invert:dt,multiply:pt,mul:ut,setTranslation:ct,getTranslation:et,getAxis:wt,setAxis:St,getScaling:Bt,perspective:bt,perspectiveReverseZ:zt,ortho:Tt,frustum:lt,frustumReverseZ:It,aim:h,cameraAim:P,lookAt:g,translation:S,translate:q,rotationX:z,rotateX:O,rotationY:R,rotateY:X,rotationZ:b,rotateZ:I,axisRotation:H,rotation:x,axisRotate:A,rotate:o,scaling:r,scale:l,uniformScaling:w,uniformScale:G}}var gn=new Map;function qn(u){let f=gn.get(u);return f||(f=Ln(u),gn.set(u,f)),f}function Nn(u){let f=Ct(u);function E(x,A,o,r){let l=new u(4);return x!==void 0&&(l[0]=x,A!==void 0&&(l[1]=A,o!==void 0&&(l[2]=o,r!==void 0&&(l[3]=r)))),l}let U=E;function B(x,A,o,r,l){let w=l??new u(4);return w[0]=x,w[1]=A,w[2]=o,w[3]=r,w}function V(x,A,o){let r=o??new u(4),l=A*.5,w=Math.sin(l);return r[0]=w*x[0],r[1]=w*x[1],r[2]=w*x[2],r[3]=Math.cos(l),r}function tt(x,A){let o=A??f.create(3),r=Math.acos(x[3])*2,l=Math.sin(r*.5);return l>_?(o[0]=x[0]/l,o[1]=x[1]/l,o[2]=x[2]/l):(o[0]=1,o[1]=0,o[2]=0),{angle:r,axis:o}}function J(x,A){let o=lt(x,A);return Math.acos(2*o*o-1)}function K(x,A,o){let r=o??new u(4),l=x[0],w=x[1],G=x[2],t=x[3],c=A[0],n=A[1],e=A[2],a=A[3];return r[0]=l*a+t*c+w*e-G*n,r[1]=w*a+t*n+G*c-l*e,r[2]=G*a+t*e+l*n-w*c,r[3]=t*a-l*c-w*n-G*e,r}let rt=K;function st(x,A,o){let r=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return r[0]=w*e+c*n,r[1]=G*e+t*n,r[2]=t*e-G*n,r[3]=c*e-w*n,r}function nt(x,A,o){let r=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return r[0]=w*e-t*n,r[1]=G*e+c*n,r[2]=t*e+w*n,r[3]=c*e-G*n,r}function Ut(x,A,o){let r=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return r[0]=w*e+G*n,r[1]=G*e-w*n,r[2]=t*e+c*n,r[3]=c*e-t*n,r}function it(x,A,o,r){let l=r??new u(4),w=x[0],G=x[1],t=x[2],c=x[3],n=A[0],e=A[1],a=A[2],M=A[3],y=w*n+G*e+t*a+c*M;y<0&&(y=-y,n=-n,e=-e,a=-a,M=-M);let s,i;if(1-y>_){let d=Math.acos(y),p=Math.sin(d);s=Math.sin((1-o)*d)/p,i=Math.sin(o*d)/p}else s=1-o,i=o;return l[0]=s*w+i*n,l[1]=s*G+i*e,l[2]=s*t+i*a,l[3]=s*c+i*M,l}function vt(x,A){let o=A??new u(4),r=x[0],l=x[1],w=x[2],G=x[3],t=r*r+l*l+w*w+G*G,c=t?1/t:0;return o[0]=-r*c,o[1]=-l*c,o[2]=-w*c,o[3]=G*c,o}function dt(x,A){let o=A??new u(4);return o[0]=-x[0],o[1]=-x[1],o[2]=-x[2],o[3]=x[3],o}function pt(x,A){let o=A??new u(4),r=x[0]+x[5]+x[10];if(r>0){let l=Math.sqrt(r+1);o[3]=.5*l;let w=.5/l;o[0]=(x[6]-x[9])*w,o[1]=(x[8]-x[2])*w,o[2]=(x[1]-x[4])*w}else{let l=0;x[5]>x[0]&&(l=1),x[10]>x[l*4+l]&&(l=2);let w=(l+1)%3,G=(l+2)%3,t=Math.sqrt(x[l*4+l]-x[w*4+w]-x[G*4+G]+1);o[l]=.5*t;let c=.5/t;o[3]=(x[w*4+G]-x[G*4+w])*c,o[w]=(x[w*4+l]+x[l*4+w])*c,o[G]=(x[G*4+l]+x[l*4+G])*c}return o}function ut(x,A,o,r,l){let w=l??new u(4),G=x*.5,t=A*.5,c=o*.5,n=Math.sin(G),e=Math.cos(G),a=Math.sin(t),M=Math.cos(t),y=Math.sin(c),s=Math.cos(c);switch(r){case"xyz":w[0]=n*M*s+e*a*y,w[1]=e*a*s-n*M*y,w[2]=e*M*y+n*a*s,w[3]=e*M*s-n*a*y;break;case"xzy":w[0]=n*M*s-e*a*y,w[1]=e*a*s-n*M*y,w[2]=e*M*y+n*a*s,w[3]=e*M*s+n*a*y;break;case"yxz":w[0]=n*M*s+e*a*y,w[1]=e*a*s-n*M*y,w[2]=e*M*y-n*a*s,w[3]=e*M*s+n*a*y;break;case"yzx":w[0]=n*M*s+e*a*y,w[1]=e*a*s+n*M*y,w[2]=e*M*y-n*a*s,w[3]=e*M*s-n*a*y;break;case"zxy":w[0]=n*M*s-e*a*y,w[1]=e*a*s+n*M*y,w[2]=e*M*y+n*a*s,w[3]=e*M*s-n*a*y;break;case"zyx":w[0]=n*M*s-e*a*y,w[1]=e*a*s+n*M*y,w[2]=e*M*y-n*a*s,w[3]=e*M*s+n*a*y;break;default:throw new Error(`Unknown rotation order: ${r}`)}return w}function ct(x,A){let o=A??new u(4);return o[0]=x[0],o[1]=x[1],o[2]=x[2],o[3]=x[3],o}let et=ct;function wt(x,A,o){let r=o??new u(4);return r[0]=x[0]+A[0],r[1]=x[1]+A[1],r[2]=x[2]+A[2],r[3]=x[3]+A[3],r}function St(x,A,o){let r=o??new u(4);return r[0]=x[0]-A[0],r[1]=x[1]-A[1],r[2]=x[2]-A[2],r[3]=x[3]-A[3],r}let Bt=St;function bt(x,A,o){let r=o??new u(4);return r[0]=x[0]*A,r[1]=x[1]*A,r[2]=x[2]*A,r[3]=x[3]*A,r}let zt=bt;function Tt(x,A,o){let r=o??new u(4);return r[0]=x[0]/A,r[1]=x[1]/A,r[2]=x[2]/A,r[3]=x[3]/A,r}function lt(x,A){return x[0]*A[0]+x[1]*A[1]+x[2]*A[2]+x[3]*A[3]}function It(x,A,o,r){let l=r??new u(4);return l[0]=x[0]+o*(A[0]-x[0]),l[1]=x[1]+o*(A[1]-x[1]),l[2]=x[2]+o*(A[2]-x[2]),l[3]=x[3]+o*(A[3]-x[3]),l}function Y(x){let A=x[0],o=x[1],r=x[2],l=x[3];return Math.sqrt(A*A+o*o+r*r+l*l)}let Q=Y;function $(x){let A=x[0],o=x[1],r=x[2],l=x[3];return A*A+o*o+r*r+l*l}let h=$;function P(x,A){let o=A??new u(4),r=x[0],l=x[1],w=x[2],G=x[3],t=Math.sqrt(r*r+l*l+w*w+G*G);return t>1e-5?(o[0]=r/t,o[1]=l/t,o[2]=w/t,o[3]=G/t):(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function g(x,A){return Math.abs(x[0]-A[0])<_&&Math.abs(x[1]-A[1])<_&&Math.abs(x[2]-A[2])<_&&Math.abs(x[3]-A[3])<_}function S(x,A){return x[0]===A[0]&&x[1]===A[1]&&x[2]===A[2]&&x[3]===A[3]}function q(x){let A=x??new u(4);return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A}let z=f.create(),O=f.create(),R=f.create();function X(x,A,o){let r=o??new u(4),l=f.dot(x,A);return l<-.999999?(f.cross(O,x,z),f.len(z)<1e-6&&f.cross(R,x,z),f.normalize(z,z),V(z,Math.PI,r),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(f.cross(x,A,z),r[0]=z[0],r[1]=z[1],r[2]=z[2],r[3]=1+l,P(r,r))}let b=new u(4),I=new u(4);function H(x,A,o,r,l,w){let G=w??new u(4);return it(x,r,l,b),it(A,o,l,I),it(b,I,2*l*(1-l),G),G}return{create:E,fromValues:U,set:B,fromAxisAngle:V,toAxisAngle:tt,angle:J,multiply:K,mul:rt,rotateX:st,rotateY:nt,rotateZ:Ut,slerp:it,inverse:vt,conjugate:dt,fromMat:pt,fromEuler:ut,copy:ct,clone:et,add:wt,subtract:St,sub:Bt,mulScalar:bt,scale:zt,divScalar:Tt,dot:lt,lerp:It,length:Y,len:Q,lengthSq:$,lenSq:h,normalize:P,equalsApproximately:g,equals:S,identity:q,rotationTo:X,sqlerp:H}}var mn=new Map;function bn(u){let f=mn.get(u);return f||(f=Nn(u),mn.set(u,f)),f}function In(u){function f(o,r,l,w){let G=new u(4);return o!==void 0&&(G[0]=o,r!==void 0&&(G[1]=r,l!==void 0&&(G[2]=l,w!==void 0&&(G[3]=w)))),G}let E=f;function U(o,r,l,w,G){let t=G??new u(4);return t[0]=o,t[1]=r,t[2]=l,t[3]=w,t}function B(o,r){let l=r??new u(4);return l[0]=Math.ceil(o[0]),l[1]=Math.ceil(o[1]),l[2]=Math.ceil(o[2]),l[3]=Math.ceil(o[3]),l}function V(o,r){let l=r??new u(4);return l[0]=Math.floor(o[0]),l[1]=Math.floor(o[1]),l[2]=Math.floor(o[2]),l[3]=Math.floor(o[3]),l}function tt(o,r){let l=r??new u(4);return l[0]=Math.round(o[0]),l[1]=Math.round(o[1]),l[2]=Math.round(o[2]),l[3]=Math.round(o[3]),l}function J(o,r=0,l=1,w){let G=w??new u(4);return G[0]=Math.min(l,Math.max(r,o[0])),G[1]=Math.min(l,Math.max(r,o[1])),G[2]=Math.min(l,Math.max(r,o[2])),G[3]=Math.min(l,Math.max(r,o[3])),G}function K(o,r,l){let w=l??new u(4);return w[0]=o[0]+r[0],w[1]=o[1]+r[1],w[2]=o[2]+r[2],w[3]=o[3]+r[3],w}function rt(o,r,l,w){let G=w??new u(4);return G[0]=o[0]+r[0]*l,G[1]=o[1]+r[1]*l,G[2]=o[2]+r[2]*l,G[3]=o[3]+r[3]*l,G}function st(o,r,l){let w=l??new u(4);return w[0]=o[0]-r[0],w[1]=o[1]-r[1],w[2]=o[2]-r[2],w[3]=o[3]-r[3],w}let nt=st;function Ut(o,r){return Math.abs(o[0]-r[0])<_&&Math.abs(o[1]-r[1])<_&&Math.abs(o[2]-r[2])<_&&Math.abs(o[3]-r[3])<_}function it(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]}function vt(o,r,l,w){let G=w??new u(4);return G[0]=o[0]+l*(r[0]-o[0]),G[1]=o[1]+l*(r[1]-o[1]),G[2]=o[2]+l*(r[2]-o[2]),G[3]=o[3]+l*(r[3]-o[3]),G}function dt(o,r,l,w){let G=w??new u(4);return G[0]=o[0]+l[0]*(r[0]-o[0]),G[1]=o[1]+l[1]*(r[1]-o[1]),G[2]=o[2]+l[2]*(r[2]-o[2]),G[3]=o[3]+l[3]*(r[3]-o[3]),G}function pt(o,r,l){let w=l??new u(4);return w[0]=Math.max(o[0],r[0]),w[1]=Math.max(o[1],r[1]),w[2]=Math.max(o[2],r[2]),w[3]=Math.max(o[3],r[3]),w}function ut(o,r,l){let w=l??new u(4);return w[0]=Math.min(o[0],r[0]),w[1]=Math.min(o[1],r[1]),w[2]=Math.min(o[2],r[2]),w[3]=Math.min(o[3],r[3]),w}function ct(o,r,l){let w=l??new u(4);return w[0]=o[0]*r,w[1]=o[1]*r,w[2]=o[2]*r,w[3]=o[3]*r,w}let et=ct;function wt(o,r,l){let w=l??new u(4);return w[0]=o[0]/r,w[1]=o[1]/r,w[2]=o[2]/r,w[3]=o[3]/r,w}function St(o,r){let l=r??new u(4);return l[0]=1/o[0],l[1]=1/o[1],l[2]=1/o[2],l[3]=1/o[3],l}let Bt=St;function bt(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]+o[3]*r[3]}function zt(o){let r=o[0],l=o[1],w=o[2],G=o[3];return Math.sqrt(r*r+l*l+w*w+G*G)}let Tt=zt;function lt(o){let r=o[0],l=o[1],w=o[2],G=o[3];return r*r+l*l+w*w+G*G}let It=lt;function Y(o,r){let l=o[0]-r[0],w=o[1]-r[1],G=o[2]-r[2],t=o[3]-r[3];return Math.sqrt(l*l+w*w+G*G+t*t)}let Q=Y;function $(o,r){let l=o[0]-r[0],w=o[1]-r[1],G=o[2]-r[2],t=o[3]-r[3];return l*l+w*w+G*G+t*t}let h=$;function P(o,r){let l=r??new u(4),w=o[0],G=o[1],t=o[2],c=o[3],n=Math.sqrt(w*w+G*G+t*t+c*c);return n>1e-5?(l[0]=w/n,l[1]=G/n,l[2]=t/n,l[3]=c/n):(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function g(o,r){let l=r??new u(4);return l[0]=-o[0],l[1]=-o[1],l[2]=-o[2],l[3]=-o[3],l}function S(o,r){let l=r??new u(4);return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l}let q=S;function z(o,r,l){let w=l??new u(4);return w[0]=o[0]*r[0],w[1]=o[1]*r[1],w[2]=o[2]*r[2],w[3]=o[3]*r[3],w}let O=z;function R(o,r,l){let w=l??new u(4);return w[0]=o[0]/r[0],w[1]=o[1]/r[1],w[2]=o[2]/r[2],w[3]=o[3]/r[3],w}let X=R;function b(o){let r=o??new u(4);return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r}function I(o,r,l){let w=l??new u(4),G=o[0],t=o[1],c=o[2],n=o[3];return w[0]=r[0]*G+r[4]*t+r[8]*c+r[12]*n,w[1]=r[1]*G+r[5]*t+r[9]*c+r[13]*n,w[2]=r[2]*G+r[6]*t+r[10]*c+r[14]*n,w[3]=r[3]*G+r[7]*t+r[11]*c+r[15]*n,w}function H(o,r,l){let w=l??new u(4);return P(o,w),ct(w,r,w)}function x(o,r,l){let w=l??new u(4);return zt(o)>r?H(o,r,w):S(o,w)}function A(o,r,l){let w=l??new u(4);return vt(o,r,.5,w)}return{create:f,fromValues:E,set:U,ceil:B,floor:V,round:tt,clamp:J,add:K,addScaled:rt,subtract:st,sub:nt,equalsApproximately:Ut,equals:it,lerp:vt,lerpV:dt,max:pt,min:ut,mulScalar:ct,scale:et,divScalar:wt,inverse:St,invert:Bt,dot:bt,length:zt,len:Tt,lengthSq:lt,lenSq:It,distance:Y,dist:Q,distanceSq:$,distSq:h,normalize:P,negate:g,copy:S,clone:q,multiply:z,mul:O,divide:R,div:X,zero:b,transformMat4:I,setLength:H,truncate:x,midpoint:A}}var Dn=new Map;function Vn(u){let f=Dn.get(u);return f||(f=In(u),Dn.set(u,f)),f}function tn(u,f,E,U,B,V){return{mat4:qn(u),mat3:zn(f),quat:bn(E),vec2:yn(U),vec3:Ct(B),vec4:Vn(V)}}var{mat4:Qt,mat3:Xn,quat:kn,vec2:vn,vec3:ot,vec4:Yn}=tn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array),{mat4:Hn,mat3:Zn,quat:Qn,vec2:Jn,vec3:Kn,vec4:jn}=tn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),{mat4:Cn,mat3:te,quat:ne,vec2:ee,vec3:se,vec4:ce}=tn(En,Array,Array,Array,Array,Array);function Sn(u){return u===" "||u==="\r"}var Rt=class u{file="";contents="";end=0;line=1;static async load(f){let E=new u;E.file=f,E.contents=await fetch(f).then(B=>B.text());let U={vertices:[],normals:[],texcoords:[],faces:[]};for(;!E.atEnd();)E.scanNext(U);return U}atEnd(){return this.end===this.contents.length}next(){this.atEnd()||this.end++}peek(){return this.contents[this.end]}expect(f){if(this.atEnd())throw`expected '${f}' on line ${this.line}`;let E=this.contents[this.end];if(E!==f)throw`expected '${f}' on line ${this.line} got '${E}'`;this.next()}skipWhitespace(){for(;!this.atEnd()&&Sn(this.peek());)this.next()}seekToEndOfLine(){for(;!this.atEnd()&&this.peek()!==`
`;)this.next();this.next(),this.line++}scanToken(){let f=this.end;for(;!this.atEnd();){let E=this.peek();if(Sn(E)||E===`
`)break;this.next()}return this.contents.substring(f,this.end)}scanNumber(){this.skipWhitespace();let f=this.end;for(;!this.atEnd();){let U=this.peek();if(!(U==="-"||U==="."||U>="0"&&U<="9"||U==="E"||U==="e"))break;this.next()}let E=this.contents.substring(f,this.end);return Number.parseFloat(E)}scanVertex(f){f.vertices.push(this.scanNumber()),f.vertices.push(this.scanNumber()),f.vertices.push(this.scanNumber())}scanVertexNormal(f){f.normals.push(this.scanNumber()),f.normals.push(this.scanNumber()),f.normals.push(this.scanNumber())}scanVertexTexture(f){f.texcoords.push(this.scanNumber()),f.texcoords.push(this.scanNumber())}scanTriple(f){f.faces.push(this.scanNumber()),this.expect("/"),f.faces.push(this.scanNumber()),this.expect("/"),f.faces.push(this.scanNumber())}scanFace(f){if(this.scanTriple(f),this.scanTriple(f),this.scanTriple(f),this.peek()==="\r"&&this.next(),this.peek()!==`
`){let E=f.faces.length-9;f.faces.push(f.faces[E+0]),f.faces.push(f.faces[E+1]),f.faces.push(f.faces[E+2]),f.faces.push(f.faces[E+6]),f.faces.push(f.faces[E+7]),f.faces.push(f.faces[E+8]),this.scanTriple(f)}}scanNext(f){if(this.atEnd())return;this.skipWhitespace();let E=this.scanToken();if(this.next(),E===""){this.line++;return}switch(E){case"#":break;case"v":this.scanVertex(f);break;case"vn":this.scanVertexNormal(f);break;case"vt":this.scanVertexTexture(f);break;case"f":this.scanFace(f);break;case"g":break;case"o":break;case"s":break;case"usemtl":break;case"mtllib":break;default:throw E.length===1?`unknown token '${E}' (${E.charCodeAt(0)}) on line ${this.line} in ${this.file}`:`unknown token '${E}' on line ${this.line} in ${this.file}`}this.seekToEndOfLine()}};var An=`struct VertexOut {
  @builtin(position) position: vec4f,
  @location(0) m: vec2f,
  @location(1) nw: vec2f,
  @location(2) ne: vec2f,
  @location(3) sw: vec2f,
  @location(4) se: vec2f,
}

@group(0) @binding(0) var<uniform> u: Uniforms;
@group(0) @binding(1) var surface: texture_2d<f32>;
@group(0) @binding(2) var surfaceSampler: sampler;

@vertex fn vp(@builtin(vertex_index) i: u32) -> VertexOut {
  var out: VertexOut;

  let uv = vec2f(vec2(i & 2, (i << 1) & 2));
  out.position = vec4f(uv * vec2f(2, -2) + vec2f(-1, 1), 0, 1);

  let texel = uv * u.screenResolution;
  out.nw = (texel + vec2f(-1, -1)) / u.screenResolution;
  out.ne = (texel + vec2f(1, -1)) / u.screenResolution;
  out.sw = (texel + vec2f(-1, 1)) / u.screenResolution;
  out.se = (texel + vec2f(1, 1)) / u.screenResolution;
  out.m = uv;

  return out;
}

@fragment fn fp(in: VertexOut) -> @location(0) vec4f {
  let FXAA_REDUCE_MIN = 1.0 / 128.0;
  let FXAA_REDUCE_MUL = 1.0 / 8.0;
  let FXAA_SPAN_MAX = 8.0;

  let luma = vec3f(0.299, 0.587, 0.114);

  let lumaNW = dot(textureSample(surface, surfaceSampler, in.nw).xyz, luma);
  let lumaNE = dot(textureSample(surface, surfaceSampler, in.ne).xyz, luma);
  let lumaSW = dot(textureSample(surface, surfaceSampler, in.sw).xyz, luma);
  let lumaSE = dot(textureSample(surface, surfaceSampler, in.se).xyz, luma);
  let lumaM = dot(textureSample(surface, surfaceSampler, in.m).xyz, luma);

  var dir: vec2f;
  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
  dir.y = (lumaNW + lumaSW) - (lumaNE + lumaSE);

  let reduce = max(FXAA_REDUCE_MIN, (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL));

  var rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + reduce);
  dir = max(vec2f(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin);
  dir = min(vec2f(FXAA_SPAN_MAX, FXAA_SPAN_MAX), dir);
  dir /= u.screenResolution;

  let lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
  let lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

  var rgbA = textureSample(surface, surfaceSampler, in.m + dir * (1.0 / 3.0 - 0.5)).xyz;
  rgbA += textureSample(surface, surfaceSampler, in.m + dir * (2.0 / 3.0 - 0.5)).xyz;
  rgbA *= 0.5;

  var rgbB = textureSample(surface, surfaceSampler, in.m + dir * -0.5).xyz;
  rgbB += textureSample(surface, surfaceSampler, in.m + dir * 0.5).xyz;
  rgbB = rgbA * 0.5 + 0.25 * rgbB;

  var lumaB = dot(rgbB, luma);
  if (lumaB < lumaMin || lumaB > lumaMax) {
    return vec4f(rgbA, 1.0);
  } else {
    return vec4f(rgbB, 1.0);
  }
}
`;var Pn=`override SHELL_COUNT: f32 = 128.0;

struct VertexIn {
  @builtin(instance_index) instance: u32,
  @location(0) position: vec3f,
  @location(1) normal: vec3f,
  @location(2) texcoord: vec2f,
}

struct VertexOut {
  @builtin(position) position: vec4f,
  @location(0) normal: vec3f,
  @location(1) texcoord: vec2f,
  @location(2) @interpolate(flat) instance: u32,
}

@group(0) @binding(0) var<uniform> u: Uniforms;

fn random(uv: vec2f) -> f32 {
  return fract(sin(dot(uv.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

fn steepCos(angle: f32, slope: f32) -> f32 {
  return atan(slope * cos(angle)) / atan(slope);
}

@vertex fn vp(in: VertexIn) -> VertexOut {
  var out: VertexOut;

  let scale = 1.0 + f32(in.instance) * 0.001;
  let height = f32(in.instance) / SHELL_COUNT;
  let position = in.position * scale + vec3f(0.0, -height * 0.02, 0.0);

  out.position = u.cameraProjection * u.cameraView * vec4f(position, 1.0);
  out.normal = in.normal;
  out.texcoord = in.texcoord;
  out.instance = in.instance;
  return out;
}

@fragment fn fp(in: VertexOut) -> @location(0) vec4f {
  let uv = in.texcoord * 256.0;

  let height = f32(in.instance) / SHELL_COUNT;

  let cell = floor(uv);
  let local = (uv - cell) * 2.0 - 1.0;
  if ((random(cell) - height) * 4.0 < length(local)) {
    discard;
  }

  let light = normalize(vec3f(1.0, 1.0, 0.0));

  let ambient = 0.4;
  let diffuse = dot(light, in.normal) * 0.5 + 0.5;
  let lighting = vec3f((ambient + diffuse) * height);

  let yellow = steepCos(in.texcoord.y * 14.0, 2.0) * 0.5 + 0.5;
  let color = mix(vec3f(0.25, 0.15, 0.0), vec3f(1.0, 0.8, 0.1), yellow);

  return vec4f(color * lighting, 1.0);
}
`;var Kt=Math.PI/180,Rn=2,Ft=4,_n=4*Ft,nn=16*Ft,C,_t,Jt,Ot,fn,jt,Vt={},Z={x:0,y:0,prevX:0,prevY:0,deltaX:0,deltaY:0,button0:!1,button1:!1,button2:!1,wheel:0};addEventListener("keydown",u=>{Vt[u.code]=!0});addEventListener("keyup",u=>{Vt[u.code]=!1});addEventListener("mousedown",u=>{u.button===0?Z.button0=!0:u.button===1?Z.button1=!0:u.button===2&&(Z.button2=!0)});addEventListener("mouseup",u=>{u.button===0?Z.button0=!1:u.button===1?Z.button1=!1:u.button===2&&(Z.button2=!1)});addEventListener("wheel",u=>{Z.wheel=u.deltaY});addEventListener("mousemove",u=>{Z.x=u.clientX,Z.y=u.clientY});function Wn(u,f,E){return u<f?f:u>E?E:u}var en=class{yaw;pitch=0;front=ot.create();right=ot.create();up=ot.create();positionA;positionB;constructor(f,E){this.positionA=ot.clone(f),this.positionB=ot.clone(f),this.yaw=E}update(){Z.button0&&(this.yaw+=Z.deltaX*.005,this.pitch-=Z.deltaY*.005,this.pitch=Wn(this.pitch,-85*Kt,85*Kt)),this.front[0]=Math.cos(this.yaw)*Math.cos(this.pitch),this.front[1]=Math.sin(this.pitch),this.front[2]=Math.sin(this.yaw)*Math.cos(this.pitch),ot.normalize(this.front,this.front),ot.normalize(ot.cross(this.front,ot.create(0,1,0)),this.right),ot.normalize(ot.cross(this.right,this.front),this.up);let f=0,E=0,U=0,B;Vt.ShiftLeft?B=.1:B=.03,Vt.KeyW&&(f-=B),Vt.KeyS&&(f+=B),Vt.KeyA&&(E+=B),Vt.KeyD&&(E-=B),Vt.KeyQ&&(U+=B),(Vt.KeyE||Vt.Space)&&(U-=B),ot.add(this.positionB,ot.mulScalar(this.front,-f),this.positionB),ot.add(this.positionB,ot.mulScalar(ot.normalize(ot.cross(this.front,this.up)),-E),this.positionB),this.positionB[1]-=U,ot.lerp(this.positionA,this.positionB,.2,this.positionA)}view(f){return Qt.lookAt(this.positionA,ot.add(this.positionA,this.front),this.up,f)}},sn=class u{vbuf;ibuf;indexCount;constructor(f){let E=new Map,U=[],B=[];for(let V=0;V<f.faces.length;V+=3){let tt=f.faces[V+0],J=f.faces[V+1],K=f.faces[V+2],rt=(BigInt(K)<<32n|BigInt(J)<<16n|BigInt(tt)).toString(),st=E.get(rt);if(st!==void 0)B.push(st);else{console.assert(U.length%8===0);let nt=U.length/8;E.set(rt,nt),B.push(nt),U.push(f.vertices[(tt-1)*3+0]),U.push(f.vertices[(tt-1)*3+1]),U.push(f.vertices[(tt-1)*3+2]),U.push(f.normals[(K-1)*3+0]),U.push(f.normals[(K-1)*3+1]),U.push(f.normals[(K-1)*3+2]),U.push(f.texcoords[(J-1)*2+0]),U.push(f.texcoords[(J-1)*2+1])}}if(this.vbuf=C.createBuffer({size:U.length*Ft,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),C.queue.writeBuffer(this.vbuf,0,new Float32Array(U),0,U.length),B.length%4!==0)for(console.warn("model indices aren't a multiple of 4");B.length%4!==0;)B.push(0);this.ibuf=C.createBuffer({size:B.length*Rn,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),C.queue.writeBuffer(this.ibuf,0,new Uint16Array(B),0,B.length),this.indexCount=B.length}static async load(f){let E=await Rt.load(f);return new u(E)}draw(f,E){f.setVertexBuffer(0,this.vbuf),f.setIndexBuffer(this.ibuf,"uint16"),f.drawIndexed(this.indexCount,E)}},cn=class u{constructor(f){this.canvas=f;this.context2D=f.getContext("2d")}beginTime=0;prevTime=0;frame=0;textY=0;canvasWidth=0;context2D;static FONT_SIZE=13;beginFrame(f){this.prevTime=this.beginTime,this.beginTime=f}endFrame(){let f=Math.round(this.canvasWidth)+8,E=this.textY+8;(f!==this.canvas.width||E!==this.canvas.height)&&(this.canvas.width=f,this.canvas.height=E),this.canvasWidth=100,this.textY=0,this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2D.globalAlpha=.5,this.context2D.fillStyle="white",this.context2D.fillRect(0,0,this.canvas.width,this.canvas.height),this.context2D.globalAlpha=1,this.context2D.fillStyle="black",this.context2D.font=`bold ${u.FONT_SIZE}px monospace`,this.frame++,this.draw(`frame: ${this.frame}`);let U=this.beginTime-this.prevTime,B=1/U*1e3;this.draw(`ms/frame: ${U.toFixed(2)}ms (${Math.round(B)}fps)`);let V=performance.now()-this.beginTime,tt=1/V*1e3;if(this.draw(`cpu: ${V.toFixed(2)}ms (${Math.round(tt)}fps)`),Ot!==void 0){let rt=Ot.avg/1e3/1e3,st=1/rt*1e3;this.draw(`gpu: ${rt.toFixed(2)}ms (${Math.round(st)}fps)`)}let J=0,{memory:K}=performance;K!==void 0&&(J=K.usedJSHeapSize/1024/1024),J!==0&&this.draw(`mem: ${J.toFixed(2)}mb`)}draw(f){this.textY+=u.FONT_SIZE,this.context2D.fillText(f,5,this.textY),this.canvasWidth=Math.max(this.canvasWidth,this.context2D.measureText(f).width+5)}},on=class u{index=0;querySet;resolve;result;avg=0;static MAX_QUERIES=64;constructor(){this.querySet=C.createQuerySet({type:"timestamp",count:2*u.MAX_QUERIES}),this.resolve=C.createBuffer({size:this.querySet.count*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.result=C.createBuffer({size:this.querySet.count*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}record(){console.assert(this.index<u.MAX_QUERIES);let f={querySet:this.querySet,beginningOfPassWriteIndex:this.index,endOfPassWriteIndex:this.index+1};return this.index+=2,f}endFrame(f){this.result.mapState==="unmapped"&&(f.resolveQuerySet(this.querySet,0,this.querySet.count,this.resolve,0),f.copyBufferToBuffer(this.resolve,0,this.result,0,this.result.size))}async measure(){if(this.result.mapState!=="unmapped")return;await this.result.mapAsync(GPUMapMode.READ);let f=0,E=new BigInt64Array(this.result.getMappedRange());for(let B=0;B<this.index;B+=2){let V=E[B+0],tt=E[B+1];f+=Number(tt-V)}this.result.unmap();let U=this.index/2;this.index=0,U>0&&(this.avg=f/U)}},rn=class u{bindGroupLayouts=new Map;bindGroups=[];samplers=[];hit=0;miss=0;step(){let f=0;for(;f<this.bindGroups.length;)this.bindGroups[f].lifetime--,this.bindGroups[f].lifetime===0?(this.bindGroups[f]=this.bindGroups[this.bindGroups.length-1],this.bindGroups.pop()):f++}getBindGroupLayout(f,E){let U=this.bindGroupLayouts.get(f);if(U===void 0){let V=f.getBindGroupLayout(E);return this.bindGroupLayouts.set(f,[V]),this.miss++,V}let B=U[E];if(B===void 0){let V=f.getBindGroupLayout(E);return U[E]=V,this.miss++,V}return this.hit++,B}createBindGroup(f){for(let B of this.bindGroups)if(u.sameBindGroup(B.descriptor,f))return this.hit++,B.resource;let U=C.createBindGroup(f);return this.bindGroups.push({resource:U,descriptor:f,lifetime:4}),this.miss++,U}static sameBindGroup(f,E){console.assert(f.layout===E.layout);let U=f.entries,B=E.entries;if(U.length!==B.length)return!1;for(let V=0;V<U.length;V++)if(!u.sameBindGroupEntry(U[V],B[V]))return!1;return!0}static sameBindGroupEntry(f,E){if(f.binding!==E.binding)return!1;if(f.resource!==E.resource){if(!f.resource.hasOwnProperty("buffer")||!E.resource.hasOwnProperty("buffer"))return!1;let U=f.resource,B=E.resource;if(U.buffer!==B.buffer||U.offset!==B.offset||U.size!==B.size)return!1}return!0}createSampler(f){for(let U of this.samplers)if(u.sameSampler(U.descriptor,f))return this.hit++,U.resource;let E=C.createSampler(f);return this.samplers.push({resource:E,descriptor:f}),this.miss++,E}static sameSampler(f,E){return f.addressModeU===E.addressModeU&&f.addressModeV===E.addressModeV&&f.addressModeW===E.addressModeW&&f.magFilter===E.magFilter&&f.minFilter===E.minFilter&&f.mipmapFilter===E.mipmapFilter&&f.lodMinClamp===E.lodMinClamp&&f.lodMaxClamp===E.lodMaxClamp&&f.compare===E.compare&&f.maxAnisotropy===E.maxAnisotropy}},un=class u{pipeline;bindGroup;static SHELL_COUNT=128;constructor(){let f=C.createShaderModule({code:fn+Pn});this.pipeline=C.createRenderPipeline({layout:"auto",primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthCompare:"less",depthWriteEnabled:!0},vertex:{entryPoint:"vp",module:f,buffers:[{stepMode:"vertex",arrayStride:8*Ft,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:0,format:"float32x3"},{shaderLocation:2,offset:0,format:"float32x2"}]}],constants:{SHELL_COUNT:u.SHELL_COUNT}},fragment:{entryPoint:"fp",module:f,targets:[{format:_t}],constants:{SHELL_COUNT:u.SHELL_COUNT}}}),this.bindGroup=C.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:jt}}]})}run(f,E,U,B){let V=f.beginRenderPass({label:"forward rendering pass",timestampWrites:Ot?.record(),colorAttachments:[{view:E,clearValue:[.7,.8,1,1],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:U,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});V.setPipeline(this.pipeline),V.setBindGroup(0,this.bindGroup),B?.draw(V,u.SHELL_COUNT),V.end()}},an=class{pipeline;constructor(){let f=C.createShaderModule({code:fn+An});this.pipeline=C.createRenderPipeline({layout:"auto",primitive:{topology:"triangle-list",cullMode:"back"},vertex:{module:f,entryPoint:"vp"},fragment:{module:f,entryPoint:"fp",targets:[{format:_t}]}})}run(f,E,U){let B=f.beginRenderPass({label:"fxaa pass",timestampWrites:Ot?.record(),colorAttachments:[{view:E,clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]});B.setPipeline(this.pipeline),B.setBindGroup(0,Jt.createBindGroup({layout:Jt.getBindGroupLayout(this.pipeline,0),entries:[{binding:0,resource:{buffer:jt}},{binding:1,resource:U},{binding:2,resource:Jt.createSampler({minFilter:"linear",magFilter:"linear"})}]})),B.draw(3),B.end()}};async function $n(){let u,f,E;try{let ut=await navigator.gpu.requestAdapter();if(ut===null)throw"no adapter";if(u=ut,C=await u.requestDevice({requiredFeatures:["timestamp-query"]}),f=document.getElementById("canvas"),E=f.getContext("webgpu"),E===null)throw"no context"}catch{alert("Your browser doesn't support WebGPU");return}_t=navigator.gpu.getPreferredCanvasFormat(),f.width=window.innerWidth,f.height=window.innerHeight,addEventListener("resize",()=>{f.width=window.innerWidth,f.height=window.innerHeight}),Z.prevX=f.width/2,Z.prevY=f.height/2,Z.x=Z.prevX,Z.y=Z.prevY,E.configure({device:C,format:_t,alphaMode:"premultiplied"});let U=new cn(document.getElementById("stats"));u.features.has("timestamp-query")&&typeof C.createQuerySet=="function"&&(Ot=new on);let B=new ArrayBuffer(nn+nn+nn+_n),V={model:new Float32Array(B,0,16),cameraView:new Float32Array(B,16*Ft,16),cameraProjection:new Float32Array(B,32*Ft,16),screenResolution:new Float32Array(B,48*Ft,4)};fn=`
struct Uniforms {
  model: mat4x4f,
  cameraView: mat4x4f,
  cameraProjection: mat4x4f,
  screenResolution: vec2f,
}
`,jt=C.createBuffer({size:B.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),Jt=new rn;let tt=new un,J=new an,K=new en(ot.create(0,0,3),-90*Kt),rt;sn.load("data/sphere.obj").then(ut=>rt=ut);let st,nt,Ut,it,vt=0,dt=0;function pt(ut){U.beginFrame(ut);let{width:ct,height:et}=f;K.update(),Z.deltaX=Z.x-Z.prevX,Z.deltaY=Z.y-Z.prevY,Z.prevX=Z.x,Z.prevY=Z.y,Z.wheel=0,Qt.identity(V.model),K.view(V.cameraView),Qt.perspective(60*Kt,ct/et,.1,50,V.cameraProjection),vn.set(ct,et,V.screenResolution),C.queue.writeBuffer(jt,0,B,0,B.byteLength),vt!==ct&&dt!==et&&(vt=ct,dt=et,st?.destroy(),st=C.createTexture({size:[ct,et,1],usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,format:_t}),nt=st.createView(),Ut=C.createTexture({size:[ct,et,1],usage:GPUTextureUsage.RENDER_ATTACHMENT,format:"depth24plus"}),it=Ut.createView());let wt=C.createCommandEncoder(),St=E.getCurrentTexture().createView();tt.run(wt,nt,it,rt),J.run(wt,St,nt),Ot?.endFrame(wt),C.queue.submit([wt.finish()]),Ot?.measure(),U.endFrame(),requestAnimationFrame(pt)}requestAnimationFrame(pt)}$n();})();
//# sourceMappingURL=index.js.map
