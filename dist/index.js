(()=>{function Un(u,f){return class extends u{constructor(...B){super(...B),f(this)}}}var zn=Un(Array,u=>u.fill(0)),W=1e-6;function Tn(u){function f(t=0,c=0){let n=new u(2);return t!==void 0&&(n[0]=t,c!==void 0&&(n[1]=c)),n}let B=f;function E(t,c,n){let e=n??new u(2);return e[0]=t,e[1]=c,e}function U(t,c){let n=c??new u(2);return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n}function R(t,c){let n=c??new u(2);return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n}function tt(t,c){let n=c??new u(2);return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n}function J(t,c=0,n=1,e){let a=e??new u(2);return a[0]=Math.min(n,Math.max(c,t[0])),a[1]=Math.min(n,Math.max(c,t[1])),a}function j(t,c,n){let e=n??new u(2);return e[0]=t[0]+c[0],e[1]=t[1]+c[1],e}function it(t,c,n,e){let a=e??new u(2);return a[0]=t[0]+c[0]*n,a[1]=t[1]+c[1]*n,a}function st(t,c){let n=t[0],e=t[1],a=c[0],M=c[1],y=Math.sqrt(n*n+e*e),s=Math.sqrt(a*a+M*M),r=y*s,d=r&&Tt(t,c)/r;return Math.acos(d)}function nt(t,c,n){let e=n??new u(2);return e[0]=t[0]-c[0],e[1]=t[1]-c[1],e}let Et=nt;function rt(t,c){return Math.abs(t[0]-c[0])<W&&Math.abs(t[1]-c[1])<W}function vt(t,c){return t[0]===c[0]&&t[1]===c[1]}function dt(t,c,n,e){let a=e??new u(2);return a[0]=t[0]+n*(c[0]-t[0]),a[1]=t[1]+n*(c[1]-t[1]),a}function pt(t,c,n,e){let a=e??new u(2);return a[0]=t[0]+n[0]*(c[0]-t[0]),a[1]=t[1]+n[1]*(c[1]-t[1]),a}function ut(t,c,n){let e=n??new u(2);return e[0]=Math.max(t[0],c[0]),e[1]=Math.max(t[1],c[1]),e}function ct(t,c,n){let e=n??new u(2);return e[0]=Math.min(t[0],c[0]),e[1]=Math.min(t[1],c[1]),e}function et(t,c,n){let e=n??new u(2);return e[0]=t[0]*c,e[1]=t[1]*c,e}let wt=et;function St(t,c,n){let e=n??new u(2);return e[0]=t[0]/c,e[1]=t[1]/c,e}function Ut(t,c){let n=c??new u(2);return n[0]=1/t[0],n[1]=1/t[1],n}let Ft=Ut;function zt(t,c,n){let e=n??new u(3),a=t[0]*c[1]-t[1]*c[0];return e[0]=0,e[1]=0,e[2]=a,e}function Tt(t,c){return t[0]*c[0]+t[1]*c[1]}function lt(t){let c=t[0],n=t[1];return Math.sqrt(c*c+n*n)}let Lt=lt;function Y(t){let c=t[0],n=t[1];return c*c+n*n}let Q=Y;function $(t,c){let n=t[0]-c[0],e=t[1]-c[1];return Math.sqrt(n*n+e*e)}let h=$;function P(t,c){let n=t[0]-c[0],e=t[1]-c[1];return n*n+e*e}let g=P;function S(t,c){let n=c??new u(2),e=t[0],a=t[1],M=Math.sqrt(e*e+a*a);return M>1e-5?(n[0]=e/M,n[1]=a/M):(n[0]=0,n[1]=0),n}function q(t,c){let n=c??new u(2);return n[0]=-t[0],n[1]=-t[1],n}function z(t,c){let n=c??new u(2);return n[0]=t[0],n[1]=t[1],n}let N=z;function O(t,c,n){let e=n??new u(2);return e[0]=t[0]*c[0],e[1]=t[1]*c[1],e}let X=O;function F(t,c,n){let e=n??new u(2);return e[0]=t[0]/c[0],e[1]=t[1]/c[1],e}let L=F;function H(t=1,c){let n=c??new u(2),e=Math.random()*2*Math.PI;return n[0]=Math.cos(e)*t,n[1]=Math.sin(e)*t,n}function x(t){let c=t??new u(2);return c[0]=0,c[1]=0,c}function A(t,c,n){let e=n??new u(2),a=t[0],M=t[1];return e[0]=a*c[0]+M*c[4]+c[12],e[1]=a*c[1]+M*c[5]+c[13],e}function o(t,c,n){let e=n??new u(2),a=t[0],M=t[1];return e[0]=c[0]*a+c[4]*M+c[8],e[1]=c[1]*a+c[5]*M+c[9],e}function i(t,c,n,e){let a=e??new u(2),M=t[0]-c[0],y=t[1]-c[1],s=Math.sin(n),r=Math.cos(n);return a[0]=M*r-y*s+c[0],a[1]=M*s+y*r+c[1],a}function l(t,c,n){let e=n??new u(2);return S(t,e),et(e,c,e)}function w(t,c,n){let e=n??new u(2);return lt(t)>c?l(t,c,e):z(t,e)}function G(t,c,n){let e=n??new u(2);return dt(t,c,.5,e)}return{create:f,fromValues:B,set:E,ceil:U,floor:R,round:tt,clamp:J,add:j,addScaled:it,angle:st,subtract:nt,sub:Et,equalsApproximately:rt,equals:vt,lerp:dt,lerpV:pt,max:ut,min:ct,mulScalar:et,scale:wt,divScalar:St,inverse:Ut,invert:Ft,cross:zt,dot:Tt,length:lt,len:Lt,lengthSq:Y,lenSq:Q,distance:$,dist:h,distanceSq:P,distSq:g,normalize:S,negate:q,copy:z,clone:N,multiply:O,mul:X,divide:F,div:L,random:H,zero:x,transformMat4:A,transformMat3:o,rotate:i,setLength:l,truncate:w,midpoint:G}}var wn=new Map;function yn(u){let f=wn.get(u);return f||(f=Tn(u),wn.set(u,f)),f}function bn(u){let f=yn(u);function B(h,P,g,S,q,z,N,O,X){let F=new u(12);return F[3]=0,F[7]=0,F[11]=0,h!==void 0&&(F[0]=h,P!==void 0&&(F[1]=P,g!==void 0&&(F[2]=g,S!==void 0&&(F[4]=S,q!==void 0&&(F[5]=q,z!==void 0&&(F[6]=z,N!==void 0&&(F[8]=N,O!==void 0&&(F[9]=O,X!==void 0&&(F[10]=X))))))))),F}function E(h,P,g,S,q,z,N,O,X,F){let L=F??new u(12);return L[0]=h,L[1]=P,L[2]=g,L[3]=0,L[4]=S,L[5]=q,L[6]=z,L[7]=0,L[8]=N,L[9]=O,L[10]=X,L[11]=0,L}function U(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=0,g[4]=h[4],g[5]=h[5],g[6]=h[6],g[7]=0,g[8]=h[8],g[9]=h[9],g[10]=h[10],g[11]=0,g}function R(h,P){let g=P??new u(12),S=h[0],q=h[1],z=h[2],N=h[3],O=S+S,X=q+q,F=z+z,L=S*O,H=q*O,x=q*X,A=z*O,o=z*X,i=z*F,l=N*O,w=N*X,G=N*F;return g[0]=1-x-i,g[1]=H+G,g[2]=A-w,g[3]=0,g[4]=H-G,g[5]=1-L-i,g[6]=o+l,g[7]=0,g[8]=A+w,g[9]=o-l,g[10]=1-L-x,g[11]=0,g}function tt(h,P){let g=P??new u(12);return g[0]=-h[0],g[1]=-h[1],g[2]=-h[2],g[4]=-h[4],g[5]=-h[5],g[6]=-h[6],g[8]=-h[8],g[9]=-h[9],g[10]=-h[10],g}function J(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[4]=h[4],g[5]=h[5],g[6]=h[6],g[8]=h[8],g[9]=h[9],g[10]=h[10],g}let j=J;function it(h,P){return Math.abs(h[0]-P[0])<W&&Math.abs(h[1]-P[1])<W&&Math.abs(h[2]-P[2])<W&&Math.abs(h[4]-P[4])<W&&Math.abs(h[5]-P[5])<W&&Math.abs(h[6]-P[6])<W&&Math.abs(h[8]-P[8])<W&&Math.abs(h[9]-P[9])<W&&Math.abs(h[10]-P[10])<W}function st(h,P){return h[0]===P[0]&&h[1]===P[1]&&h[2]===P[2]&&h[4]===P[4]&&h[5]===P[5]&&h[6]===P[6]&&h[8]===P[8]&&h[9]===P[9]&&h[10]===P[10]}function nt(h){let P=h??new u(12);return P[0]=1,P[1]=0,P[2]=0,P[4]=0,P[5]=1,P[6]=0,P[8]=0,P[9]=0,P[10]=1,P}function Et(h,P){let g=P??new u(12);if(g===h){let x;return x=h[1],h[1]=h[4],h[4]=x,x=h[2],h[2]=h[8],h[8]=x,x=h[6],h[6]=h[9],h[9]=x,g}let S=h[0*4+0],q=h[0*4+1],z=h[0*4+2],N=h[1*4+0],O=h[1*4+1],X=h[1*4+2],F=h[2*4+0],L=h[2*4+1],H=h[2*4+2];return g[0]=S,g[1]=N,g[2]=F,g[4]=q,g[5]=O,g[6]=L,g[8]=z,g[9]=X,g[10]=H,g}function rt(h,P){let g=P??new u(12),S=h[0*4+0],q=h[0*4+1],z=h[0*4+2],N=h[1*4+0],O=h[1*4+1],X=h[1*4+2],F=h[2*4+0],L=h[2*4+1],H=h[2*4+2],x=H*O-X*L,A=-H*N+X*F,o=L*N-O*F,i=1/(S*x+q*A+z*o);return g[0]=x*i,g[1]=(-H*q+z*L)*i,g[2]=(X*q-z*O)*i,g[4]=A*i,g[5]=(H*S-z*F)*i,g[6]=(-X*S+z*N)*i,g[8]=o*i,g[9]=(-L*S+q*F)*i,g[10]=(O*S-q*N)*i,g}function vt(h){let P=h[0],g=h[0*4+1],S=h[0*4+2],q=h[1*4+0],z=h[1*4+1],N=h[1*4+2],O=h[2*4+0],X=h[2*4+1],F=h[2*4+2];return P*(z*F-X*N)-q*(g*F-X*S)+O*(g*N-z*S)}let dt=rt;function pt(h,P,g){let S=g??new u(12),q=h[0],z=h[1],N=h[2],O=h[4],X=h[5],F=h[6],L=h[8],H=h[9],x=h[10],A=P[0],o=P[1],i=P[2],l=P[4],w=P[5],G=P[6],t=P[8],c=P[9],n=P[10];return S[0]=q*A+O*o+L*i,S[1]=z*A+X*o+H*i,S[2]=N*A+F*o+x*i,S[4]=q*l+O*w+L*G,S[5]=z*l+X*w+H*G,S[6]=N*l+F*w+x*G,S[8]=q*t+O*c+L*n,S[9]=z*t+X*c+H*n,S[10]=N*t+F*c+x*n,S}let ut=pt;function ct(h,P,g){let S=g??nt();return h!==S&&(S[0]=h[0],S[1]=h[1],S[2]=h[2],S[4]=h[4],S[5]=h[5],S[6]=h[6]),S[8]=P[0],S[9]=P[1],S[10]=1,S}function et(h,P){let g=P??f.create();return g[0]=h[8],g[1]=h[9],g}function wt(h,P,g){let S=g??f.create(),q=P*4;return S[0]=h[q+0],S[1]=h[q+1],S}function St(h,P,g,S){let q=S===h?h:J(h,S),z=g*4;return q[z+0]=P[0],q[z+1]=P[1],q}function Ut(h,P){let g=P??f.create(),S=h[0],q=h[1],z=h[4],N=h[5];return g[0]=Math.sqrt(S*S+q*q),g[1]=Math.sqrt(z*z+N*N),g}function Ft(h,P){let g=P??new u(12);return g[0]=1,g[1]=0,g[2]=0,g[4]=0,g[5]=1,g[6]=0,g[8]=h[0],g[9]=h[1],g[10]=1,g}function zt(h,P,g){let S=g??new u(12),q=P[0],z=P[1],N=h[0],O=h[1],X=h[2],F=h[1*4+0],L=h[1*4+1],H=h[1*4+2],x=h[2*4+0],A=h[2*4+1],o=h[2*4+2];return h!==S&&(S[0]=N,S[1]=O,S[2]=X,S[4]=F,S[5]=L,S[6]=H),S[8]=N*q+F*z+x,S[9]=O*q+L*z+A,S[10]=X*q+H*z+o,S}function Tt(h,P){let g=P??new u(12),S=Math.cos(h),q=Math.sin(h);return g[0]=S,g[1]=q,g[2]=0,g[4]=-q,g[5]=S,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function lt(h,P,g){let S=g??new u(12),q=h[0*4+0],z=h[0*4+1],N=h[0*4+2],O=h[1*4+0],X=h[1*4+1],F=h[1*4+2],L=Math.cos(P),H=Math.sin(P);return S[0]=L*q+H*O,S[1]=L*z+H*X,S[2]=L*N+H*F,S[4]=L*O-H*q,S[5]=L*X-H*z,S[6]=L*F-H*N,h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}function Lt(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=0,g[2]=0,g[4]=0,g[5]=h[1],g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function Y(h,P,g){let S=g??new u(12),q=P[0],z=P[1];return S[0]=q*h[0*4+0],S[1]=q*h[0*4+1],S[2]=q*h[0*4+2],S[4]=z*h[1*4+0],S[5]=z*h[1*4+1],S[6]=z*h[1*4+2],h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}function Q(h,P){let g=P??new u(12);return g[0]=h,g[1]=0,g[2]=0,g[4]=0,g[5]=h,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function $(h,P,g){let S=g??new u(12);return S[0]=P*h[0*4+0],S[1]=P*h[0*4+1],S[2]=P*h[0*4+2],S[4]=P*h[1*4+0],S[5]=P*h[1*4+1],S[6]=P*h[1*4+2],h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}return{clone:j,create:B,set:E,fromMat4:U,fromQuat:R,negate:tt,copy:J,equalsApproximately:it,equals:st,identity:nt,transpose:Et,inverse:rt,invert:dt,determinant:vt,mul:ut,multiply:pt,setTranslation:ct,getTranslation:et,getAxis:wt,setAxis:St,getScaling:Ut,translation:Ft,translate:zt,rotation:Tt,rotate:lt,scaling:Lt,scale:Y,uniformScaling:Q,uniformScale:$}}var Mn=new Map;function qn(u){let f=Mn.get(u);return f||(f=bn(u),Mn.set(u,f)),f}function In(u){function f(s,r,d){let p=new u(3);return s!==void 0&&(p[0]=s,r!==void 0&&(p[1]=r,d!==void 0&&(p[2]=d))),p}let B=f;function E(s,r,d,p){let m=p??new u(3);return m[0]=s,m[1]=r,m[2]=d,m}function U(s,r){let d=r??new u(3);return d[0]=Math.ceil(s[0]),d[1]=Math.ceil(s[1]),d[2]=Math.ceil(s[2]),d}function R(s,r){let d=r??new u(3);return d[0]=Math.floor(s[0]),d[1]=Math.floor(s[1]),d[2]=Math.floor(s[2]),d}function tt(s,r){let d=r??new u(3);return d[0]=Math.round(s[0]),d[1]=Math.round(s[1]),d[2]=Math.round(s[2]),d}function J(s,r=0,d=1,p){let m=p??new u(3);return m[0]=Math.min(d,Math.max(r,s[0])),m[1]=Math.min(d,Math.max(r,s[1])),m[2]=Math.min(d,Math.max(r,s[2])),m}function j(s,r,d){let p=d??new u(3);return p[0]=s[0]+r[0],p[1]=s[1]+r[1],p[2]=s[2]+r[2],p}function it(s,r,d,p){let m=p??new u(3);return m[0]=s[0]+r[0]*d,m[1]=s[1]+r[1]*d,m[2]=s[2]+r[2]*d,m}function st(s,r){let d=s[0],p=s[1],m=s[2],D=r[0],v=r[1],I=r[2],V=Math.sqrt(d*d+p*p+m*m),T=Math.sqrt(D*D+v*v+I*I),b=V*T,_=b&&Tt(s,r)/b;return Math.acos(_)}function nt(s,r,d){let p=d??new u(3);return p[0]=s[0]-r[0],p[1]=s[1]-r[1],p[2]=s[2]-r[2],p}let Et=nt;function rt(s,r){return Math.abs(s[0]-r[0])<W&&Math.abs(s[1]-r[1])<W&&Math.abs(s[2]-r[2])<W}function vt(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]}function dt(s,r,d,p){let m=p??new u(3);return m[0]=s[0]+d*(r[0]-s[0]),m[1]=s[1]+d*(r[1]-s[1]),m[2]=s[2]+d*(r[2]-s[2]),m}function pt(s,r,d,p){let m=p??new u(3);return m[0]=s[0]+d[0]*(r[0]-s[0]),m[1]=s[1]+d[1]*(r[1]-s[1]),m[2]=s[2]+d[2]*(r[2]-s[2]),m}function ut(s,r,d){let p=d??new u(3);return p[0]=Math.max(s[0],r[0]),p[1]=Math.max(s[1],r[1]),p[2]=Math.max(s[2],r[2]),p}function ct(s,r,d){let p=d??new u(3);return p[0]=Math.min(s[0],r[0]),p[1]=Math.min(s[1],r[1]),p[2]=Math.min(s[2],r[2]),p}function et(s,r,d){let p=d??new u(3);return p[0]=s[0]*r,p[1]=s[1]*r,p[2]=s[2]*r,p}let wt=et;function St(s,r,d){let p=d??new u(3);return p[0]=s[0]/r,p[1]=s[1]/r,p[2]=s[2]/r,p}function Ut(s,r){let d=r??new u(3);return d[0]=1/s[0],d[1]=1/s[1],d[2]=1/s[2],d}let Ft=Ut;function zt(s,r,d){let p=d??new u(3),m=s[2]*r[0]-s[0]*r[2],D=s[0]*r[1]-s[1]*r[0];return p[0]=s[1]*r[2]-s[2]*r[1],p[1]=m,p[2]=D,p}function Tt(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function lt(s){let r=s[0],d=s[1],p=s[2];return Math.sqrt(r*r+d*d+p*p)}let Lt=lt;function Y(s){let r=s[0],d=s[1],p=s[2];return r*r+d*d+p*p}let Q=Y;function $(s,r){let d=s[0]-r[0],p=s[1]-r[1],m=s[2]-r[2];return Math.sqrt(d*d+p*p+m*m)}let h=$;function P(s,r){let d=s[0]-r[0],p=s[1]-r[1],m=s[2]-r[2];return d*d+p*p+m*m}let g=P;function S(s,r){let d=r??new u(3),p=s[0],m=s[1],D=s[2],v=Math.sqrt(p*p+m*m+D*D);return v>1e-5?(d[0]=p/v,d[1]=m/v,d[2]=D/v):(d[0]=0,d[1]=0,d[2]=0),d}function q(s,r){let d=r??new u(3);return d[0]=-s[0],d[1]=-s[1],d[2]=-s[2],d}function z(s,r){let d=r??new u(3);return d[0]=s[0],d[1]=s[1],d[2]=s[2],d}let N=z;function O(s,r,d){let p=d??new u(3);return p[0]=s[0]*r[0],p[1]=s[1]*r[1],p[2]=s[2]*r[2],p}let X=O;function F(s,r,d){let p=d??new u(3);return p[0]=s[0]/r[0],p[1]=s[1]/r[1],p[2]=s[2]/r[2],p}let L=F;function H(s=1,r){let d=r??new u(3),p=Math.random()*2*Math.PI,m=Math.random()*2-1,D=Math.sqrt(1-m*m)*s;return d[0]=Math.cos(p)*D,d[1]=Math.sin(p)*D,d[2]=m*s,d}function x(s){let r=s??new u(3);return r[0]=0,r[1]=0,r[2]=0,r}function A(s,r,d){let p=d??new u(3),m=s[0],D=s[1],v=s[2],I=r[3]*m+r[7]*D+r[11]*v+r[15]||1;return p[0]=(r[0]*m+r[4]*D+r[8]*v+r[12])/I,p[1]=(r[1]*m+r[5]*D+r[9]*v+r[13])/I,p[2]=(r[2]*m+r[6]*D+r[10]*v+r[14])/I,p}function o(s,r,d){let p=d??new u(3),m=s[0],D=s[1],v=s[2];return p[0]=m*r[0*4+0]+D*r[1*4+0]+v*r[2*4+0],p[1]=m*r[0*4+1]+D*r[1*4+1]+v*r[2*4+1],p[2]=m*r[0*4+2]+D*r[1*4+2]+v*r[2*4+2],p}function i(s,r,d){let p=d??new u(3),m=s[0],D=s[1],v=s[2];return p[0]=m*r[0]+D*r[4]+v*r[8],p[1]=m*r[1]+D*r[5]+v*r[9],p[2]=m*r[2]+D*r[6]+v*r[10],p}function l(s,r,d){let p=d??new u(3),m=r[0],D=r[1],v=r[2],I=r[3]*2,V=s[0],T=s[1],b=s[2],_=D*b-v*T,k=v*V-m*b,C=m*T-D*V;return p[0]=V+_*I+(D*C-v*k)*2,p[1]=T+k*I+(v*_-m*C)*2,p[2]=b+C*I+(m*k-D*_)*2,p}function w(s,r){let d=r??new u(3);return d[0]=s[12],d[1]=s[13],d[2]=s[14],d}function G(s,r,d){let p=d??new u(3),m=r*4;return p[0]=s[m+0],p[1]=s[m+1],p[2]=s[m+2],p}function t(s,r){let d=r??new u(3),p=s[0],m=s[1],D=s[2],v=s[4],I=s[5],V=s[6],T=s[8],b=s[9],_=s[10];return d[0]=Math.sqrt(p*p+m*m+D*D),d[1]=Math.sqrt(v*v+I*I+V*V),d[2]=Math.sqrt(T*T+b*b+_*_),d}function c(s,r,d,p){let m=p??new u(3),D=[],v=[];return D[0]=s[0]-r[0],D[1]=s[1]-r[1],D[2]=s[2]-r[2],v[0]=D[0],v[1]=D[1]*Math.cos(d)-D[2]*Math.sin(d),v[2]=D[1]*Math.sin(d)+D[2]*Math.cos(d),m[0]=v[0]+r[0],m[1]=v[1]+r[1],m[2]=v[2]+r[2],m}function n(s,r,d,p){let m=p??new u(3),D=[],v=[];return D[0]=s[0]-r[0],D[1]=s[1]-r[1],D[2]=s[2]-r[2],v[0]=D[2]*Math.sin(d)+D[0]*Math.cos(d),v[1]=D[1],v[2]=D[2]*Math.cos(d)-D[0]*Math.sin(d),m[0]=v[0]+r[0],m[1]=v[1]+r[1],m[2]=v[2]+r[2],m}function e(s,r,d,p){let m=p??new u(3),D=[],v=[];return D[0]=s[0]-r[0],D[1]=s[1]-r[1],D[2]=s[2]-r[2],v[0]=D[0]*Math.cos(d)-D[1]*Math.sin(d),v[1]=D[0]*Math.sin(d)+D[1]*Math.cos(d),v[2]=D[2],m[0]=v[0]+r[0],m[1]=v[1]+r[1],m[2]=v[2]+r[2],m}function a(s,r,d){let p=d??new u(3);return S(s,p),et(p,r,p)}function M(s,r,d){let p=d??new u(3);return lt(s)>r?a(s,r,p):z(s,p)}function y(s,r,d){let p=d??new u(3);return dt(s,r,.5,p)}return{create:f,fromValues:B,set:E,ceil:U,floor:R,round:tt,clamp:J,add:j,addScaled:it,angle:st,subtract:nt,sub:Et,equalsApproximately:rt,equals:vt,lerp:dt,lerpV:pt,max:ut,min:ct,mulScalar:et,scale:wt,divScalar:St,inverse:Ut,invert:Ft,cross:zt,dot:Tt,length:lt,len:Lt,lengthSq:Y,lenSq:Q,distance:$,dist:h,distanceSq:P,distSq:g,normalize:S,negate:q,copy:z,clone:N,multiply:O,mul:X,divide:F,div:L,random:H,zero:x,transformMat4:A,transformMat4Upper3x3:o,transformMat3:i,transformQuat:l,getTranslation:w,getAxis:G,getScaling:t,rotateX:c,rotateY:n,rotateZ:e,setLength:a,truncate:M,midpoint:y}}var xn=new Map;function Ct(u){let f=xn.get(u);return f||(f=In(u),xn.set(u,f)),f}function Fn(u){let f=Ct(u);function B(t,c,n,e,a,M,y,s,r,d,p,m,D,v,I,V){let T=new u(16);return t!==void 0&&(T[0]=t,c!==void 0&&(T[1]=c,n!==void 0&&(T[2]=n,e!==void 0&&(T[3]=e,a!==void 0&&(T[4]=a,M!==void 0&&(T[5]=M,y!==void 0&&(T[6]=y,s!==void 0&&(T[7]=s,r!==void 0&&(T[8]=r,d!==void 0&&(T[9]=d,p!==void 0&&(T[10]=p,m!==void 0&&(T[11]=m,D!==void 0&&(T[12]=D,v!==void 0&&(T[13]=v,I!==void 0&&(T[14]=I,V!==void 0&&(T[15]=V)))))))))))))))),T}function E(t,c,n,e,a,M,y,s,r,d,p,m,D,v,I,V,T){let b=T??new u(16);return b[0]=t,b[1]=c,b[2]=n,b[3]=e,b[4]=a,b[5]=M,b[6]=y,b[7]=s,b[8]=r,b[9]=d,b[10]=p,b[11]=m,b[12]=D,b[13]=v,b[14]=I,b[15]=V,b}function U(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=0,n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function R(t,c){let n=c??new u(16),e=t[0],a=t[1],M=t[2],y=t[3],s=e+e,r=a+a,d=M+M,p=e*s,m=a*s,D=a*r,v=M*s,I=M*r,V=M*d,T=y*s,b=y*r,_=y*d;return n[0]=1-D-V,n[1]=m+_,n[2]=v-b,n[3]=0,n[4]=m-_,n[5]=1-p-V,n[6]=I+T,n[7]=0,n[8]=v+b,n[9]=I-T,n[10]=1-p-D,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function tt(t,c){let n=c??new u(16);return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n[11]=-t[11],n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=-t[15],n}function J(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}let j=J;function it(t,c){return Math.abs(t[0]-c[0])<W&&Math.abs(t[1]-c[1])<W&&Math.abs(t[2]-c[2])<W&&Math.abs(t[3]-c[3])<W&&Math.abs(t[4]-c[4])<W&&Math.abs(t[5]-c[5])<W&&Math.abs(t[6]-c[6])<W&&Math.abs(t[7]-c[7])<W&&Math.abs(t[8]-c[8])<W&&Math.abs(t[9]-c[9])<W&&Math.abs(t[10]-c[10])<W&&Math.abs(t[11]-c[11])<W&&Math.abs(t[12]-c[12])<W&&Math.abs(t[13]-c[13])<W&&Math.abs(t[14]-c[14])<W&&Math.abs(t[15]-c[15])<W}function st(t,c){return t[0]===c[0]&&t[1]===c[1]&&t[2]===c[2]&&t[3]===c[3]&&t[4]===c[4]&&t[5]===c[5]&&t[6]===c[6]&&t[7]===c[7]&&t[8]===c[8]&&t[9]===c[9]&&t[10]===c[10]&&t[11]===c[11]&&t[12]===c[12]&&t[13]===c[13]&&t[14]===c[14]&&t[15]===c[15]}function nt(t){let c=t??new u(16);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Et(t,c){let n=c??new u(16);if(n===t){let k;return k=t[1],t[1]=t[4],t[4]=k,k=t[2],t[2]=t[8],t[8]=k,k=t[3],t[3]=t[12],t[12]=k,k=t[6],t[6]=t[9],t[9]=k,k=t[7],t[7]=t[13],t[13]=k,k=t[11],t[11]=t[14],t[14]=k,n}let e=t[0*4+0],a=t[0*4+1],M=t[0*4+2],y=t[0*4+3],s=t[1*4+0],r=t[1*4+1],d=t[1*4+2],p=t[1*4+3],m=t[2*4+0],D=t[2*4+1],v=t[2*4+2],I=t[2*4+3],V=t[3*4+0],T=t[3*4+1],b=t[3*4+2],_=t[3*4+3];return n[0]=e,n[1]=s,n[2]=m,n[3]=V,n[4]=a,n[5]=r,n[6]=D,n[7]=T,n[8]=M,n[9]=d,n[10]=v,n[11]=b,n[12]=y,n[13]=p,n[14]=I,n[15]=_,n}function rt(t,c){let n=c??new u(16),e=t[0*4+0],a=t[0*4+1],M=t[0*4+2],y=t[0*4+3],s=t[1*4+0],r=t[1*4+1],d=t[1*4+2],p=t[1*4+3],m=t[2*4+0],D=t[2*4+1],v=t[2*4+2],I=t[2*4+3],V=t[3*4+0],T=t[3*4+1],b=t[3*4+2],_=t[3*4+3],k=v*_,C=b*I,at=d*_,ft=b*p,ht=d*I,Mt=v*p,xt=M*_,gt=b*y,mt=M*I,Dt=v*y,At=M*p,Pt=d*y,Gt=m*T,Bt=V*D,bt=s*T,qt=V*r,It=s*D,_t=m*r,$t=e*T,Xt=V*a,kt=e*D,Yt=m*a,Ht=e*r,Zt=s*a,ln=k*r+ft*D+ht*T-(C*r+at*D+Mt*T),hn=C*a+xt*D+Dt*T-(k*a+gt*D+mt*T),dn=at*a+gt*r+At*T-(ft*a+xt*r+Pt*T),pn=Mt*a+mt*r+Pt*D-(ht*a+Dt*r+At*D),yt=1/(e*ln+s*hn+m*dn+V*pn);return n[0]=yt*ln,n[1]=yt*hn,n[2]=yt*dn,n[3]=yt*pn,n[4]=yt*(C*s+at*m+Mt*V-(k*s+ft*m+ht*V)),n[5]=yt*(k*e+gt*m+mt*V-(C*e+xt*m+Dt*V)),n[6]=yt*(ft*e+xt*s+Pt*V-(at*e+gt*s+At*V)),n[7]=yt*(ht*e+Dt*s+At*m-(Mt*e+mt*s+Pt*m)),n[8]=yt*(Gt*p+qt*I+It*_-(Bt*p+bt*I+_t*_)),n[9]=yt*(Bt*y+$t*I+Yt*_-(Gt*y+Xt*I+kt*_)),n[10]=yt*(bt*y+Xt*p+Ht*_-(qt*y+$t*p+Zt*_)),n[11]=yt*(_t*y+kt*p+Zt*I-(It*y+Yt*p+Ht*I)),n[12]=yt*(bt*v+_t*b+Bt*d-(It*b+Gt*d+qt*v)),n[13]=yt*(kt*b+Gt*M+Xt*v-($t*v+Yt*b+Bt*M)),n[14]=yt*($t*d+Zt*b+qt*M-(Ht*b+bt*M+Xt*d)),n[15]=yt*(Ht*v+It*M+Yt*d-(kt*d+Zt*v+_t*M)),n}function vt(t){let c=t[0],n=t[0*4+1],e=t[0*4+2],a=t[0*4+3],M=t[1*4+0],y=t[1*4+1],s=t[1*4+2],r=t[1*4+3],d=t[2*4+0],p=t[2*4+1],m=t[2*4+2],D=t[2*4+3],v=t[3*4+0],I=t[3*4+1],V=t[3*4+2],T=t[3*4+3],b=m*T,_=V*D,k=s*T,C=V*r,at=s*D,ft=m*r,ht=e*T,Mt=V*a,xt=e*D,gt=m*a,mt=e*r,Dt=s*a,At=b*y+C*p+at*I-(_*y+k*p+ft*I),Pt=_*n+ht*p+gt*I-(b*n+Mt*p+xt*I),Gt=k*n+Mt*y+mt*I-(C*n+ht*y+Dt*I),Bt=ft*n+xt*y+Dt*p-(at*n+gt*y+mt*p);return c*At+M*Pt+d*Gt+v*Bt}let dt=rt;function pt(t,c,n){let e=n??new u(16),a=t[0],M=t[1],y=t[2],s=t[3],r=t[4],d=t[5],p=t[6],m=t[7],D=t[8],v=t[9],I=t[10],V=t[11],T=t[12],b=t[13],_=t[14],k=t[15],C=c[0],at=c[1],ft=c[2],ht=c[3],Mt=c[4],xt=c[5],gt=c[6],mt=c[7],Dt=c[8],At=c[9],Pt=c[10],Gt=c[11],Bt=c[12],bt=c[13],qt=c[14],It=c[15];return e[0]=a*C+r*at+D*ft+T*ht,e[1]=M*C+d*at+v*ft+b*ht,e[2]=y*C+p*at+I*ft+_*ht,e[3]=s*C+m*at+V*ft+k*ht,e[4]=a*Mt+r*xt+D*gt+T*mt,e[5]=M*Mt+d*xt+v*gt+b*mt,e[6]=y*Mt+p*xt+I*gt+_*mt,e[7]=s*Mt+m*xt+V*gt+k*mt,e[8]=a*Dt+r*At+D*Pt+T*Gt,e[9]=M*Dt+d*At+v*Pt+b*Gt,e[10]=y*Dt+p*At+I*Pt+_*Gt,e[11]=s*Dt+m*At+V*Pt+k*Gt,e[12]=a*Bt+r*bt+D*qt+T*It,e[13]=M*Bt+d*bt+v*qt+b*It,e[14]=y*Bt+p*bt+I*qt+_*It,e[15]=s*Bt+m*bt+V*qt+k*It,e}let ut=pt;function ct(t,c,n){let e=n??nt();return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]),e[12]=c[0],e[13]=c[1],e[14]=c[2],e[15]=1,e}function et(t,c){let n=c??f.create();return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function wt(t,c,n){let e=n??f.create(),a=c*4;return e[0]=t[a+0],e[1]=t[a+1],e[2]=t[a+2],e}function St(t,c,n,e){let a=e===t?e:J(t,e),M=n*4;return a[M+0]=c[0],a[M+1]=c[1],a[M+2]=c[2],a}function Ut(t,c){let n=c??f.create(),e=t[0],a=t[1],M=t[2],y=t[4],s=t[5],r=t[6],d=t[8],p=t[9],m=t[10];return n[0]=Math.sqrt(e*e+a*a+M*M),n[1]=Math.sqrt(y*y+s*s+r*r),n[2]=Math.sqrt(d*d+p*p+m*m),n}function Ft(t,c,n,e,a){let M=a??new u(16),y=Math.tan(Math.PI*.5-.5*t);if(M[0]=y/c,M[1]=0,M[2]=0,M[3]=0,M[4]=0,M[5]=y,M[6]=0,M[7]=0,M[8]=0,M[9]=0,M[11]=-1,M[12]=0,M[13]=0,M[15]=0,Number.isFinite(e)){let s=1/(n-e);M[10]=e*s,M[14]=e*n*s}else M[10]=-1,M[14]=-n;return M}function zt(t,c,n,e=1/0,a){let M=a??new u(16),y=1/Math.tan(t*.5);if(M[0]=y/c,M[1]=0,M[2]=0,M[3]=0,M[4]=0,M[5]=y,M[6]=0,M[7]=0,M[8]=0,M[9]=0,M[11]=-1,M[12]=0,M[13]=0,M[15]=0,e===1/0)M[10]=0,M[14]=n;else{let s=1/(e-n);M[10]=n*s,M[14]=e*n*s}return M}function Tt(t,c,n,e,a,M,y){let s=y??new u(16);return s[0]=2/(c-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(e-n),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1/(a-M),s[11]=0,s[12]=(c+t)/(t-c),s[13]=(e+n)/(n-e),s[14]=a/(a-M),s[15]=1,s}function lt(t,c,n,e,a,M,y){let s=y??new u(16),r=c-t,d=e-n,p=a-M;return s[0]=2*a/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*a/d,s[6]=0,s[7]=0,s[8]=(t+c)/r,s[9]=(e+n)/d,s[10]=M/p,s[11]=-1,s[12]=0,s[13]=0,s[14]=a*M/p,s[15]=0,s}function Lt(t,c,n,e,a,M=1/0,y){let s=y??new u(16),r=c-t,d=e-n;if(s[0]=2*a/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*a/d,s[6]=0,s[7]=0,s[8]=(t+c)/r,s[9]=(e+n)/d,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,M===1/0)s[10]=0,s[14]=a;else{let p=1/(M-a);s[10]=a*p,s[14]=M*a*p}return s}let Y=f.create(),Q=f.create(),$=f.create();function h(t,c,n,e){let a=e??new u(16);return f.normalize(f.subtract(c,t,$),$),f.normalize(f.cross(n,$,Y),Y),f.normalize(f.cross($,Y,Q),Q),a[0]=Y[0],a[1]=Y[1],a[2]=Y[2],a[3]=0,a[4]=Q[0],a[5]=Q[1],a[6]=Q[2],a[7]=0,a[8]=$[0],a[9]=$[1],a[10]=$[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function P(t,c,n,e){let a=e??new u(16);return f.normalize(f.subtract(t,c,$),$),f.normalize(f.cross(n,$,Y),Y),f.normalize(f.cross($,Y,Q),Q),a[0]=Y[0],a[1]=Y[1],a[2]=Y[2],a[3]=0,a[4]=Q[0],a[5]=Q[1],a[6]=Q[2],a[7]=0,a[8]=$[0],a[9]=$[1],a[10]=$[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function g(t,c,n,e){let a=e??new u(16);return f.normalize(f.subtract(t,c,$),$),f.normalize(f.cross(n,$,Y),Y),f.normalize(f.cross($,Y,Q),Q),a[0]=Y[0],a[1]=Q[0],a[2]=$[0],a[3]=0,a[4]=Y[1],a[5]=Q[1],a[6]=$[1],a[7]=0,a[8]=Y[2],a[9]=Q[2],a[10]=$[2],a[11]=0,a[12]=-(Y[0]*t[0]+Y[1]*t[1]+Y[2]*t[2]),a[13]=-(Q[0]*t[0]+Q[1]*t[1]+Q[2]*t[2]),a[14]=-($[0]*t[0]+$[1]*t[1]+$[2]*t[2]),a[15]=1,a}function S(t,c){let n=c??new u(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function q(t,c,n){let e=n??new u(16),a=c[0],M=c[1],y=c[2],s=t[0],r=t[1],d=t[2],p=t[3],m=t[1*4+0],D=t[1*4+1],v=t[1*4+2],I=t[1*4+3],V=t[2*4+0],T=t[2*4+1],b=t[2*4+2],_=t[2*4+3],k=t[3*4+0],C=t[3*4+1],at=t[3*4+2],ft=t[3*4+3];return t!==e&&(e[0]=s,e[1]=r,e[2]=d,e[3]=p,e[4]=m,e[5]=D,e[6]=v,e[7]=I,e[8]=V,e[9]=T,e[10]=b,e[11]=_),e[12]=s*a+m*M+V*y+k,e[13]=r*a+D*M+T*y+C,e[14]=d*a+v*M+b*y+at,e[15]=p*a+I*M+_*y+ft,e}function z(t,c){let n=c??new u(16),e=Math.cos(t),a=Math.sin(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=a,n[7]=0,n[8]=0,n[9]=-a,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function N(t,c,n){let e=n??new u(16),a=t[4],M=t[5],y=t[6],s=t[7],r=t[8],d=t[9],p=t[10],m=t[11],D=Math.cos(c),v=Math.sin(c);return e[4]=D*a+v*r,e[5]=D*M+v*d,e[6]=D*y+v*p,e[7]=D*s+v*m,e[8]=D*r-v*a,e[9]=D*d-v*M,e[10]=D*p-v*y,e[11]=D*m-v*s,t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function O(t,c){let n=c??new u(16),e=Math.cos(t),a=Math.sin(t);return n[0]=e,n[1]=0,n[2]=-a,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=a,n[9]=0,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function X(t,c,n){let e=n??new u(16),a=t[0*4+0],M=t[0*4+1],y=t[0*4+2],s=t[0*4+3],r=t[2*4+0],d=t[2*4+1],p=t[2*4+2],m=t[2*4+3],D=Math.cos(c),v=Math.sin(c);return e[0]=D*a-v*r,e[1]=D*M-v*d,e[2]=D*y-v*p,e[3]=D*s-v*m,e[8]=D*r+v*a,e[9]=D*d+v*M,e[10]=D*p+v*y,e[11]=D*m+v*s,t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function F(t,c){let n=c??new u(16),e=Math.cos(t),a=Math.sin(t);return n[0]=e,n[1]=a,n[2]=0,n[3]=0,n[4]=-a,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function L(t,c,n){let e=n??new u(16),a=t[0*4+0],M=t[0*4+1],y=t[0*4+2],s=t[0*4+3],r=t[1*4+0],d=t[1*4+1],p=t[1*4+2],m=t[1*4+3],D=Math.cos(c),v=Math.sin(c);return e[0]=D*a+v*r,e[1]=D*M+v*d,e[2]=D*y+v*p,e[3]=D*s+v*m,e[4]=D*r-v*a,e[5]=D*d-v*M,e[6]=D*p-v*y,e[7]=D*m-v*s,t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function H(t,c,n){let e=n??new u(16),a=t[0],M=t[1],y=t[2],s=Math.sqrt(a*a+M*M+y*y);a/=s,M/=s,y/=s;let r=a*a,d=M*M,p=y*y,m=Math.cos(c),D=Math.sin(c),v=1-m;return e[0]=r+(1-r)*m,e[1]=a*M*v+y*D,e[2]=a*y*v-M*D,e[3]=0,e[4]=a*M*v-y*D,e[5]=d+(1-d)*m,e[6]=M*y*v+a*D,e[7]=0,e[8]=a*y*v+M*D,e[9]=M*y*v-a*D,e[10]=p+(1-p)*m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}let x=H;function A(t,c,n,e){let a=e??new u(16),M=c[0],y=c[1],s=c[2],r=Math.sqrt(M*M+y*y+s*s);M/=r,y/=r,s/=r;let d=M*M,p=y*y,m=s*s,D=Math.cos(n),v=Math.sin(n),I=1-D,V=d+(1-d)*D,T=M*y*I+s*v,b=M*s*I-y*v,_=M*y*I-s*v,k=p+(1-p)*D,C=y*s*I+M*v,at=M*s*I+y*v,ft=y*s*I-M*v,ht=m+(1-m)*D,Mt=t[0],xt=t[1],gt=t[2],mt=t[3],Dt=t[4],At=t[5],Pt=t[6],Gt=t[7],Bt=t[8],bt=t[9],qt=t[10],It=t[11];return a[0]=V*Mt+T*Dt+b*Bt,a[1]=V*xt+T*At+b*bt,a[2]=V*gt+T*Pt+b*qt,a[3]=V*mt+T*Gt+b*It,a[4]=_*Mt+k*Dt+C*Bt,a[5]=_*xt+k*At+C*bt,a[6]=_*gt+k*Pt+C*qt,a[7]=_*mt+k*Gt+C*It,a[8]=at*Mt+ft*Dt+ht*Bt,a[9]=at*xt+ft*At+ht*bt,a[10]=at*gt+ft*Pt+ht*qt,a[11]=at*mt+ft*Gt+ht*It,t!==a&&(a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a}let o=A;function i(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function l(t,c,n){let e=n??new u(16),a=c[0],M=c[1],y=c[2];return e[0]=a*t[0*4+0],e[1]=a*t[0*4+1],e[2]=a*t[0*4+2],e[3]=a*t[0*4+3],e[4]=M*t[1*4+0],e[5]=M*t[1*4+1],e[6]=M*t[1*4+2],e[7]=M*t[1*4+3],e[8]=y*t[2*4+0],e[9]=y*t[2*4+1],e[10]=y*t[2*4+2],e[11]=y*t[2*4+3],t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function w(t,c){let n=c??new u(16);return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function G(t,c,n){let e=n??new u(16);return e[0]=c*t[0*4+0],e[1]=c*t[0*4+1],e[2]=c*t[0*4+2],e[3]=c*t[0*4+3],e[4]=c*t[1*4+0],e[5]=c*t[1*4+1],e[6]=c*t[1*4+2],e[7]=c*t[1*4+3],e[8]=c*t[2*4+0],e[9]=c*t[2*4+1],e[10]=c*t[2*4+2],e[11]=c*t[2*4+3],t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}return{create:B,set:E,fromMat3:U,fromQuat:R,negate:tt,copy:J,clone:j,equalsApproximately:it,equals:st,identity:nt,transpose:Et,inverse:rt,determinant:vt,invert:dt,multiply:pt,mul:ut,setTranslation:ct,getTranslation:et,getAxis:wt,setAxis:St,getScaling:Ut,perspective:Ft,perspectiveReverseZ:zt,ortho:Tt,frustum:lt,frustumReverseZ:Lt,aim:h,cameraAim:P,lookAt:g,translation:S,translate:q,rotationX:z,rotateX:N,rotationY:O,rotateY:X,rotationZ:F,rotateZ:L,axisRotation:H,rotation:x,axisRotate:A,rotate:o,scaling:i,scale:l,uniformScaling:w,uniformScale:G}}var gn=new Map;function Ln(u){let f=gn.get(u);return f||(f=Fn(u),gn.set(u,f)),f}function Rn(u){let f=Ct(u);function B(x,A,o,i){let l=new u(4);return x!==void 0&&(l[0]=x,A!==void 0&&(l[1]=A,o!==void 0&&(l[2]=o,i!==void 0&&(l[3]=i)))),l}let E=B;function U(x,A,o,i,l){let w=l??new u(4);return w[0]=x,w[1]=A,w[2]=o,w[3]=i,w}function R(x,A,o){let i=o??new u(4),l=A*.5,w=Math.sin(l);return i[0]=w*x[0],i[1]=w*x[1],i[2]=w*x[2],i[3]=Math.cos(l),i}function tt(x,A){let o=A??f.create(3),i=Math.acos(x[3])*2,l=Math.sin(i*.5);return l>W?(o[0]=x[0]/l,o[1]=x[1]/l,o[2]=x[2]/l):(o[0]=1,o[1]=0,o[2]=0),{angle:i,axis:o}}function J(x,A){let o=lt(x,A);return Math.acos(2*o*o-1)}function j(x,A,o){let i=o??new u(4),l=x[0],w=x[1],G=x[2],t=x[3],c=A[0],n=A[1],e=A[2],a=A[3];return i[0]=l*a+t*c+w*e-G*n,i[1]=w*a+t*n+G*c-l*e,i[2]=G*a+t*e+l*n-w*c,i[3]=t*a-l*c-w*n-G*e,i}let it=j;function st(x,A,o){let i=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return i[0]=w*e+c*n,i[1]=G*e+t*n,i[2]=t*e-G*n,i[3]=c*e-w*n,i}function nt(x,A,o){let i=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return i[0]=w*e-t*n,i[1]=G*e+c*n,i[2]=t*e+w*n,i[3]=c*e-G*n,i}function Et(x,A,o){let i=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return i[0]=w*e+G*n,i[1]=G*e-w*n,i[2]=t*e+c*n,i[3]=c*e-t*n,i}function rt(x,A,o,i){let l=i??new u(4),w=x[0],G=x[1],t=x[2],c=x[3],n=A[0],e=A[1],a=A[2],M=A[3],y=w*n+G*e+t*a+c*M;y<0&&(y=-y,n=-n,e=-e,a=-a,M=-M);let s,r;if(1-y>W){let d=Math.acos(y),p=Math.sin(d);s=Math.sin((1-o)*d)/p,r=Math.sin(o*d)/p}else s=1-o,r=o;return l[0]=s*w+r*n,l[1]=s*G+r*e,l[2]=s*t+r*a,l[3]=s*c+r*M,l}function vt(x,A){let o=A??new u(4),i=x[0],l=x[1],w=x[2],G=x[3],t=i*i+l*l+w*w+G*G,c=t?1/t:0;return o[0]=-i*c,o[1]=-l*c,o[2]=-w*c,o[3]=G*c,o}function dt(x,A){let o=A??new u(4);return o[0]=-x[0],o[1]=-x[1],o[2]=-x[2],o[3]=x[3],o}function pt(x,A){let o=A??new u(4),i=x[0]+x[5]+x[10];if(i>0){let l=Math.sqrt(i+1);o[3]=.5*l;let w=.5/l;o[0]=(x[6]-x[9])*w,o[1]=(x[8]-x[2])*w,o[2]=(x[1]-x[4])*w}else{let l=0;x[5]>x[0]&&(l=1),x[10]>x[l*4+l]&&(l=2);let w=(l+1)%3,G=(l+2)%3,t=Math.sqrt(x[l*4+l]-x[w*4+w]-x[G*4+G]+1);o[l]=.5*t;let c=.5/t;o[3]=(x[w*4+G]-x[G*4+w])*c,o[w]=(x[w*4+l]+x[l*4+w])*c,o[G]=(x[G*4+l]+x[l*4+G])*c}return o}function ut(x,A,o,i,l){let w=l??new u(4),G=x*.5,t=A*.5,c=o*.5,n=Math.sin(G),e=Math.cos(G),a=Math.sin(t),M=Math.cos(t),y=Math.sin(c),s=Math.cos(c);switch(i){case"xyz":w[0]=n*M*s+e*a*y,w[1]=e*a*s-n*M*y,w[2]=e*M*y+n*a*s,w[3]=e*M*s-n*a*y;break;case"xzy":w[0]=n*M*s-e*a*y,w[1]=e*a*s-n*M*y,w[2]=e*M*y+n*a*s,w[3]=e*M*s+n*a*y;break;case"yxz":w[0]=n*M*s+e*a*y,w[1]=e*a*s-n*M*y,w[2]=e*M*y-n*a*s,w[3]=e*M*s+n*a*y;break;case"yzx":w[0]=n*M*s+e*a*y,w[1]=e*a*s+n*M*y,w[2]=e*M*y-n*a*s,w[3]=e*M*s-n*a*y;break;case"zxy":w[0]=n*M*s-e*a*y,w[1]=e*a*s+n*M*y,w[2]=e*M*y+n*a*s,w[3]=e*M*s-n*a*y;break;case"zyx":w[0]=n*M*s-e*a*y,w[1]=e*a*s+n*M*y,w[2]=e*M*y-n*a*s,w[3]=e*M*s+n*a*y;break;default:throw new Error(`Unknown rotation order: ${i}`)}return w}function ct(x,A){let o=A??new u(4);return o[0]=x[0],o[1]=x[1],o[2]=x[2],o[3]=x[3],o}let et=ct;function wt(x,A,o){let i=o??new u(4);return i[0]=x[0]+A[0],i[1]=x[1]+A[1],i[2]=x[2]+A[2],i[3]=x[3]+A[3],i}function St(x,A,o){let i=o??new u(4);return i[0]=x[0]-A[0],i[1]=x[1]-A[1],i[2]=x[2]-A[2],i[3]=x[3]-A[3],i}let Ut=St;function Ft(x,A,o){let i=o??new u(4);return i[0]=x[0]*A,i[1]=x[1]*A,i[2]=x[2]*A,i[3]=x[3]*A,i}let zt=Ft;function Tt(x,A,o){let i=o??new u(4);return i[0]=x[0]/A,i[1]=x[1]/A,i[2]=x[2]/A,i[3]=x[3]/A,i}function lt(x,A){return x[0]*A[0]+x[1]*A[1]+x[2]*A[2]+x[3]*A[3]}function Lt(x,A,o,i){let l=i??new u(4);return l[0]=x[0]+o*(A[0]-x[0]),l[1]=x[1]+o*(A[1]-x[1]),l[2]=x[2]+o*(A[2]-x[2]),l[3]=x[3]+o*(A[3]-x[3]),l}function Y(x){let A=x[0],o=x[1],i=x[2],l=x[3];return Math.sqrt(A*A+o*o+i*i+l*l)}let Q=Y;function $(x){let A=x[0],o=x[1],i=x[2],l=x[3];return A*A+o*o+i*i+l*l}let h=$;function P(x,A){let o=A??new u(4),i=x[0],l=x[1],w=x[2],G=x[3],t=Math.sqrt(i*i+l*l+w*w+G*G);return t>1e-5?(o[0]=i/t,o[1]=l/t,o[2]=w/t,o[3]=G/t):(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function g(x,A){return Math.abs(x[0]-A[0])<W&&Math.abs(x[1]-A[1])<W&&Math.abs(x[2]-A[2])<W&&Math.abs(x[3]-A[3])<W}function S(x,A){return x[0]===A[0]&&x[1]===A[1]&&x[2]===A[2]&&x[3]===A[3]}function q(x){let A=x??new u(4);return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A}let z=f.create(),N=f.create(),O=f.create();function X(x,A,o){let i=o??new u(4),l=f.dot(x,A);return l<-.999999?(f.cross(N,x,z),f.len(z)<1e-6&&f.cross(O,x,z),f.normalize(z,z),R(z,Math.PI,i),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(f.cross(x,A,z),i[0]=z[0],i[1]=z[1],i[2]=z[2],i[3]=1+l,P(i,i))}let F=new u(4),L=new u(4);function H(x,A,o,i,l,w){let G=w??new u(4);return rt(x,i,l,F),rt(A,o,l,L),rt(F,L,2*l*(1-l),G),G}return{create:B,fromValues:E,set:U,fromAxisAngle:R,toAxisAngle:tt,angle:J,multiply:j,mul:it,rotateX:st,rotateY:nt,rotateZ:Et,slerp:rt,inverse:vt,conjugate:dt,fromMat:pt,fromEuler:ut,copy:ct,clone:et,add:wt,subtract:St,sub:Ut,mulScalar:Ft,scale:zt,divScalar:Tt,dot:lt,lerp:Lt,length:Y,len:Q,lengthSq:$,lenSq:h,normalize:P,equalsApproximately:g,equals:S,identity:q,rotationTo:X,sqlerp:H}}var mn=new Map;function Vn(u){let f=mn.get(u);return f||(f=Rn(u),mn.set(u,f)),f}function Nn(u){function f(o,i,l,w){let G=new u(4);return o!==void 0&&(G[0]=o,i!==void 0&&(G[1]=i,l!==void 0&&(G[2]=l,w!==void 0&&(G[3]=w)))),G}let B=f;function E(o,i,l,w,G){let t=G??new u(4);return t[0]=o,t[1]=i,t[2]=l,t[3]=w,t}function U(o,i){let l=i??new u(4);return l[0]=Math.ceil(o[0]),l[1]=Math.ceil(o[1]),l[2]=Math.ceil(o[2]),l[3]=Math.ceil(o[3]),l}function R(o,i){let l=i??new u(4);return l[0]=Math.floor(o[0]),l[1]=Math.floor(o[1]),l[2]=Math.floor(o[2]),l[3]=Math.floor(o[3]),l}function tt(o,i){let l=i??new u(4);return l[0]=Math.round(o[0]),l[1]=Math.round(o[1]),l[2]=Math.round(o[2]),l[3]=Math.round(o[3]),l}function J(o,i=0,l=1,w){let G=w??new u(4);return G[0]=Math.min(l,Math.max(i,o[0])),G[1]=Math.min(l,Math.max(i,o[1])),G[2]=Math.min(l,Math.max(i,o[2])),G[3]=Math.min(l,Math.max(i,o[3])),G}function j(o,i,l){let w=l??new u(4);return w[0]=o[0]+i[0],w[1]=o[1]+i[1],w[2]=o[2]+i[2],w[3]=o[3]+i[3],w}function it(o,i,l,w){let G=w??new u(4);return G[0]=o[0]+i[0]*l,G[1]=o[1]+i[1]*l,G[2]=o[2]+i[2]*l,G[3]=o[3]+i[3]*l,G}function st(o,i,l){let w=l??new u(4);return w[0]=o[0]-i[0],w[1]=o[1]-i[1],w[2]=o[2]-i[2],w[3]=o[3]-i[3],w}let nt=st;function Et(o,i){return Math.abs(o[0]-i[0])<W&&Math.abs(o[1]-i[1])<W&&Math.abs(o[2]-i[2])<W&&Math.abs(o[3]-i[3])<W}function rt(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]}function vt(o,i,l,w){let G=w??new u(4);return G[0]=o[0]+l*(i[0]-o[0]),G[1]=o[1]+l*(i[1]-o[1]),G[2]=o[2]+l*(i[2]-o[2]),G[3]=o[3]+l*(i[3]-o[3]),G}function dt(o,i,l,w){let G=w??new u(4);return G[0]=o[0]+l[0]*(i[0]-o[0]),G[1]=o[1]+l[1]*(i[1]-o[1]),G[2]=o[2]+l[2]*(i[2]-o[2]),G[3]=o[3]+l[3]*(i[3]-o[3]),G}function pt(o,i,l){let w=l??new u(4);return w[0]=Math.max(o[0],i[0]),w[1]=Math.max(o[1],i[1]),w[2]=Math.max(o[2],i[2]),w[3]=Math.max(o[3],i[3]),w}function ut(o,i,l){let w=l??new u(4);return w[0]=Math.min(o[0],i[0]),w[1]=Math.min(o[1],i[1]),w[2]=Math.min(o[2],i[2]),w[3]=Math.min(o[3],i[3]),w}function ct(o,i,l){let w=l??new u(4);return w[0]=o[0]*i,w[1]=o[1]*i,w[2]=o[2]*i,w[3]=o[3]*i,w}let et=ct;function wt(o,i,l){let w=l??new u(4);return w[0]=o[0]/i,w[1]=o[1]/i,w[2]=o[2]/i,w[3]=o[3]/i,w}function St(o,i){let l=i??new u(4);return l[0]=1/o[0],l[1]=1/o[1],l[2]=1/o[2],l[3]=1/o[3],l}let Ut=St;function Ft(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]}function zt(o){let i=o[0],l=o[1],w=o[2],G=o[3];return Math.sqrt(i*i+l*l+w*w+G*G)}let Tt=zt;function lt(o){let i=o[0],l=o[1],w=o[2],G=o[3];return i*i+l*l+w*w+G*G}let Lt=lt;function Y(o,i){let l=o[0]-i[0],w=o[1]-i[1],G=o[2]-i[2],t=o[3]-i[3];return Math.sqrt(l*l+w*w+G*G+t*t)}let Q=Y;function $(o,i){let l=o[0]-i[0],w=o[1]-i[1],G=o[2]-i[2],t=o[3]-i[3];return l*l+w*w+G*G+t*t}let h=$;function P(o,i){let l=i??new u(4),w=o[0],G=o[1],t=o[2],c=o[3],n=Math.sqrt(w*w+G*G+t*t+c*c);return n>1e-5?(l[0]=w/n,l[1]=G/n,l[2]=t/n,l[3]=c/n):(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function g(o,i){let l=i??new u(4);return l[0]=-o[0],l[1]=-o[1],l[2]=-o[2],l[3]=-o[3],l}function S(o,i){let l=i??new u(4);return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l}let q=S;function z(o,i,l){let w=l??new u(4);return w[0]=o[0]*i[0],w[1]=o[1]*i[1],w[2]=o[2]*i[2],w[3]=o[3]*i[3],w}let N=z;function O(o,i,l){let w=l??new u(4);return w[0]=o[0]/i[0],w[1]=o[1]/i[1],w[2]=o[2]/i[2],w[3]=o[3]/i[3],w}let X=O;function F(o){let i=o??new u(4);return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i}function L(o,i,l){let w=l??new u(4),G=o[0],t=o[1],c=o[2],n=o[3];return w[0]=i[0]*G+i[4]*t+i[8]*c+i[12]*n,w[1]=i[1]*G+i[5]*t+i[9]*c+i[13]*n,w[2]=i[2]*G+i[6]*t+i[10]*c+i[14]*n,w[3]=i[3]*G+i[7]*t+i[11]*c+i[15]*n,w}function H(o,i,l){let w=l??new u(4);return P(o,w),ct(w,i,w)}function x(o,i,l){let w=l??new u(4);return zt(o)>i?H(o,i,w):S(o,w)}function A(o,i,l){let w=l??new u(4);return vt(o,i,.5,w)}return{create:f,fromValues:B,set:E,ceil:U,floor:R,round:tt,clamp:J,add:j,addScaled:it,subtract:st,sub:nt,equalsApproximately:Et,equals:rt,lerp:vt,lerpV:dt,max:pt,min:ut,mulScalar:ct,scale:et,divScalar:wt,inverse:St,invert:Ut,dot:Ft,length:zt,len:Tt,lengthSq:lt,lenSq:Lt,distance:Y,dist:Q,distanceSq:$,distSq:h,normalize:P,negate:g,copy:S,clone:q,multiply:z,mul:N,divide:O,div:X,zero:F,transformMat4:L,setLength:H,truncate:x,midpoint:A}}var Dn=new Map;function On(u){let f=Dn.get(u);return f||(f=Nn(u),Dn.set(u,f)),f}function tn(u,f,B,E,U,R){return{mat4:Ln(u),mat3:qn(f),quat:Vn(B),vec2:yn(E),vec3:Ct(U),vec4:On(R)}}var{mat4:Qt,mat3:kn,quat:Yn,vec2:vn,vec3:ot,vec4:Sn}=tn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array),{mat4:Hn,mat3:Zn,quat:Qn,vec2:Jn,vec3:Kn,vec4:jn}=tn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),{mat4:Cn,mat3:te,quat:ne,vec2:ee,vec3:se,vec4:ce}=tn(zn,Array,Array,Array,Array,Array);function An(u,f,B){return u<f?f:u>B?B:u}function Pn(u){return u===" "||u==="\r"}var Ot=class u{file="";contents="";end=0;line=1;static async load(f){let B=new u;B.file=f,B.contents=await fetch(f).then(U=>U.text());let E={vertices:[],normals:[],texcoords:[],faces:[]};for(;!B.atEnd();)B.scanNext(E);return E}atEnd(){return this.end===this.contents.length}next(){this.atEnd()||this.end++}peek(){return this.contents[this.end]}expect(f){if(this.atEnd())throw`expected '${f}' on line ${this.line}`;let B=this.contents[this.end];if(B!==f)throw`expected '${f}' on line ${this.line} got '${B}'`;this.next()}skipWhitespace(){for(;!this.atEnd()&&Pn(this.peek());)this.next()}seekToEndOfLine(){for(;!this.atEnd()&&this.peek()!==`
`;)this.next();this.next(),this.line++}scanToken(){let f=this.end;for(;!this.atEnd();){let B=this.peek();if(Pn(B)||B===`
`)break;this.next()}return this.contents.substring(f,this.end)}scanNumber(){this.skipWhitespace();let f=this.end;for(;!this.atEnd();){let E=this.peek();if(!(E==="-"||E==="."||E>="0"&&E<="9"||E==="E"||E==="e"))break;this.next()}let B=this.contents.substring(f,this.end);return Number.parseFloat(B)}scanVertex(f){f.vertices.push(this.scanNumber()),f.vertices.push(this.scanNumber()),f.vertices.push(this.scanNumber())}scanVertexNormal(f){f.normals.push(this.scanNumber()),f.normals.push(this.scanNumber()),f.normals.push(this.scanNumber())}scanVertexTexture(f){f.texcoords.push(this.scanNumber()),f.texcoords.push(this.scanNumber())}scanTriple(f){f.faces.push(this.scanNumber()),this.expect("/"),f.faces.push(this.scanNumber()),this.expect("/"),f.faces.push(this.scanNumber())}scanFace(f){if(this.scanTriple(f),this.scanTriple(f),this.scanTriple(f),this.peek()==="\r"&&this.next(),this.peek()!==`
`){let B=f.faces.length-9;f.faces.push(f.faces[B+0]),f.faces.push(f.faces[B+1]),f.faces.push(f.faces[B+2]),f.faces.push(f.faces[B+6]),f.faces.push(f.faces[B+7]),f.faces.push(f.faces[B+8]),this.scanTriple(f)}}scanNext(f){if(this.atEnd())return;this.skipWhitespace();let B=this.scanToken();if(this.next(),B===""){this.line++;return}switch(B){case"#":break;case"v":this.scanVertex(f);break;case"vn":this.scanVertexNormal(f);break;case"vt":this.scanVertexTexture(f);break;case"f":this.scanFace(f);break;case"g":break;case"o":break;case"s":break;case"usemtl":break;case"mtllib":break;default:throw B.length===1?`unknown token '${B}' (${B.charCodeAt(0)}) on line ${this.line} in ${this.file}`:`unknown token '${B}' on line ${this.line} in ${this.file}`}this.seekToEndOfLine()}};var Gn=`struct VertexOut {
  @builtin(position) position: vec4f,
  @location(0) m: vec2f,
  @location(1) nw: vec2f,
  @location(2) ne: vec2f,
  @location(3) sw: vec2f,
  @location(4) se: vec2f,
}

@group(0) @binding(0) var<uniform> u: Uniforms;
@group(0) @binding(1) var surface: texture_2d<f32>;
@group(0) @binding(2) var surfaceSampler: sampler;

@vertex fn vp(@builtin(vertex_index) i: u32) -> VertexOut {
  var out: VertexOut;

  let uv = vec2f(vec2(i & 2, (i << 1) & 2));
  out.position = vec4f(uv * vec2f(2, -2) + vec2f(-1, 1), 0, 1);

  let texel = uv * u.screenResolution;
  out.nw = (texel + vec2f(-1, -1)) / u.screenResolution;
  out.ne = (texel + vec2f(1, -1)) / u.screenResolution;
  out.sw = (texel + vec2f(-1, 1)) / u.screenResolution;
  out.se = (texel + vec2f(1, 1)) / u.screenResolution;
  out.m = uv;

  return out;
}

@fragment fn fp(in: VertexOut) -> @location(0) vec4f {
  let FXAA_REDUCE_MIN = 1.0 / 128.0;
  let FXAA_REDUCE_MUL = 1.0 / 8.0;
  let FXAA_SPAN_MAX = 8.0;

  let luma = vec3f(0.299, 0.587, 0.114);

  let lumaNW = dot(textureSample(surface, surfaceSampler, in.nw).xyz, luma);
  let lumaNE = dot(textureSample(surface, surfaceSampler, in.ne).xyz, luma);
  let lumaSW = dot(textureSample(surface, surfaceSampler, in.sw).xyz, luma);
  let lumaSE = dot(textureSample(surface, surfaceSampler, in.se).xyz, luma);
  let lumaM = dot(textureSample(surface, surfaceSampler, in.m).xyz, luma);

  var dir: vec2f;
  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
  dir.y = (lumaNW + lumaSW) - (lumaNE + lumaSE);

  let reduce = max(FXAA_REDUCE_MIN, (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL));

  var rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + reduce);
  dir = max(vec2f(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin);
  dir = min(vec2f(FXAA_SPAN_MAX, FXAA_SPAN_MAX), dir);
  dir /= u.screenResolution;

  let lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
  let lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

  var rgbA = textureSample(surface, surfaceSampler, in.m + dir * (1.0 / 3.0 - 0.5)).xyz;
  rgbA += textureSample(surface, surfaceSampler, in.m + dir * (2.0 / 3.0 - 0.5)).xyz;
  rgbA *= 0.5;

  var rgbB = textureSample(surface, surfaceSampler, in.m + dir * -0.5).xyz;
  rgbB += textureSample(surface, surfaceSampler, in.m + dir * 0.5).xyz;
  rgbB = rgbA * 0.5 + 0.25 * rgbB;

  var lumaB = dot(rgbB, luma);
  if (lumaB < lumaMin || lumaB > lumaMax) {
    return vec4f(rgbA, 1.0);
  } else {
    return vec4f(rgbB, 1.0);
  }
}
`;var Bn=`struct VertexIn {
  @builtin(instance_index) instance: u32,
  @location(0) position: vec3f,
  @location(1) normal: vec3f,
  @location(2) texcoord: vec2f,
}

struct VertexOut {
  @builtin(position) position: vec4f,
  @location(0) normal: vec3f,
  @location(1) texcoord: vec2f,
  @location(2) @interpolate(flat) instance: u32,
}

@group(0) @binding(0) var<uniform> u: Uniforms;
@group(0) @binding(1) var<uniform> shellCount: f32;

fn random(uv: vec2f) -> f32 {
  return fract(sin(dot(uv.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

fn steepCos(angle: f32, slope: f32) -> f32 {
  return atan(slope * cos(angle)) / atan(slope);
}

@vertex fn vp(in: VertexIn) -> VertexOut {
  var out: VertexOut;

  let scale = 1 + f32(in.instance) * 0.001;
  let height = f32(in.instance) / shellCount;
  let position = in.position * scale + vec3f(0, -height * 0.02, 0);

  out.position = u.cameraProjection * u.cameraView * vec4f(position, 1);
  out.normal = in.normal;
  out.texcoord = in.texcoord;
  out.instance = in.instance;
  return out;
}

@fragment fn fp(in: VertexOut) -> @location(0) vec4f {
  let uv = in.texcoord * 256;

  let height = f32(in.instance) / shellCount;

  let cell = floor(uv);
  let local = (uv - cell) * 2 - 1;
  if ((random(cell) - height) * 4 < length(local)) {
    discard;
  }

  let light = normalize(vec3f(1, 1, 0));

  let ambient = 0.4;
  let diffuse = dot(light, in.normal) * 0.5 + 0.5;
  let lighting = vec3f((ambient + diffuse) * height);

  let yellow = steepCos(in.texcoord.y * 14, 2) * 0.5 + 0.5;
  let color = mix(vec3f(0.25, 0.15, 0.0), vec3f(1, 0.8, 0.1), yellow);

  return vec4f(color * lighting, 1);
}
`;var Kt=Math.PI/180,$n=2,Vt=4,En=4*Vt,nn=16*Vt,K,Wt,Jt,Nt,fn,jt,Rt={},Z={x:0,y:0,prevX:0,prevY:0,deltaX:0,deltaY:0,button0:!1,button1:!1,button2:!1,wheel:0};addEventListener("keydown",u=>{Rt[u.code]=!0});addEventListener("keyup",u=>{Rt[u.code]=!1});addEventListener("mousedown",u=>{u.button===0?Z.button0=!0:u.button===1?Z.button1=!0:u.button===2&&(Z.button2=!0)});addEventListener("mouseup",u=>{u.button===0?Z.button0=!1:u.button===1?Z.button1=!1:u.button===2&&(Z.button2=!1)});addEventListener("wheel",u=>{Z.wheel=u.deltaY});addEventListener("mousemove",u=>{Z.x=u.clientX,Z.y=u.clientY});var en=class{yaw;pitch=0;front=ot.create();right=ot.create();up=ot.create();positionA;positionB;constructor(f,B){this.positionA=ot.clone(f),this.positionB=ot.clone(f),this.yaw=B}update(){Z.button0&&(this.yaw+=Z.deltaX*.005,this.pitch-=Z.deltaY*.005,this.pitch=An(this.pitch,-85*Kt,85*Kt)),this.front[0]=Math.cos(this.yaw)*Math.cos(this.pitch),this.front[1]=Math.sin(this.pitch),this.front[2]=Math.sin(this.yaw)*Math.cos(this.pitch),ot.normalize(this.front,this.front),ot.normalize(ot.cross(this.front,ot.create(0,1,0)),this.right),ot.normalize(ot.cross(this.right,this.front),this.up);let f=0,B=0,E=0,U;Rt.ShiftLeft?U=.1:U=.03,Rt.KeyW&&(f-=U),Rt.KeyS&&(f+=U),Rt.KeyA&&(B+=U),Rt.KeyD&&(B-=U),Rt.KeyQ&&(E+=U),(Rt.KeyE||Rt.Space)&&(E-=U),ot.add(this.positionB,ot.mulScalar(this.front,-f),this.positionB),ot.add(this.positionB,ot.mulScalar(ot.normalize(ot.cross(this.front,this.up)),-B),this.positionB),this.positionB[1]-=E,ot.lerp(this.positionA,this.positionB,.2,this.positionA)}view(f){return Qt.lookAt(this.positionA,ot.add(this.positionA,this.front),this.up,f)}},sn=class u{vbuf;ibuf;indexCount;constructor(f){let B=new Map,E=[],U=[];for(let R=0;R<f.faces.length;R+=3){let tt=f.faces[R+0],J=f.faces[R+1],j=f.faces[R+2],it=(BigInt(j)<<32n|BigInt(J)<<16n|BigInt(tt)).toString(),st=B.get(it);if(st!==void 0)U.push(st);else{console.assert(E.length%8===0);let nt=E.length/8;B.set(it,nt),U.push(nt),E.push(f.vertices[(tt-1)*3+0]),E.push(f.vertices[(tt-1)*3+1]),E.push(f.vertices[(tt-1)*3+2]),E.push(f.normals[(j-1)*3+0]),E.push(f.normals[(j-1)*3+1]),E.push(f.normals[(j-1)*3+2]),E.push(f.texcoords[(J-1)*2+0]),E.push(f.texcoords[(J-1)*2+1])}}if(this.vbuf=K.createBuffer({size:E.length*Vt,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),K.queue.writeBuffer(this.vbuf,0,new Float32Array(E),0,E.length),U.length%4!==0)for(console.warn("model indices aren't a multiple of 4");U.length%4!==0;)U.push(0);this.ibuf=K.createBuffer({size:U.length*$n,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),K.queue.writeBuffer(this.ibuf,0,new Uint16Array(U),0,U.length),this.indexCount=U.length}static async load(f){let B=await Ot.load(f);return new u(B)}draw(f,B){f.setVertexBuffer(0,this.vbuf),f.setIndexBuffer(this.ibuf,"uint16"),f.drawIndexed(this.indexCount,B)}},cn=class u{constructor(f){this.canvas=f;this.context2D=f.getContext("2d")}beginTime=0;prevTime=0;frame=0;textY=0;canvasWidth=0;context2D;static FONT_SIZE=13;beginFrame(f){this.prevTime=this.beginTime,this.beginTime=f}endFrame(){let f=Math.round(this.canvasWidth)+8,B=this.textY+8;(f!==this.canvas.width||B!==this.canvas.height)&&(this.canvas.width=f,this.canvas.height=B),this.canvasWidth=100,this.textY=0,this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2D.globalAlpha=.5,this.context2D.fillStyle="white",this.context2D.fillRect(0,0,this.canvas.width,this.canvas.height),this.context2D.globalAlpha=1,this.context2D.fillStyle="black",this.context2D.font=`bold ${u.FONT_SIZE}px monospace`,this.frame++,this.draw(`frame: ${this.frame}`);let E=this.beginTime-this.prevTime,U=1/E*1e3;this.draw(`ms/frame: ${E.toFixed(2)}ms (${Math.round(U)}fps)`);let R=performance.now()-this.beginTime,tt=1/R*1e3;if(this.draw(`cpu: ${R.toFixed(2)}ms (${Math.round(tt)}fps)`),Nt!==void 0){let it=Nt.avg/1e3/1e3,st=1/it*1e3;this.draw(`gpu: ${it.toFixed(2)}ms (${Math.round(st)}fps)`)}let J=0,{memory:j}=performance;j!==void 0&&(J=j.usedJSHeapSize/1024/1024),J!==0&&this.draw(`mem: ${J.toFixed(2)}mb`)}draw(f){this.textY+=u.FONT_SIZE,this.context2D.fillText(f,5,this.textY),this.canvasWidth=Math.max(this.canvasWidth,this.context2D.measureText(f).width+5)}},on=class u{index=0;querySet;resolve;result;avg=0;static MAX_QUERIES=64;constructor(){this.querySet=K.createQuerySet({type:"timestamp",count:2*u.MAX_QUERIES}),this.resolve=K.createBuffer({size:this.querySet.count*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.result=K.createBuffer({size:this.querySet.count*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}record(){console.assert(this.index<u.MAX_QUERIES);let f={querySet:this.querySet,beginningOfPassWriteIndex:this.index,endOfPassWriteIndex:this.index+1};return this.index+=2,f}endFrame(f){this.result.mapState==="unmapped"&&(f.resolveQuerySet(this.querySet,0,this.querySet.count,this.resolve,0),f.copyBufferToBuffer(this.resolve,0,this.result,0,this.result.size))}async measure(){if(this.result.mapState!=="unmapped")return;await this.result.mapAsync(GPUMapMode.READ);let f=0,B=new BigInt64Array(this.result.getMappedRange());for(let U=0;U<this.index;U+=2){let R=B[U+0],tt=B[U+1];f+=Number(tt-R)}this.result.unmap();let E=this.index/2;this.index=0,E>0&&(this.avg=f/E)}},rn=class u{bindGroupLayouts=new Map;bindGroups=[];samplers=[];hit=0;miss=0;step(){let f=0;for(;f<this.bindGroups.length;)this.bindGroups[f].lifetime--,this.bindGroups[f].lifetime===0?(this.bindGroups[f]=this.bindGroups[this.bindGroups.length-1],this.bindGroups.pop()):f++}getBindGroupLayout(f,B){let E=this.bindGroupLayouts.get(f);if(E===void 0){let R=f.getBindGroupLayout(B);return this.bindGroupLayouts.set(f,[R]),this.miss++,R}let U=E[B];if(U===void 0){let R=f.getBindGroupLayout(B);return E[B]=R,this.miss++,R}return this.hit++,U}createBindGroup(f){for(let U of this.bindGroups)if(u.sameBindGroup(U.descriptor,f))return this.hit++,U.resource;let E=K.createBindGroup(f);return this.bindGroups.push({resource:E,descriptor:f,lifetime:4}),this.miss++,E}static sameBindGroup(f,B){console.assert(f.layout===B.layout);let E=f.entries,U=B.entries;if(E.length!==U.length)return!1;for(let R=0;R<E.length;R++)if(!u.sameBindGroupEntry(E[R],U[R]))return!1;return!0}static sameBindGroupEntry(f,B){if(f.binding!==B.binding)return!1;if(f.resource!==B.resource){if(!f.resource.hasOwnProperty("buffer")||!B.resource.hasOwnProperty("buffer"))return!1;let E=f.resource,U=B.resource;if(E.buffer!==U.buffer||E.offset!==U.offset||E.size!==U.size)return!1}return!0}createSampler(f){for(let E of this.samplers)if(u.sameSampler(E.descriptor,f))return this.hit++,E.resource;let B=K.createSampler(f);return this.samplers.push({resource:B,descriptor:f}),this.miss++,B}static sameSampler(f,B){return f.addressModeU===B.addressModeU&&f.addressModeV===B.addressModeV&&f.addressModeW===B.addressModeW&&f.magFilter===B.magFilter&&f.minFilter===B.minFilter&&f.mipmapFilter===B.mipmapFilter&&f.lodMinClamp===B.lodMinClamp&&f.lodMaxClamp===B.lodMaxClamp&&f.compare===B.compare&&f.maxAnisotropy===B.maxAnisotropy}},un=class u{pipeline;bindGroup;ubuf;static SHELL_COUNT=128;constructor(){let f=K.createShaderModule({code:fn+Bn});this.ubuf=K.createBuffer({size:En,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.pipeline=K.createRenderPipeline({layout:"auto",primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthCompare:"less",depthWriteEnabled:!0},vertex:{entryPoint:"vp",module:f,buffers:[{stepMode:"vertex",arrayStride:8*Vt,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:0,format:"float32x3"},{shaderLocation:2,offset:0,format:"float32x2"}]}]},fragment:{entryPoint:"fp",module:f,targets:[{format:Wt}]}}),this.bindGroup=K.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:jt}},{binding:1,resource:{buffer:this.ubuf}}]})}run(f,B,E,U){K.queue.writeBuffer(this.ubuf,0,Sn.create(u.SHELL_COUNT),0,4);let R=f.beginRenderPass({label:"forward rendering pass",timestampWrites:Nt?.record(),colorAttachments:[{view:B,clearValue:[.7,.8,1,1],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:E,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});R.setPipeline(this.pipeline),R.setBindGroup(0,this.bindGroup),U?.draw(R,u.SHELL_COUNT),R.end()}},an=class{pipeline;constructor(){let f=K.createShaderModule({code:fn+Gn});this.pipeline=K.createRenderPipeline({layout:"auto",primitive:{topology:"triangle-list",cullMode:"back"},vertex:{module:f,entryPoint:"vp"},fragment:{module:f,entryPoint:"fp",targets:[{format:Wt}]}})}run(f,B,E){let U=f.beginRenderPass({label:"fxaa pass",timestampWrites:Nt?.record(),colorAttachments:[{view:B,clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]});U.setPipeline(this.pipeline),U.setBindGroup(0,Jt.createBindGroup({layout:Jt.getBindGroupLayout(this.pipeline,0),entries:[{binding:0,resource:{buffer:jt}},{binding:1,resource:E},{binding:2,resource:Jt.createSampler({minFilter:"linear",magFilter:"linear"})}]})),U.draw(3),U.end()}};async function Xn(){let u,f,B;try{let ut=await navigator.gpu.requestAdapter();if(ut===null)throw"no adapter";if(u=ut,K=await u.requestDevice({requiredFeatures:["timestamp-query"]}),f=document.getElementById("canvas"),B=f.getContext("webgpu"),B===null)throw"no context"}catch{alert("Your browser doesn't support WebGPU");return}Wt=navigator.gpu.getPreferredCanvasFormat(),f.width=window.innerWidth*window.devicePixelRatio,f.height=window.innerHeight*window.devicePixelRatio,addEventListener("resize",()=>{f.width=window.innerWidth*window.devicePixelRatio,f.height=window.innerHeight*window.devicePixelRatio}),Z.prevX=f.width/2,Z.prevY=f.height/2,Z.x=Z.prevX,Z.y=Z.prevY,B.configure({device:K,format:Wt,alphaMode:"premultiplied"});let E=new cn(document.getElementById("stats"));u.features.has("timestamp-query")&&typeof K.createQuerySet=="function"&&(Nt=new on);let U=new ArrayBuffer(nn+nn+nn+En),R={model:new Float32Array(U,0,16),cameraView:new Float32Array(U,16*Vt,16),cameraProjection:new Float32Array(U,32*Vt,16),screenResolution:new Float32Array(U,48*Vt,4)};fn=`
struct Uniforms {
  model: mat4x4f,
  cameraView: mat4x4f,
  cameraProjection: mat4x4f,
  screenResolution: vec2f,
}
`,jt=K.createBuffer({size:U.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),Jt=new rn;let tt=new un,J=new an,j=new en(ot.create(0,0,3),-90*Kt),it;sn.load("data/sphere.obj").then(ut=>it=ut);let st,nt,Et,rt,vt=0,dt=0;function pt(ut){E.beginFrame(ut);let{width:ct,height:et}=f;j.update(),Z.deltaX=Z.x-Z.prevX,Z.deltaY=Z.y-Z.prevY,Z.prevX=Z.x,Z.prevY=Z.y,Z.wheel=0,Qt.identity(R.model),j.view(R.cameraView),Qt.perspective(60*Kt,ct/et,.1,50,R.cameraProjection),vn.set(ct,et,R.screenResolution),K.queue.writeBuffer(jt,0,U,0,U.byteLength),vt!==ct&&dt!==et&&(vt=ct,dt=et,st?.destroy(),st=K.createTexture({size:[ct,et,1],usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,format:Wt}),nt=st.createView(),Et=K.createTexture({size:[ct,et,1],usage:GPUTextureUsage.RENDER_ATTACHMENT,format:"depth24plus"}),rt=Et.createView());let wt=K.createCommandEncoder(),St=B.getCurrentTexture().createView();tt.run(wt,nt,rt,it),J.run(wt,St,nt),Nt?.endFrame(wt),K.queue.submit([wt.finish()]),Nt?.measure(),E.endFrame(),requestAnimationFrame(pt)}requestAnimationFrame(pt)}Xn();})();
//# sourceMappingURL=index.js.map
