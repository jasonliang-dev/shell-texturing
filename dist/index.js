(()=>{function Un(u,a){return class extends u{constructor(...E){super(...E),a(this)}}}var Bn=Un(Array,u=>u.fill(0)),_=1e-6;function zn(u){function a(t=0,c=0){let n=new u(2);return t!==void 0&&(n[0]=t,c!==void 0&&(n[1]=c)),n}let E=a;function U(t,c,n){let e=n??new u(2);return e[0]=t,e[1]=c,e}function z(t,c){let n=c??new u(2);return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n}function F(t,c){let n=c??new u(2);return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n}function C(t,c){let n=c??new u(2);return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n}function J(t,c=0,n=1,e){let f=e??new u(2);return f[0]=Math.min(n,Math.max(c,t[0])),f[1]=Math.min(n,Math.max(c,t[1])),f}function tt(t,c,n){let e=n??new u(2);return e[0]=t[0]+c[0],e[1]=t[1]+c[1],e}function ot(t,c,n,e){let f=e??new u(2);return f[0]=t[0]+c[0]*n,f[1]=t[1]+c[1]*n,f}function it(t,c){let n=t[0],e=t[1],f=c[0],M=c[1],m=Math.sqrt(n*n+e*e),s=Math.sqrt(f*f+M*M),r=m*s,d=r&&Lt(t,c)/r;return Math.acos(d)}function nt(t,c,n){let e=n??new u(2);return e[0]=t[0]-c[0],e[1]=t[1]-c[1],e}let St=nt;function rt(t,c){return Math.abs(t[0]-c[0])<_&&Math.abs(t[1]-c[1])<_}function At(t,c){return t[0]===c[0]&&t[1]===c[1]}function wt(t,c,n,e){let f=e??new u(2);return f[0]=t[0]+n*(c[0]-t[0]),f[1]=t[1]+n*(c[1]-t[1]),f}function Mt(t,c,n,e){let f=e??new u(2);return f[0]=t[0]+n[0]*(c[0]-t[0]),f[1]=t[1]+n[1]*(c[1]-t[1]),f}function zt(t,c,n){let e=n??new u(2);return e[0]=Math.max(t[0],c[0]),e[1]=Math.max(t[1],c[1]),e}function et(t,c,n){let e=n??new u(2);return e[0]=Math.min(t[0],c[0]),e[1]=Math.min(t[1],c[1]),e}function st(t,c,n){let e=n??new u(2);return e[0]=t[0]*c,e[1]=t[1]*c,e}let lt=st;function ht(t,c,n){let e=n??new u(2);return e[0]=t[0]/c,e[1]=t[1]/c,e}function Pt(t,c){let n=c??new u(2);return n[0]=1/t[0],n[1]=1/t[1],n}let ut=Pt;function Tt(t,c,n){let e=n??new u(3),f=t[0]*c[1]-t[1]*c[0];return e[0]=0,e[1]=0,e[2]=f,e}function Lt(t,c){return t[0]*c[0]+t[1]*c[1]}function dt(t){let c=t[0],n=t[1];return Math.sqrt(c*c+n*n)}let Nt=dt;function Y(t){let c=t[0],n=t[1];return c*c+n*n}let Q=Y;function $(t,c){let n=t[0]-c[0],e=t[1]-c[1];return Math.sqrt(n*n+e*e)}let h=$;function P(t,c){let n=t[0]-c[0],e=t[1]-c[1];return n*n+e*e}let g=P;function S(t,c){let n=c??new u(2),e=t[0],f=t[1],M=Math.sqrt(e*e+f*f);return M>1e-5?(n[0]=e/M,n[1]=f/M):(n[0]=0,n[1]=0),n}function q(t,c){let n=c??new u(2);return n[0]=-t[0],n[1]=-t[1],n}function B(t,c){let n=c??new u(2);return n[0]=t[0],n[1]=t[1],n}let V=B;function I(t,c,n){let e=n??new u(2);return e[0]=t[0]*c[0],e[1]=t[1]*c[1],e}let X=I;function R(t,c,n){let e=n??new u(2);return e[0]=t[0]/c[0],e[1]=t[1]/c[1],e}let N=R;function H(t=1,c){let n=c??new u(2),e=Math.random()*2*Math.PI;return n[0]=Math.cos(e)*t,n[1]=Math.sin(e)*t,n}function x(t){let c=t??new u(2);return c[0]=0,c[1]=0,c}function A(t,c,n){let e=n??new u(2),f=t[0],M=t[1];return e[0]=f*c[0]+M*c[4]+c[12],e[1]=f*c[1]+M*c[5]+c[13],e}function o(t,c,n){let e=n??new u(2),f=t[0],M=t[1];return e[0]=c[0]*f+c[4]*M+c[8],e[1]=c[1]*f+c[5]*M+c[9],e}function i(t,c,n,e){let f=e??new u(2),M=t[0]-c[0],m=t[1]-c[1],s=Math.sin(n),r=Math.cos(n);return f[0]=M*r-m*s+c[0],f[1]=M*s+m*r+c[1],f}function l(t,c,n){let e=n??new u(2);return S(t,e),st(e,c,e)}function w(t,c,n){let e=n??new u(2);return dt(t)>c?l(t,c,e):B(t,e)}function G(t,c,n){let e=n??new u(2);return wt(t,c,.5,e)}return{create:a,fromValues:E,set:U,ceil:z,floor:F,round:C,clamp:J,add:tt,addScaled:ot,angle:it,subtract:nt,sub:St,equalsApproximately:rt,equals:At,lerp:wt,lerpV:Mt,max:zt,min:et,mulScalar:st,scale:lt,divScalar:ht,inverse:Pt,invert:ut,cross:Tt,dot:Lt,length:dt,len:Nt,lengthSq:Y,lenSq:Q,distance:$,dist:h,distanceSq:P,distSq:g,normalize:S,negate:q,copy:B,clone:V,multiply:I,mul:X,divide:R,div:N,random:H,zero:x,transformMat4:A,transformMat3:o,rotate:i,setLength:l,truncate:w,midpoint:G}}var wn=new Map;function mn(u){let a=wn.get(u);return a||(a=zn(u),wn.set(u,a)),a}function Tn(u){let a=mn(u);function E(h,P,g,S,q,B,V,I,X){let R=new u(12);return R[3]=0,R[7]=0,R[11]=0,h!==void 0&&(R[0]=h,P!==void 0&&(R[1]=P,g!==void 0&&(R[2]=g,S!==void 0&&(R[4]=S,q!==void 0&&(R[5]=q,B!==void 0&&(R[6]=B,V!==void 0&&(R[8]=V,I!==void 0&&(R[9]=I,X!==void 0&&(R[10]=X))))))))),R}function U(h,P,g,S,q,B,V,I,X,R){let N=R??new u(12);return N[0]=h,N[1]=P,N[2]=g,N[3]=0,N[4]=S,N[5]=q,N[6]=B,N[7]=0,N[8]=V,N[9]=I,N[10]=X,N[11]=0,N}function z(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=0,g[4]=h[4],g[5]=h[5],g[6]=h[6],g[7]=0,g[8]=h[8],g[9]=h[9],g[10]=h[10],g[11]=0,g}function F(h,P){let g=P??new u(12),S=h[0],q=h[1],B=h[2],V=h[3],I=S+S,X=q+q,R=B+B,N=S*I,H=q*I,x=q*X,A=B*I,o=B*X,i=B*R,l=V*I,w=V*X,G=V*R;return g[0]=1-x-i,g[1]=H+G,g[2]=A-w,g[3]=0,g[4]=H-G,g[5]=1-N-i,g[6]=o+l,g[7]=0,g[8]=A+w,g[9]=o-l,g[10]=1-N-x,g[11]=0,g}function C(h,P){let g=P??new u(12);return g[0]=-h[0],g[1]=-h[1],g[2]=-h[2],g[4]=-h[4],g[5]=-h[5],g[6]=-h[6],g[8]=-h[8],g[9]=-h[9],g[10]=-h[10],g}function J(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[4]=h[4],g[5]=h[5],g[6]=h[6],g[8]=h[8],g[9]=h[9],g[10]=h[10],g}let tt=J;function ot(h,P){return Math.abs(h[0]-P[0])<_&&Math.abs(h[1]-P[1])<_&&Math.abs(h[2]-P[2])<_&&Math.abs(h[4]-P[4])<_&&Math.abs(h[5]-P[5])<_&&Math.abs(h[6]-P[6])<_&&Math.abs(h[8]-P[8])<_&&Math.abs(h[9]-P[9])<_&&Math.abs(h[10]-P[10])<_}function it(h,P){return h[0]===P[0]&&h[1]===P[1]&&h[2]===P[2]&&h[4]===P[4]&&h[5]===P[5]&&h[6]===P[6]&&h[8]===P[8]&&h[9]===P[9]&&h[10]===P[10]}function nt(h){let P=h??new u(12);return P[0]=1,P[1]=0,P[2]=0,P[4]=0,P[5]=1,P[6]=0,P[8]=0,P[9]=0,P[10]=1,P}function St(h,P){let g=P??new u(12);if(g===h){let x;return x=h[1],h[1]=h[4],h[4]=x,x=h[2],h[2]=h[8],h[8]=x,x=h[6],h[6]=h[9],h[9]=x,g}let S=h[0*4+0],q=h[0*4+1],B=h[0*4+2],V=h[1*4+0],I=h[1*4+1],X=h[1*4+2],R=h[2*4+0],N=h[2*4+1],H=h[2*4+2];return g[0]=S,g[1]=V,g[2]=R,g[4]=q,g[5]=I,g[6]=N,g[8]=B,g[9]=X,g[10]=H,g}function rt(h,P){let g=P??new u(12),S=h[0*4+0],q=h[0*4+1],B=h[0*4+2],V=h[1*4+0],I=h[1*4+1],X=h[1*4+2],R=h[2*4+0],N=h[2*4+1],H=h[2*4+2],x=H*I-X*N,A=-H*V+X*R,o=N*V-I*R,i=1/(S*x+q*A+B*o);return g[0]=x*i,g[1]=(-H*q+B*N)*i,g[2]=(X*q-B*I)*i,g[4]=A*i,g[5]=(H*S-B*R)*i,g[6]=(-X*S+B*V)*i,g[8]=o*i,g[9]=(-N*S+q*R)*i,g[10]=(I*S-q*V)*i,g}function At(h){let P=h[0],g=h[0*4+1],S=h[0*4+2],q=h[1*4+0],B=h[1*4+1],V=h[1*4+2],I=h[2*4+0],X=h[2*4+1],R=h[2*4+2];return P*(B*R-X*V)-q*(g*R-X*S)+I*(g*V-B*S)}let wt=rt;function Mt(h,P,g){let S=g??new u(12),q=h[0],B=h[1],V=h[2],I=h[4],X=h[5],R=h[6],N=h[8],H=h[9],x=h[10],A=P[0],o=P[1],i=P[2],l=P[4],w=P[5],G=P[6],t=P[8],c=P[9],n=P[10];return S[0]=q*A+I*o+N*i,S[1]=B*A+X*o+H*i,S[2]=V*A+R*o+x*i,S[4]=q*l+I*w+N*G,S[5]=B*l+X*w+H*G,S[6]=V*l+R*w+x*G,S[8]=q*t+I*c+N*n,S[9]=B*t+X*c+H*n,S[10]=V*t+R*c+x*n,S}let zt=Mt;function et(h,P,g){let S=g??nt();return h!==S&&(S[0]=h[0],S[1]=h[1],S[2]=h[2],S[4]=h[4],S[5]=h[5],S[6]=h[6]),S[8]=P[0],S[9]=P[1],S[10]=1,S}function st(h,P){let g=P??a.create();return g[0]=h[8],g[1]=h[9],g}function lt(h,P,g){let S=g??a.create(),q=P*4;return S[0]=h[q+0],S[1]=h[q+1],S}function ht(h,P,g,S){let q=S===h?h:J(h,S),B=g*4;return q[B+0]=P[0],q[B+1]=P[1],q}function Pt(h,P){let g=P??a.create(),S=h[0],q=h[1],B=h[4],V=h[5];return g[0]=Math.sqrt(S*S+q*q),g[1]=Math.sqrt(B*B+V*V),g}function ut(h,P){let g=P??new u(12);return g[0]=1,g[1]=0,g[2]=0,g[4]=0,g[5]=1,g[6]=0,g[8]=h[0],g[9]=h[1],g[10]=1,g}function Tt(h,P,g){let S=g??new u(12),q=P[0],B=P[1],V=h[0],I=h[1],X=h[2],R=h[1*4+0],N=h[1*4+1],H=h[1*4+2],x=h[2*4+0],A=h[2*4+1],o=h[2*4+2];return h!==S&&(S[0]=V,S[1]=I,S[2]=X,S[4]=R,S[5]=N,S[6]=H),S[8]=V*q+R*B+x,S[9]=I*q+N*B+A,S[10]=X*q+H*B+o,S}function Lt(h,P){let g=P??new u(12),S=Math.cos(h),q=Math.sin(h);return g[0]=S,g[1]=q,g[2]=0,g[4]=-q,g[5]=S,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function dt(h,P,g){let S=g??new u(12),q=h[0*4+0],B=h[0*4+1],V=h[0*4+2],I=h[1*4+0],X=h[1*4+1],R=h[1*4+2],N=Math.cos(P),H=Math.sin(P);return S[0]=N*q+H*I,S[1]=N*B+H*X,S[2]=N*V+H*R,S[4]=N*I-H*q,S[5]=N*X-H*B,S[6]=N*R-H*V,h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}function Nt(h,P){let g=P??new u(12);return g[0]=h[0],g[1]=0,g[2]=0,g[4]=0,g[5]=h[1],g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function Y(h,P,g){let S=g??new u(12),q=P[0],B=P[1];return S[0]=q*h[0*4+0],S[1]=q*h[0*4+1],S[2]=q*h[0*4+2],S[4]=B*h[1*4+0],S[5]=B*h[1*4+1],S[6]=B*h[1*4+2],h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}function Q(h,P){let g=P??new u(12);return g[0]=h,g[1]=0,g[2]=0,g[4]=0,g[5]=h,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function $(h,P,g){let S=g??new u(12);return S[0]=P*h[0*4+0],S[1]=P*h[0*4+1],S[2]=P*h[0*4+2],S[4]=P*h[1*4+0],S[5]=P*h[1*4+1],S[6]=P*h[1*4+2],h!==S&&(S[8]=h[8],S[9]=h[9],S[10]=h[10]),S}return{clone:tt,create:E,set:U,fromMat4:z,fromQuat:F,negate:C,copy:J,equalsApproximately:ot,equals:it,identity:nt,transpose:St,inverse:rt,invert:wt,determinant:At,mul:zt,multiply:Mt,setTranslation:et,getTranslation:st,getAxis:lt,setAxis:ht,getScaling:Pt,translation:ut,translate:Tt,rotation:Lt,rotate:dt,scaling:Nt,scale:Y,uniformScaling:Q,uniformScale:$}}var Mn=new Map;function Ln(u){let a=Mn.get(u);return a||(a=Tn(u),Mn.set(u,a)),a}function qn(u){function a(s,r,d){let p=new u(3);return s!==void 0&&(p[0]=s,r!==void 0&&(p[1]=r,d!==void 0&&(p[2]=d))),p}let E=a;function U(s,r,d,p){let y=p??new u(3);return y[0]=s,y[1]=r,y[2]=d,y}function z(s,r){let d=r??new u(3);return d[0]=Math.ceil(s[0]),d[1]=Math.ceil(s[1]),d[2]=Math.ceil(s[2]),d}function F(s,r){let d=r??new u(3);return d[0]=Math.floor(s[0]),d[1]=Math.floor(s[1]),d[2]=Math.floor(s[2]),d}function C(s,r){let d=r??new u(3);return d[0]=Math.round(s[0]),d[1]=Math.round(s[1]),d[2]=Math.round(s[2]),d}function J(s,r=0,d=1,p){let y=p??new u(3);return y[0]=Math.min(d,Math.max(r,s[0])),y[1]=Math.min(d,Math.max(r,s[1])),y[2]=Math.min(d,Math.max(r,s[2])),y}function tt(s,r,d){let p=d??new u(3);return p[0]=s[0]+r[0],p[1]=s[1]+r[1],p[2]=s[2]+r[2],p}function ot(s,r,d,p){let y=p??new u(3);return y[0]=s[0]+r[0]*d,y[1]=s[1]+r[1]*d,y[2]=s[2]+r[2]*d,y}function it(s,r){let d=s[0],p=s[1],y=s[2],D=r[0],v=r[1],b=r[2],O=Math.sqrt(d*d+p*p+y*y),T=Math.sqrt(D*D+v*v+b*b),L=O*T,W=L&&Lt(s,r)/L;return Math.acos(W)}function nt(s,r,d){let p=d??new u(3);return p[0]=s[0]-r[0],p[1]=s[1]-r[1],p[2]=s[2]-r[2],p}let St=nt;function rt(s,r){return Math.abs(s[0]-r[0])<_&&Math.abs(s[1]-r[1])<_&&Math.abs(s[2]-r[2])<_}function At(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]}function wt(s,r,d,p){let y=p??new u(3);return y[0]=s[0]+d*(r[0]-s[0]),y[1]=s[1]+d*(r[1]-s[1]),y[2]=s[2]+d*(r[2]-s[2]),y}function Mt(s,r,d,p){let y=p??new u(3);return y[0]=s[0]+d[0]*(r[0]-s[0]),y[1]=s[1]+d[1]*(r[1]-s[1]),y[2]=s[2]+d[2]*(r[2]-s[2]),y}function zt(s,r,d){let p=d??new u(3);return p[0]=Math.max(s[0],r[0]),p[1]=Math.max(s[1],r[1]),p[2]=Math.max(s[2],r[2]),p}function et(s,r,d){let p=d??new u(3);return p[0]=Math.min(s[0],r[0]),p[1]=Math.min(s[1],r[1]),p[2]=Math.min(s[2],r[2]),p}function st(s,r,d){let p=d??new u(3);return p[0]=s[0]*r,p[1]=s[1]*r,p[2]=s[2]*r,p}let lt=st;function ht(s,r,d){let p=d??new u(3);return p[0]=s[0]/r,p[1]=s[1]/r,p[2]=s[2]/r,p}function Pt(s,r){let d=r??new u(3);return d[0]=1/s[0],d[1]=1/s[1],d[2]=1/s[2],d}let ut=Pt;function Tt(s,r,d){let p=d??new u(3),y=s[2]*r[0]-s[0]*r[2],D=s[0]*r[1]-s[1]*r[0];return p[0]=s[1]*r[2]-s[2]*r[1],p[1]=y,p[2]=D,p}function Lt(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function dt(s){let r=s[0],d=s[1],p=s[2];return Math.sqrt(r*r+d*d+p*p)}let Nt=dt;function Y(s){let r=s[0],d=s[1],p=s[2];return r*r+d*d+p*p}let Q=Y;function $(s,r){let d=s[0]-r[0],p=s[1]-r[1],y=s[2]-r[2];return Math.sqrt(d*d+p*p+y*y)}let h=$;function P(s,r){let d=s[0]-r[0],p=s[1]-r[1],y=s[2]-r[2];return d*d+p*p+y*y}let g=P;function S(s,r){let d=r??new u(3),p=s[0],y=s[1],D=s[2],v=Math.sqrt(p*p+y*y+D*D);return v>1e-5?(d[0]=p/v,d[1]=y/v,d[2]=D/v):(d[0]=0,d[1]=0,d[2]=0),d}function q(s,r){let d=r??new u(3);return d[0]=-s[0],d[1]=-s[1],d[2]=-s[2],d}function B(s,r){let d=r??new u(3);return d[0]=s[0],d[1]=s[1],d[2]=s[2],d}let V=B;function I(s,r,d){let p=d??new u(3);return p[0]=s[0]*r[0],p[1]=s[1]*r[1],p[2]=s[2]*r[2],p}let X=I;function R(s,r,d){let p=d??new u(3);return p[0]=s[0]/r[0],p[1]=s[1]/r[1],p[2]=s[2]/r[2],p}let N=R;function H(s=1,r){let d=r??new u(3),p=Math.random()*2*Math.PI,y=Math.random()*2-1,D=Math.sqrt(1-y*y)*s;return d[0]=Math.cos(p)*D,d[1]=Math.sin(p)*D,d[2]=y*s,d}function x(s){let r=s??new u(3);return r[0]=0,r[1]=0,r[2]=0,r}function A(s,r,d){let p=d??new u(3),y=s[0],D=s[1],v=s[2],b=r[3]*y+r[7]*D+r[11]*v+r[15]||1;return p[0]=(r[0]*y+r[4]*D+r[8]*v+r[12])/b,p[1]=(r[1]*y+r[5]*D+r[9]*v+r[13])/b,p[2]=(r[2]*y+r[6]*D+r[10]*v+r[14])/b,p}function o(s,r,d){let p=d??new u(3),y=s[0],D=s[1],v=s[2];return p[0]=y*r[0*4+0]+D*r[1*4+0]+v*r[2*4+0],p[1]=y*r[0*4+1]+D*r[1*4+1]+v*r[2*4+1],p[2]=y*r[0*4+2]+D*r[1*4+2]+v*r[2*4+2],p}function i(s,r,d){let p=d??new u(3),y=s[0],D=s[1],v=s[2];return p[0]=y*r[0]+D*r[4]+v*r[8],p[1]=y*r[1]+D*r[5]+v*r[9],p[2]=y*r[2]+D*r[6]+v*r[10],p}function l(s,r,d){let p=d??new u(3),y=r[0],D=r[1],v=r[2],b=r[3]*2,O=s[0],T=s[1],L=s[2],W=D*L-v*T,k=v*O-y*L,j=y*T-D*O;return p[0]=O+W*b+(D*j-v*k)*2,p[1]=T+k*b+(v*W-y*j)*2,p[2]=L+j*b+(y*k-D*W)*2,p}function w(s,r){let d=r??new u(3);return d[0]=s[12],d[1]=s[13],d[2]=s[14],d}function G(s,r,d){let p=d??new u(3),y=r*4;return p[0]=s[y+0],p[1]=s[y+1],p[2]=s[y+2],p}function t(s,r){let d=r??new u(3),p=s[0],y=s[1],D=s[2],v=s[4],b=s[5],O=s[6],T=s[8],L=s[9],W=s[10];return d[0]=Math.sqrt(p*p+y*y+D*D),d[1]=Math.sqrt(v*v+b*b+O*O),d[2]=Math.sqrt(T*T+L*L+W*W),d}function c(s,r,d,p){let y=p??new u(3),D=[],v=[];return D[0]=s[0]-r[0],D[1]=s[1]-r[1],D[2]=s[2]-r[2],v[0]=D[0],v[1]=D[1]*Math.cos(d)-D[2]*Math.sin(d),v[2]=D[1]*Math.sin(d)+D[2]*Math.cos(d),y[0]=v[0]+r[0],y[1]=v[1]+r[1],y[2]=v[2]+r[2],y}function n(s,r,d,p){let y=p??new u(3),D=[],v=[];return D[0]=s[0]-r[0],D[1]=s[1]-r[1],D[2]=s[2]-r[2],v[0]=D[2]*Math.sin(d)+D[0]*Math.cos(d),v[1]=D[1],v[2]=D[2]*Math.cos(d)-D[0]*Math.sin(d),y[0]=v[0]+r[0],y[1]=v[1]+r[1],y[2]=v[2]+r[2],y}function e(s,r,d,p){let y=p??new u(3),D=[],v=[];return D[0]=s[0]-r[0],D[1]=s[1]-r[1],D[2]=s[2]-r[2],v[0]=D[0]*Math.cos(d)-D[1]*Math.sin(d),v[1]=D[0]*Math.sin(d)+D[1]*Math.cos(d),v[2]=D[2],y[0]=v[0]+r[0],y[1]=v[1]+r[1],y[2]=v[2]+r[2],y}function f(s,r,d){let p=d??new u(3);return S(s,p),st(p,r,p)}function M(s,r,d){let p=d??new u(3);return dt(s)>r?f(s,r,p):B(s,p)}function m(s,r,d){let p=d??new u(3);return wt(s,r,.5,p)}return{create:a,fromValues:E,set:U,ceil:z,floor:F,round:C,clamp:J,add:tt,addScaled:ot,angle:it,subtract:nt,sub:St,equalsApproximately:rt,equals:At,lerp:wt,lerpV:Mt,max:zt,min:et,mulScalar:st,scale:lt,divScalar:ht,inverse:Pt,invert:ut,cross:Tt,dot:Lt,length:dt,len:Nt,lengthSq:Y,lenSq:Q,distance:$,dist:h,distanceSq:P,distSq:g,normalize:S,negate:q,copy:B,clone:V,multiply:I,mul:X,divide:R,div:N,random:H,zero:x,transformMat4:A,transformMat4Upper3x3:o,transformMat3:i,transformQuat:l,getTranslation:w,getAxis:G,getScaling:t,rotateX:c,rotateY:n,rotateZ:e,setLength:f,truncate:M,midpoint:m}}var xn=new Map;function Ct(u){let a=xn.get(u);return a||(a=qn(u),xn.set(u,a)),a}function bn(u){let a=Ct(u);function E(t,c,n,e,f,M,m,s,r,d,p,y,D,v,b,O){let T=new u(16);return t!==void 0&&(T[0]=t,c!==void 0&&(T[1]=c,n!==void 0&&(T[2]=n,e!==void 0&&(T[3]=e,f!==void 0&&(T[4]=f,M!==void 0&&(T[5]=M,m!==void 0&&(T[6]=m,s!==void 0&&(T[7]=s,r!==void 0&&(T[8]=r,d!==void 0&&(T[9]=d,p!==void 0&&(T[10]=p,y!==void 0&&(T[11]=y,D!==void 0&&(T[12]=D,v!==void 0&&(T[13]=v,b!==void 0&&(T[14]=b,O!==void 0&&(T[15]=O)))))))))))))))),T}function U(t,c,n,e,f,M,m,s,r,d,p,y,D,v,b,O,T){let L=T??new u(16);return L[0]=t,L[1]=c,L[2]=n,L[3]=e,L[4]=f,L[5]=M,L[6]=m,L[7]=s,L[8]=r,L[9]=d,L[10]=p,L[11]=y,L[12]=D,L[13]=v,L[14]=b,L[15]=O,L}function z(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=0,n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function F(t,c){let n=c??new u(16),e=t[0],f=t[1],M=t[2],m=t[3],s=e+e,r=f+f,d=M+M,p=e*s,y=f*s,D=f*r,v=M*s,b=M*r,O=M*d,T=m*s,L=m*r,W=m*d;return n[0]=1-D-O,n[1]=y+W,n[2]=v-L,n[3]=0,n[4]=y-W,n[5]=1-p-O,n[6]=b+T,n[7]=0,n[8]=v+L,n[9]=b-T,n[10]=1-p-D,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function C(t,c){let n=c??new u(16);return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n[11]=-t[11],n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=-t[15],n}function J(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}let tt=J;function ot(t,c){return Math.abs(t[0]-c[0])<_&&Math.abs(t[1]-c[1])<_&&Math.abs(t[2]-c[2])<_&&Math.abs(t[3]-c[3])<_&&Math.abs(t[4]-c[4])<_&&Math.abs(t[5]-c[5])<_&&Math.abs(t[6]-c[6])<_&&Math.abs(t[7]-c[7])<_&&Math.abs(t[8]-c[8])<_&&Math.abs(t[9]-c[9])<_&&Math.abs(t[10]-c[10])<_&&Math.abs(t[11]-c[11])<_&&Math.abs(t[12]-c[12])<_&&Math.abs(t[13]-c[13])<_&&Math.abs(t[14]-c[14])<_&&Math.abs(t[15]-c[15])<_}function it(t,c){return t[0]===c[0]&&t[1]===c[1]&&t[2]===c[2]&&t[3]===c[3]&&t[4]===c[4]&&t[5]===c[5]&&t[6]===c[6]&&t[7]===c[7]&&t[8]===c[8]&&t[9]===c[9]&&t[10]===c[10]&&t[11]===c[11]&&t[12]===c[12]&&t[13]===c[13]&&t[14]===c[14]&&t[15]===c[15]}function nt(t){let c=t??new u(16);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function St(t,c){let n=c??new u(16);if(n===t){let k;return k=t[1],t[1]=t[4],t[4]=k,k=t[2],t[2]=t[8],t[8]=k,k=t[3],t[3]=t[12],t[12]=k,k=t[6],t[6]=t[9],t[9]=k,k=t[7],t[7]=t[13],t[13]=k,k=t[11],t[11]=t[14],t[14]=k,n}let e=t[0*4+0],f=t[0*4+1],M=t[0*4+2],m=t[0*4+3],s=t[1*4+0],r=t[1*4+1],d=t[1*4+2],p=t[1*4+3],y=t[2*4+0],D=t[2*4+1],v=t[2*4+2],b=t[2*4+3],O=t[3*4+0],T=t[3*4+1],L=t[3*4+2],W=t[3*4+3];return n[0]=e,n[1]=s,n[2]=y,n[3]=O,n[4]=f,n[5]=r,n[6]=D,n[7]=T,n[8]=M,n[9]=d,n[10]=v,n[11]=L,n[12]=m,n[13]=p,n[14]=b,n[15]=W,n}function rt(t,c){let n=c??new u(16),e=t[0*4+0],f=t[0*4+1],M=t[0*4+2],m=t[0*4+3],s=t[1*4+0],r=t[1*4+1],d=t[1*4+2],p=t[1*4+3],y=t[2*4+0],D=t[2*4+1],v=t[2*4+2],b=t[2*4+3],O=t[3*4+0],T=t[3*4+1],L=t[3*4+2],W=t[3*4+3],k=v*W,j=L*b,at=d*W,ft=L*p,pt=d*b,xt=v*p,gt=M*W,yt=L*m,Dt=M*b,mt=v*m,Gt=M*p,Et=d*m,Ut=y*T,Bt=O*D,qt=s*T,bt=O*r,Rt=s*D,Wt=y*r,$t=e*T,Xt=O*f,kt=e*D,Yt=y*f,Ht=e*r,Zt=s*f,ln=k*r+ft*D+pt*T-(j*r+at*D+xt*T),hn=j*f+gt*D+mt*T-(k*f+yt*D+Dt*T),dn=at*f+yt*r+Gt*T-(ft*f+gt*r+Et*T),pn=xt*f+Dt*r+Et*D-(pt*f+mt*r+Gt*D),vt=1/(e*ln+s*hn+y*dn+O*pn);return n[0]=vt*ln,n[1]=vt*hn,n[2]=vt*dn,n[3]=vt*pn,n[4]=vt*(j*s+at*y+xt*O-(k*s+ft*y+pt*O)),n[5]=vt*(k*e+yt*y+Dt*O-(j*e+gt*y+mt*O)),n[6]=vt*(ft*e+gt*s+Et*O-(at*e+yt*s+Gt*O)),n[7]=vt*(pt*e+mt*s+Gt*y-(xt*e+Dt*s+Et*y)),n[8]=vt*(Ut*p+bt*b+Rt*W-(Bt*p+qt*b+Wt*W)),n[9]=vt*(Bt*m+$t*b+Yt*W-(Ut*m+Xt*b+kt*W)),n[10]=vt*(qt*m+Xt*p+Ht*W-(bt*m+$t*p+Zt*W)),n[11]=vt*(Wt*m+kt*p+Zt*b-(Rt*m+Yt*p+Ht*b)),n[12]=vt*(qt*v+Wt*L+Bt*d-(Rt*L+Ut*d+bt*v)),n[13]=vt*(kt*L+Ut*M+Xt*v-($t*v+Yt*L+Bt*M)),n[14]=vt*($t*d+Zt*L+bt*M-(Ht*L+qt*M+Xt*d)),n[15]=vt*(Ht*v+Rt*M+Yt*d-(kt*d+Zt*v+Wt*M)),n}function At(t){let c=t[0],n=t[0*4+1],e=t[0*4+2],f=t[0*4+3],M=t[1*4+0],m=t[1*4+1],s=t[1*4+2],r=t[1*4+3],d=t[2*4+0],p=t[2*4+1],y=t[2*4+2],D=t[2*4+3],v=t[3*4+0],b=t[3*4+1],O=t[3*4+2],T=t[3*4+3],L=y*T,W=O*D,k=s*T,j=O*r,at=s*D,ft=y*r,pt=e*T,xt=O*f,gt=e*D,yt=y*f,Dt=e*r,mt=s*f,Gt=L*m+j*p+at*b-(W*m+k*p+ft*b),Et=W*n+pt*p+yt*b-(L*n+xt*p+gt*b),Ut=k*n+xt*m+Dt*b-(j*n+pt*m+mt*b),Bt=ft*n+gt*m+mt*p-(at*n+yt*m+Dt*p);return c*Gt+M*Et+d*Ut+v*Bt}let wt=rt;function Mt(t,c,n){let e=n??new u(16),f=t[0],M=t[1],m=t[2],s=t[3],r=t[4],d=t[5],p=t[6],y=t[7],D=t[8],v=t[9],b=t[10],O=t[11],T=t[12],L=t[13],W=t[14],k=t[15],j=c[0],at=c[1],ft=c[2],pt=c[3],xt=c[4],gt=c[5],yt=c[6],Dt=c[7],mt=c[8],Gt=c[9],Et=c[10],Ut=c[11],Bt=c[12],qt=c[13],bt=c[14],Rt=c[15];return e[0]=f*j+r*at+D*ft+T*pt,e[1]=M*j+d*at+v*ft+L*pt,e[2]=m*j+p*at+b*ft+W*pt,e[3]=s*j+y*at+O*ft+k*pt,e[4]=f*xt+r*gt+D*yt+T*Dt,e[5]=M*xt+d*gt+v*yt+L*Dt,e[6]=m*xt+p*gt+b*yt+W*Dt,e[7]=s*xt+y*gt+O*yt+k*Dt,e[8]=f*mt+r*Gt+D*Et+T*Ut,e[9]=M*mt+d*Gt+v*Et+L*Ut,e[10]=m*mt+p*Gt+b*Et+W*Ut,e[11]=s*mt+y*Gt+O*Et+k*Ut,e[12]=f*Bt+r*qt+D*bt+T*Rt,e[13]=M*Bt+d*qt+v*bt+L*Rt,e[14]=m*Bt+p*qt+b*bt+W*Rt,e[15]=s*Bt+y*qt+O*bt+k*Rt,e}let zt=Mt;function et(t,c,n){let e=n??nt();return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]),e[12]=c[0],e[13]=c[1],e[14]=c[2],e[15]=1,e}function st(t,c){let n=c??a.create();return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function lt(t,c,n){let e=n??a.create(),f=c*4;return e[0]=t[f+0],e[1]=t[f+1],e[2]=t[f+2],e}function ht(t,c,n,e){let f=e===t?e:J(t,e),M=n*4;return f[M+0]=c[0],f[M+1]=c[1],f[M+2]=c[2],f}function Pt(t,c){let n=c??a.create(),e=t[0],f=t[1],M=t[2],m=t[4],s=t[5],r=t[6],d=t[8],p=t[9],y=t[10];return n[0]=Math.sqrt(e*e+f*f+M*M),n[1]=Math.sqrt(m*m+s*s+r*r),n[2]=Math.sqrt(d*d+p*p+y*y),n}function ut(t,c,n,e,f){let M=f??new u(16),m=Math.tan(Math.PI*.5-.5*t);if(M[0]=m/c,M[1]=0,M[2]=0,M[3]=0,M[4]=0,M[5]=m,M[6]=0,M[7]=0,M[8]=0,M[9]=0,M[11]=-1,M[12]=0,M[13]=0,M[15]=0,Number.isFinite(e)){let s=1/(n-e);M[10]=e*s,M[14]=e*n*s}else M[10]=-1,M[14]=-n;return M}function Tt(t,c,n,e=1/0,f){let M=f??new u(16),m=1/Math.tan(t*.5);if(M[0]=m/c,M[1]=0,M[2]=0,M[3]=0,M[4]=0,M[5]=m,M[6]=0,M[7]=0,M[8]=0,M[9]=0,M[11]=-1,M[12]=0,M[13]=0,M[15]=0,e===1/0)M[10]=0,M[14]=n;else{let s=1/(e-n);M[10]=n*s,M[14]=e*n*s}return M}function Lt(t,c,n,e,f,M,m){let s=m??new u(16);return s[0]=2/(c-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(e-n),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1/(f-M),s[11]=0,s[12]=(c+t)/(t-c),s[13]=(e+n)/(n-e),s[14]=f/(f-M),s[15]=1,s}function dt(t,c,n,e,f,M,m){let s=m??new u(16),r=c-t,d=e-n,p=f-M;return s[0]=2*f/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*f/d,s[6]=0,s[7]=0,s[8]=(t+c)/r,s[9]=(e+n)/d,s[10]=M/p,s[11]=-1,s[12]=0,s[13]=0,s[14]=f*M/p,s[15]=0,s}function Nt(t,c,n,e,f,M=1/0,m){let s=m??new u(16),r=c-t,d=e-n;if(s[0]=2*f/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*f/d,s[6]=0,s[7]=0,s[8]=(t+c)/r,s[9]=(e+n)/d,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,M===1/0)s[10]=0,s[14]=f;else{let p=1/(M-f);s[10]=f*p,s[14]=M*f*p}return s}let Y=a.create(),Q=a.create(),$=a.create();function h(t,c,n,e){let f=e??new u(16);return a.normalize(a.subtract(c,t,$),$),a.normalize(a.cross(n,$,Y),Y),a.normalize(a.cross($,Y,Q),Q),f[0]=Y[0],f[1]=Y[1],f[2]=Y[2],f[3]=0,f[4]=Q[0],f[5]=Q[1],f[6]=Q[2],f[7]=0,f[8]=$[0],f[9]=$[1],f[10]=$[2],f[11]=0,f[12]=t[0],f[13]=t[1],f[14]=t[2],f[15]=1,f}function P(t,c,n,e){let f=e??new u(16);return a.normalize(a.subtract(t,c,$),$),a.normalize(a.cross(n,$,Y),Y),a.normalize(a.cross($,Y,Q),Q),f[0]=Y[0],f[1]=Y[1],f[2]=Y[2],f[3]=0,f[4]=Q[0],f[5]=Q[1],f[6]=Q[2],f[7]=0,f[8]=$[0],f[9]=$[1],f[10]=$[2],f[11]=0,f[12]=t[0],f[13]=t[1],f[14]=t[2],f[15]=1,f}function g(t,c,n,e){let f=e??new u(16);return a.normalize(a.subtract(t,c,$),$),a.normalize(a.cross(n,$,Y),Y),a.normalize(a.cross($,Y,Q),Q),f[0]=Y[0],f[1]=Q[0],f[2]=$[0],f[3]=0,f[4]=Y[1],f[5]=Q[1],f[6]=$[1],f[7]=0,f[8]=Y[2],f[9]=Q[2],f[10]=$[2],f[11]=0,f[12]=-(Y[0]*t[0]+Y[1]*t[1]+Y[2]*t[2]),f[13]=-(Q[0]*t[0]+Q[1]*t[1]+Q[2]*t[2]),f[14]=-($[0]*t[0]+$[1]*t[1]+$[2]*t[2]),f[15]=1,f}function S(t,c){let n=c??new u(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function q(t,c,n){let e=n??new u(16),f=c[0],M=c[1],m=c[2],s=t[0],r=t[1],d=t[2],p=t[3],y=t[1*4+0],D=t[1*4+1],v=t[1*4+2],b=t[1*4+3],O=t[2*4+0],T=t[2*4+1],L=t[2*4+2],W=t[2*4+3],k=t[3*4+0],j=t[3*4+1],at=t[3*4+2],ft=t[3*4+3];return t!==e&&(e[0]=s,e[1]=r,e[2]=d,e[3]=p,e[4]=y,e[5]=D,e[6]=v,e[7]=b,e[8]=O,e[9]=T,e[10]=L,e[11]=W),e[12]=s*f+y*M+O*m+k,e[13]=r*f+D*M+T*m+j,e[14]=d*f+v*M+L*m+at,e[15]=p*f+b*M+W*m+ft,e}function B(t,c){let n=c??new u(16),e=Math.cos(t),f=Math.sin(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=f,n[7]=0,n[8]=0,n[9]=-f,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function V(t,c,n){let e=n??new u(16),f=t[4],M=t[5],m=t[6],s=t[7],r=t[8],d=t[9],p=t[10],y=t[11],D=Math.cos(c),v=Math.sin(c);return e[4]=D*f+v*r,e[5]=D*M+v*d,e[6]=D*m+v*p,e[7]=D*s+v*y,e[8]=D*r-v*f,e[9]=D*d-v*M,e[10]=D*p-v*m,e[11]=D*y-v*s,t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function I(t,c){let n=c??new u(16),e=Math.cos(t),f=Math.sin(t);return n[0]=e,n[1]=0,n[2]=-f,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=f,n[9]=0,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function X(t,c,n){let e=n??new u(16),f=t[0*4+0],M=t[0*4+1],m=t[0*4+2],s=t[0*4+3],r=t[2*4+0],d=t[2*4+1],p=t[2*4+2],y=t[2*4+3],D=Math.cos(c),v=Math.sin(c);return e[0]=D*f-v*r,e[1]=D*M-v*d,e[2]=D*m-v*p,e[3]=D*s-v*y,e[8]=D*r+v*f,e[9]=D*d+v*M,e[10]=D*p+v*m,e[11]=D*y+v*s,t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function R(t,c){let n=c??new u(16),e=Math.cos(t),f=Math.sin(t);return n[0]=e,n[1]=f,n[2]=0,n[3]=0,n[4]=-f,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function N(t,c,n){let e=n??new u(16),f=t[0*4+0],M=t[0*4+1],m=t[0*4+2],s=t[0*4+3],r=t[1*4+0],d=t[1*4+1],p=t[1*4+2],y=t[1*4+3],D=Math.cos(c),v=Math.sin(c);return e[0]=D*f+v*r,e[1]=D*M+v*d,e[2]=D*m+v*p,e[3]=D*s+v*y,e[4]=D*r-v*f,e[5]=D*d-v*M,e[6]=D*p-v*m,e[7]=D*y-v*s,t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function H(t,c,n){let e=n??new u(16),f=t[0],M=t[1],m=t[2],s=Math.sqrt(f*f+M*M+m*m);f/=s,M/=s,m/=s;let r=f*f,d=M*M,p=m*m,y=Math.cos(c),D=Math.sin(c),v=1-y;return e[0]=r+(1-r)*y,e[1]=f*M*v+m*D,e[2]=f*m*v-M*D,e[3]=0,e[4]=f*M*v-m*D,e[5]=d+(1-d)*y,e[6]=M*m*v+f*D,e[7]=0,e[8]=f*m*v+M*D,e[9]=M*m*v-f*D,e[10]=p+(1-p)*y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}let x=H;function A(t,c,n,e){let f=e??new u(16),M=c[0],m=c[1],s=c[2],r=Math.sqrt(M*M+m*m+s*s);M/=r,m/=r,s/=r;let d=M*M,p=m*m,y=s*s,D=Math.cos(n),v=Math.sin(n),b=1-D,O=d+(1-d)*D,T=M*m*b+s*v,L=M*s*b-m*v,W=M*m*b-s*v,k=p+(1-p)*D,j=m*s*b+M*v,at=M*s*b+m*v,ft=m*s*b-M*v,pt=y+(1-y)*D,xt=t[0],gt=t[1],yt=t[2],Dt=t[3],mt=t[4],Gt=t[5],Et=t[6],Ut=t[7],Bt=t[8],qt=t[9],bt=t[10],Rt=t[11];return f[0]=O*xt+T*mt+L*Bt,f[1]=O*gt+T*Gt+L*qt,f[2]=O*yt+T*Et+L*bt,f[3]=O*Dt+T*Ut+L*Rt,f[4]=W*xt+k*mt+j*Bt,f[5]=W*gt+k*Gt+j*qt,f[6]=W*yt+k*Et+j*bt,f[7]=W*Dt+k*Ut+j*Rt,f[8]=at*xt+ft*mt+pt*Bt,f[9]=at*gt+ft*Gt+pt*qt,f[10]=at*yt+ft*Et+pt*bt,f[11]=at*Dt+ft*Ut+pt*Rt,t!==f&&(f[12]=t[12],f[13]=t[13],f[14]=t[14],f[15]=t[15]),f}let o=A;function i(t,c){let n=c??new u(16);return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function l(t,c,n){let e=n??new u(16),f=c[0],M=c[1],m=c[2];return e[0]=f*t[0*4+0],e[1]=f*t[0*4+1],e[2]=f*t[0*4+2],e[3]=f*t[0*4+3],e[4]=M*t[1*4+0],e[5]=M*t[1*4+1],e[6]=M*t[1*4+2],e[7]=M*t[1*4+3],e[8]=m*t[2*4+0],e[9]=m*t[2*4+1],e[10]=m*t[2*4+2],e[11]=m*t[2*4+3],t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}function w(t,c){let n=c??new u(16);return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function G(t,c,n){let e=n??new u(16);return e[0]=c*t[0*4+0],e[1]=c*t[0*4+1],e[2]=c*t[0*4+2],e[3]=c*t[0*4+3],e[4]=c*t[1*4+0],e[5]=c*t[1*4+1],e[6]=c*t[1*4+2],e[7]=c*t[1*4+3],e[8]=c*t[2*4+0],e[9]=c*t[2*4+1],e[10]=c*t[2*4+2],e[11]=c*t[2*4+3],t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}return{create:E,set:U,fromMat3:z,fromQuat:F,negate:C,copy:J,clone:tt,equalsApproximately:ot,equals:it,identity:nt,transpose:St,inverse:rt,determinant:At,invert:wt,multiply:Mt,mul:zt,setTranslation:et,getTranslation:st,getAxis:lt,setAxis:ht,getScaling:Pt,perspective:ut,perspectiveReverseZ:Tt,ortho:Lt,frustum:dt,frustumReverseZ:Nt,aim:h,cameraAim:P,lookAt:g,translation:S,translate:q,rotationX:B,rotateX:V,rotationY:I,rotateY:X,rotationZ:R,rotateZ:N,axisRotation:H,rotation:x,axisRotate:A,rotate:o,scaling:i,scale:l,uniformScaling:w,uniformScale:G}}var gn=new Map;function Rn(u){let a=gn.get(u);return a||(a=bn(u),gn.set(u,a)),a}function Nn(u){let a=Ct(u);function E(x,A,o,i){let l=new u(4);return x!==void 0&&(l[0]=x,A!==void 0&&(l[1]=A,o!==void 0&&(l[2]=o,i!==void 0&&(l[3]=i)))),l}let U=E;function z(x,A,o,i,l){let w=l??new u(4);return w[0]=x,w[1]=A,w[2]=o,w[3]=i,w}function F(x,A,o){let i=o??new u(4),l=A*.5,w=Math.sin(l);return i[0]=w*x[0],i[1]=w*x[1],i[2]=w*x[2],i[3]=Math.cos(l),i}function C(x,A){let o=A??a.create(3),i=Math.acos(x[3])*2,l=Math.sin(i*.5);return l>_?(o[0]=x[0]/l,o[1]=x[1]/l,o[2]=x[2]/l):(o[0]=1,o[1]=0,o[2]=0),{angle:i,axis:o}}function J(x,A){let o=dt(x,A);return Math.acos(2*o*o-1)}function tt(x,A,o){let i=o??new u(4),l=x[0],w=x[1],G=x[2],t=x[3],c=A[0],n=A[1],e=A[2],f=A[3];return i[0]=l*f+t*c+w*e-G*n,i[1]=w*f+t*n+G*c-l*e,i[2]=G*f+t*e+l*n-w*c,i[3]=t*f-l*c-w*n-G*e,i}let ot=tt;function it(x,A,o){let i=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return i[0]=w*e+c*n,i[1]=G*e+t*n,i[2]=t*e-G*n,i[3]=c*e-w*n,i}function nt(x,A,o){let i=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return i[0]=w*e-t*n,i[1]=G*e+c*n,i[2]=t*e+w*n,i[3]=c*e-G*n,i}function St(x,A,o){let i=o??new u(4),l=A*.5,w=x[0],G=x[1],t=x[2],c=x[3],n=Math.sin(l),e=Math.cos(l);return i[0]=w*e+G*n,i[1]=G*e-w*n,i[2]=t*e+c*n,i[3]=c*e-t*n,i}function rt(x,A,o,i){let l=i??new u(4),w=x[0],G=x[1],t=x[2],c=x[3],n=A[0],e=A[1],f=A[2],M=A[3],m=w*n+G*e+t*f+c*M;m<0&&(m=-m,n=-n,e=-e,f=-f,M=-M);let s,r;if(1-m>_){let d=Math.acos(m),p=Math.sin(d);s=Math.sin((1-o)*d)/p,r=Math.sin(o*d)/p}else s=1-o,r=o;return l[0]=s*w+r*n,l[1]=s*G+r*e,l[2]=s*t+r*f,l[3]=s*c+r*M,l}function At(x,A){let o=A??new u(4),i=x[0],l=x[1],w=x[2],G=x[3],t=i*i+l*l+w*w+G*G,c=t?1/t:0;return o[0]=-i*c,o[1]=-l*c,o[2]=-w*c,o[3]=G*c,o}function wt(x,A){let o=A??new u(4);return o[0]=-x[0],o[1]=-x[1],o[2]=-x[2],o[3]=x[3],o}function Mt(x,A){let o=A??new u(4),i=x[0]+x[5]+x[10];if(i>0){let l=Math.sqrt(i+1);o[3]=.5*l;let w=.5/l;o[0]=(x[6]-x[9])*w,o[1]=(x[8]-x[2])*w,o[2]=(x[1]-x[4])*w}else{let l=0;x[5]>x[0]&&(l=1),x[10]>x[l*4+l]&&(l=2);let w=(l+1)%3,G=(l+2)%3,t=Math.sqrt(x[l*4+l]-x[w*4+w]-x[G*4+G]+1);o[l]=.5*t;let c=.5/t;o[3]=(x[w*4+G]-x[G*4+w])*c,o[w]=(x[w*4+l]+x[l*4+w])*c,o[G]=(x[G*4+l]+x[l*4+G])*c}return o}function zt(x,A,o,i,l){let w=l??new u(4),G=x*.5,t=A*.5,c=o*.5,n=Math.sin(G),e=Math.cos(G),f=Math.sin(t),M=Math.cos(t),m=Math.sin(c),s=Math.cos(c);switch(i){case"xyz":w[0]=n*M*s+e*f*m,w[1]=e*f*s-n*M*m,w[2]=e*M*m+n*f*s,w[3]=e*M*s-n*f*m;break;case"xzy":w[0]=n*M*s-e*f*m,w[1]=e*f*s-n*M*m,w[2]=e*M*m+n*f*s,w[3]=e*M*s+n*f*m;break;case"yxz":w[0]=n*M*s+e*f*m,w[1]=e*f*s-n*M*m,w[2]=e*M*m-n*f*s,w[3]=e*M*s+n*f*m;break;case"yzx":w[0]=n*M*s+e*f*m,w[1]=e*f*s+n*M*m,w[2]=e*M*m-n*f*s,w[3]=e*M*s-n*f*m;break;case"zxy":w[0]=n*M*s-e*f*m,w[1]=e*f*s+n*M*m,w[2]=e*M*m+n*f*s,w[3]=e*M*s-n*f*m;break;case"zyx":w[0]=n*M*s-e*f*m,w[1]=e*f*s+n*M*m,w[2]=e*M*m-n*f*s,w[3]=e*M*s+n*f*m;break;default:throw new Error(`Unknown rotation order: ${i}`)}return w}function et(x,A){let o=A??new u(4);return o[0]=x[0],o[1]=x[1],o[2]=x[2],o[3]=x[3],o}let st=et;function lt(x,A,o){let i=o??new u(4);return i[0]=x[0]+A[0],i[1]=x[1]+A[1],i[2]=x[2]+A[2],i[3]=x[3]+A[3],i}function ht(x,A,o){let i=o??new u(4);return i[0]=x[0]-A[0],i[1]=x[1]-A[1],i[2]=x[2]-A[2],i[3]=x[3]-A[3],i}let Pt=ht;function ut(x,A,o){let i=o??new u(4);return i[0]=x[0]*A,i[1]=x[1]*A,i[2]=x[2]*A,i[3]=x[3]*A,i}let Tt=ut;function Lt(x,A,o){let i=o??new u(4);return i[0]=x[0]/A,i[1]=x[1]/A,i[2]=x[2]/A,i[3]=x[3]/A,i}function dt(x,A){return x[0]*A[0]+x[1]*A[1]+x[2]*A[2]+x[3]*A[3]}function Nt(x,A,o,i){let l=i??new u(4);return l[0]=x[0]+o*(A[0]-x[0]),l[1]=x[1]+o*(A[1]-x[1]),l[2]=x[2]+o*(A[2]-x[2]),l[3]=x[3]+o*(A[3]-x[3]),l}function Y(x){let A=x[0],o=x[1],i=x[2],l=x[3];return Math.sqrt(A*A+o*o+i*i+l*l)}let Q=Y;function $(x){let A=x[0],o=x[1],i=x[2],l=x[3];return A*A+o*o+i*i+l*l}let h=$;function P(x,A){let o=A??new u(4),i=x[0],l=x[1],w=x[2],G=x[3],t=Math.sqrt(i*i+l*l+w*w+G*G);return t>1e-5?(o[0]=i/t,o[1]=l/t,o[2]=w/t,o[3]=G/t):(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function g(x,A){return Math.abs(x[0]-A[0])<_&&Math.abs(x[1]-A[1])<_&&Math.abs(x[2]-A[2])<_&&Math.abs(x[3]-A[3])<_}function S(x,A){return x[0]===A[0]&&x[1]===A[1]&&x[2]===A[2]&&x[3]===A[3]}function q(x){let A=x??new u(4);return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A}let B=a.create(),V=a.create(),I=a.create();function X(x,A,o){let i=o??new u(4),l=a.dot(x,A);return l<-.999999?(a.cross(V,x,B),a.len(B)<1e-6&&a.cross(I,x,B),a.normalize(B,B),F(B,Math.PI,i),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(a.cross(x,A,B),i[0]=B[0],i[1]=B[1],i[2]=B[2],i[3]=1+l,P(i,i))}let R=new u(4),N=new u(4);function H(x,A,o,i,l,w){let G=w??new u(4);return rt(x,i,l,R),rt(A,o,l,N),rt(R,N,2*l*(1-l),G),G}return{create:E,fromValues:U,set:z,fromAxisAngle:F,toAxisAngle:C,angle:J,multiply:tt,mul:ot,rotateX:it,rotateY:nt,rotateZ:St,slerp:rt,inverse:At,conjugate:wt,fromMat:Mt,fromEuler:zt,copy:et,clone:st,add:lt,subtract:ht,sub:Pt,mulScalar:ut,scale:Tt,divScalar:Lt,dot:dt,lerp:Nt,length:Y,len:Q,lengthSq:$,lenSq:h,normalize:P,equalsApproximately:g,equals:S,identity:q,rotationTo:X,sqlerp:H}}var yn=new Map;function On(u){let a=yn.get(u);return a||(a=Nn(u),yn.set(u,a)),a}function Fn(u){function a(o,i,l,w){let G=new u(4);return o!==void 0&&(G[0]=o,i!==void 0&&(G[1]=i,l!==void 0&&(G[2]=l,w!==void 0&&(G[3]=w)))),G}let E=a;function U(o,i,l,w,G){let t=G??new u(4);return t[0]=o,t[1]=i,t[2]=l,t[3]=w,t}function z(o,i){let l=i??new u(4);return l[0]=Math.ceil(o[0]),l[1]=Math.ceil(o[1]),l[2]=Math.ceil(o[2]),l[3]=Math.ceil(o[3]),l}function F(o,i){let l=i??new u(4);return l[0]=Math.floor(o[0]),l[1]=Math.floor(o[1]),l[2]=Math.floor(o[2]),l[3]=Math.floor(o[3]),l}function C(o,i){let l=i??new u(4);return l[0]=Math.round(o[0]),l[1]=Math.round(o[1]),l[2]=Math.round(o[2]),l[3]=Math.round(o[3]),l}function J(o,i=0,l=1,w){let G=w??new u(4);return G[0]=Math.min(l,Math.max(i,o[0])),G[1]=Math.min(l,Math.max(i,o[1])),G[2]=Math.min(l,Math.max(i,o[2])),G[3]=Math.min(l,Math.max(i,o[3])),G}function tt(o,i,l){let w=l??new u(4);return w[0]=o[0]+i[0],w[1]=o[1]+i[1],w[2]=o[2]+i[2],w[3]=o[3]+i[3],w}function ot(o,i,l,w){let G=w??new u(4);return G[0]=o[0]+i[0]*l,G[1]=o[1]+i[1]*l,G[2]=o[2]+i[2]*l,G[3]=o[3]+i[3]*l,G}function it(o,i,l){let w=l??new u(4);return w[0]=o[0]-i[0],w[1]=o[1]-i[1],w[2]=o[2]-i[2],w[3]=o[3]-i[3],w}let nt=it;function St(o,i){return Math.abs(o[0]-i[0])<_&&Math.abs(o[1]-i[1])<_&&Math.abs(o[2]-i[2])<_&&Math.abs(o[3]-i[3])<_}function rt(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]}function At(o,i,l,w){let G=w??new u(4);return G[0]=o[0]+l*(i[0]-o[0]),G[1]=o[1]+l*(i[1]-o[1]),G[2]=o[2]+l*(i[2]-o[2]),G[3]=o[3]+l*(i[3]-o[3]),G}function wt(o,i,l,w){let G=w??new u(4);return G[0]=o[0]+l[0]*(i[0]-o[0]),G[1]=o[1]+l[1]*(i[1]-o[1]),G[2]=o[2]+l[2]*(i[2]-o[2]),G[3]=o[3]+l[3]*(i[3]-o[3]),G}function Mt(o,i,l){let w=l??new u(4);return w[0]=Math.max(o[0],i[0]),w[1]=Math.max(o[1],i[1]),w[2]=Math.max(o[2],i[2]),w[3]=Math.max(o[3],i[3]),w}function zt(o,i,l){let w=l??new u(4);return w[0]=Math.min(o[0],i[0]),w[1]=Math.min(o[1],i[1]),w[2]=Math.min(o[2],i[2]),w[3]=Math.min(o[3],i[3]),w}function et(o,i,l){let w=l??new u(4);return w[0]=o[0]*i,w[1]=o[1]*i,w[2]=o[2]*i,w[3]=o[3]*i,w}let st=et;function lt(o,i,l){let w=l??new u(4);return w[0]=o[0]/i,w[1]=o[1]/i,w[2]=o[2]/i,w[3]=o[3]/i,w}function ht(o,i){let l=i??new u(4);return l[0]=1/o[0],l[1]=1/o[1],l[2]=1/o[2],l[3]=1/o[3],l}let Pt=ht;function ut(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]}function Tt(o){let i=o[0],l=o[1],w=o[2],G=o[3];return Math.sqrt(i*i+l*l+w*w+G*G)}let Lt=Tt;function dt(o){let i=o[0],l=o[1],w=o[2],G=o[3];return i*i+l*l+w*w+G*G}let Nt=dt;function Y(o,i){let l=o[0]-i[0],w=o[1]-i[1],G=o[2]-i[2],t=o[3]-i[3];return Math.sqrt(l*l+w*w+G*G+t*t)}let Q=Y;function $(o,i){let l=o[0]-i[0],w=o[1]-i[1],G=o[2]-i[2],t=o[3]-i[3];return l*l+w*w+G*G+t*t}let h=$;function P(o,i){let l=i??new u(4),w=o[0],G=o[1],t=o[2],c=o[3],n=Math.sqrt(w*w+G*G+t*t+c*c);return n>1e-5?(l[0]=w/n,l[1]=G/n,l[2]=t/n,l[3]=c/n):(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function g(o,i){let l=i??new u(4);return l[0]=-o[0],l[1]=-o[1],l[2]=-o[2],l[3]=-o[3],l}function S(o,i){let l=i??new u(4);return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l}let q=S;function B(o,i,l){let w=l??new u(4);return w[0]=o[0]*i[0],w[1]=o[1]*i[1],w[2]=o[2]*i[2],w[3]=o[3]*i[3],w}let V=B;function I(o,i,l){let w=l??new u(4);return w[0]=o[0]/i[0],w[1]=o[1]/i[1],w[2]=o[2]/i[2],w[3]=o[3]/i[3],w}let X=I;function R(o){let i=o??new u(4);return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i}function N(o,i,l){let w=l??new u(4),G=o[0],t=o[1],c=o[2],n=o[3];return w[0]=i[0]*G+i[4]*t+i[8]*c+i[12]*n,w[1]=i[1]*G+i[5]*t+i[9]*c+i[13]*n,w[2]=i[2]*G+i[6]*t+i[10]*c+i[14]*n,w[3]=i[3]*G+i[7]*t+i[11]*c+i[15]*n,w}function H(o,i,l){let w=l??new u(4);return P(o,w),et(w,i,w)}function x(o,i,l){let w=l??new u(4);return Tt(o)>i?H(o,i,w):S(o,w)}function A(o,i,l){let w=l??new u(4);return At(o,i,.5,w)}return{create:a,fromValues:E,set:U,ceil:z,floor:F,round:C,clamp:J,add:tt,addScaled:ot,subtract:it,sub:nt,equalsApproximately:St,equals:rt,lerp:At,lerpV:wt,max:Mt,min:zt,mulScalar:et,scale:st,divScalar:lt,inverse:ht,invert:Pt,dot:ut,length:Tt,len:Lt,lengthSq:dt,lenSq:Nt,distance:Y,dist:Q,distanceSq:$,distSq:h,normalize:P,negate:g,copy:S,clone:q,multiply:B,mul:V,divide:I,div:X,zero:R,transformMat4:N,setLength:H,truncate:x,midpoint:A}}var Dn=new Map;function Vn(u){let a=Dn.get(u);return a||(a=Fn(u),Dn.set(u,a)),a}function tn(u,a,E,U,z,F){return{mat4:Rn(u),mat3:Ln(a),quat:On(E),vec2:mn(U),vec3:Ct(z),vec4:Vn(F)}}var{mat4:nn,mat3:Hn,quat:Zn,vec2:vn,vec3:ct,vec4:Qn}=tn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array),{mat4:Jn,mat3:Kn,quat:jn,vec2:Cn,vec3:te,vec4:ne}=tn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),{mat4:ee,mat3:se,quat:ce,vec2:oe,vec3:ie,vec4:re}=tn(Bn,Array,Array,Array,Array,Array);function Sn(u){return u===" "||u==="\r"}var _t=class u{file="";contents="";end=0;line=1;static async load(a){let E=new u;E.file=a,E.contents=await fetch(a).then(z=>z.text());let U={vertices:[],normals:[],texcoords:[],faces:[]};for(;!E.atEnd();)E.scanNext(U);return U}atEnd(){return this.end===this.contents.length}next(){this.atEnd()||this.end++}peek(){return this.contents[this.end]}expect(a){if(this.atEnd())throw`expected '${a}' on line ${this.line}`;let E=this.contents[this.end];if(E!==a)throw`expected '${a}' on line ${this.line} got '${E}'`;this.next()}skipWhitespace(){for(;!this.atEnd()&&Sn(this.peek());)this.next()}seekToEndOfLine(){for(;!this.atEnd()&&this.peek()!==`
`;)this.next();this.next(),this.line++}scanToken(){let a=this.end;for(;!this.atEnd();){let E=this.peek();if(Sn(E)||E===`
`)break;this.next()}return this.contents.substring(a,this.end)}scanNumber(){this.skipWhitespace();let a=this.end;for(;!this.atEnd();){let U=this.peek();if(!(U==="-"||U==="."||U>="0"&&U<="9"||U==="E"||U==="e"))break;this.next()}let E=this.contents.substring(a,this.end);return Number.parseFloat(E)}scanVertex(a){a.vertices.push(this.scanNumber()),a.vertices.push(this.scanNumber()),a.vertices.push(this.scanNumber())}scanVertexNormal(a){a.normals.push(this.scanNumber()),a.normals.push(this.scanNumber()),a.normals.push(this.scanNumber())}scanVertexTexture(a){a.texcoords.push(this.scanNumber()),a.texcoords.push(this.scanNumber())}scanTriple(a){a.faces.push(this.scanNumber()),this.expect("/"),a.faces.push(this.scanNumber()),this.expect("/"),a.faces.push(this.scanNumber())}scanFace(a){if(this.scanTriple(a),this.scanTriple(a),this.scanTriple(a),this.peek()==="\r"&&this.next(),this.peek()!==`
`){let E=a.faces.length-9;a.faces.push(a.faces[E+0]),a.faces.push(a.faces[E+1]),a.faces.push(a.faces[E+2]),a.faces.push(a.faces[E+6]),a.faces.push(a.faces[E+7]),a.faces.push(a.faces[E+8]),this.scanTriple(a)}}scanNext(a){if(this.atEnd())return;this.skipWhitespace();let E=this.scanToken();if(this.next(),E===""){this.line++;return}switch(E){case"#":break;case"v":this.scanVertex(a);break;case"vn":this.scanVertexNormal(a);break;case"vt":this.scanVertexTexture(a);break;case"f":this.scanFace(a);break;case"g":break;case"o":break;case"s":break;case"usemtl":break;case"mtllib":break;default:throw E.length===1?`unknown token '${E}' (${E.charCodeAt(0)}) on line ${this.line} in ${this.file}`:`unknown token '${E}' on line ${this.line} in ${this.file}`}this.seekToEndOfLine()}};var An=`struct VertexOut {
  @builtin(position) position: vec4f,
  @location(0) texcoord: vec2f,
}

@vertex fn vp(@builtin(vertex_index) i: u32) -> VertexOut {
  var out: VertexOut;

  let uv = vec2f(vec2(i & 2, (i << 1) & 2));
  let pos = vec4f(uv * vec2f(2, -2) + vec2f(-1, 1), 0, 1);

  out.position = pos.xyww;
  out.texcoord = uv;
  return out;
}

@fragment fn fp(in: VertexOut) -> @location(0) vec4f {
  let top = vec4f(0.7, 0.8, 0.9, 1.0);
  let bot = vec4f(0.5, 0.7, 0.9, 1.0);
  return mix(top, bot, in.texcoord.y);
}
`;var Pn=`override SHELL_COUNT: f32 = 32.0;

struct VertexIn {
  @builtin(instance_index) instance: u32,
  @location(0) position: vec3f,
  @location(1) normal: vec3f,
  @location(2) texcoord: vec2f,
}

struct VertexOut {
  @builtin(position) position: vec4f,
  @location(0) normal: vec3f,
  @location(1) texcoord: vec2f,
  @location(2) @interpolate(flat) instance: u32,
}

@group(0) @binding(0) var<uniform> u: Uniforms;

fn random(uv: vec2f) -> f32 {
  return fract(sin(dot(uv, vec2(12.9898, 78.233))) * 43758.5453123);
}

fn steepCos(angle: f32, slope: f32) -> f32 {
  return atan(slope * cos(angle)) / atan(slope);
}

@vertex fn vp(in: VertexIn) -> VertexOut {
  var out: VertexOut;

  let scale = 1.0 + f32(in.instance) * 0.002;
  let height = f32(in.instance) / SHELL_COUNT;
  let position = in.position * scale + vec3f(0.0, -height * 0.04, 0.0);

  out.position = u.cameraProjection * u.cameraView * vec4f(position, 1.0);
  out.normal = in.normal;
  out.texcoord = in.texcoord;
  out.instance = in.instance;
  return out;
}

@fragment fn fp(in: VertexOut) -> @location(0) vec4f {
  let uv = in.texcoord * 256.0;

  let height = f32(in.instance) / SHELL_COUNT;

  let cell = floor(uv);
  let local = (uv - cell) * 2.0 - 1.0;
  if ((random(cell) - height) * 2.0 < length(local) * height) {
    discard;
  }

  let light = normalize(vec3f(1.0, 1.0, 0.0));

  let ambient = 0.4;
  let diffuse = dot(light, in.normal) * 0.5 + 0.5;
  let lighting = vec3f((ambient + diffuse) * height);

  let stripe = steepCos(in.texcoord.y * 14.0, 2.0) * 0.5 + 0.5;
  let color = mix(vec3f(0.25, 0.15, 0.0), vec3f(1.0, 0.7, 0.0), stripe);

  return vec4f(color * lighting, 1 - height);
}
`;var Gn=`struct VertexOut {
  @builtin(position) position: vec4f,
  @location(0) m: vec2f,
  @location(1) nw: vec2f,
  @location(2) ne: vec2f,
  @location(3) sw: vec2f,
  @location(4) se: vec2f,
}

@group(0) @binding(0) var<uniform> u: Uniforms;
@group(0) @binding(1) var surface: texture_2d<f32>;
@group(0) @binding(2) var surfaceSampler: sampler;

@vertex fn vp(@builtin(vertex_index) i: u32) -> VertexOut {
  var out: VertexOut;

  let uv = vec2f(vec2(i & 2, (i << 1) & 2));
  out.position = vec4f(uv * vec2f(2, -2) + vec2f(-1, 1), 0, 1);

  let texel = uv * u.screenResolution;
  out.nw = (texel + vec2f(-1, -1)) / u.screenResolution;
  out.ne = (texel + vec2f(1, -1)) / u.screenResolution;
  out.sw = (texel + vec2f(-1, 1)) / u.screenResolution;
  out.se = (texel + vec2f(1, 1)) / u.screenResolution;
  out.m = uv;

  return out;
}

@fragment fn fp(in: VertexOut) -> @location(0) vec4f {
  let FXAA_REDUCE_MIN = 1.0 / 128.0;
  let FXAA_REDUCE_MUL = 1.0 / 8.0;
  let FXAA_SPAN_MAX = 8.0;

  let luma = vec3f(0.299, 0.587, 0.114);

  let lumaNW = dot(textureSample(surface, surfaceSampler, in.nw).xyz, luma);
  let lumaNE = dot(textureSample(surface, surfaceSampler, in.ne).xyz, luma);
  let lumaSW = dot(textureSample(surface, surfaceSampler, in.sw).xyz, luma);
  let lumaSE = dot(textureSample(surface, surfaceSampler, in.se).xyz, luma);
  let lumaM = dot(textureSample(surface, surfaceSampler, in.m).xyz, luma);

  var dir: vec2f;
  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
  dir.y = (lumaNW + lumaSW) - (lumaNE + lumaSE);

  let reduce = max(FXAA_REDUCE_MIN, (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL));

  var rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + reduce);
  dir = max(vec2f(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin);
  dir = min(vec2f(FXAA_SPAN_MAX, FXAA_SPAN_MAX), dir);
  dir /= u.screenResolution;

  let lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
  let lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

  var rgbA = textureSample(surface, surfaceSampler, in.m + dir * (1.0 / 3.0 - 0.5)).xyz;
  rgbA += textureSample(surface, surfaceSampler, in.m + dir * (2.0 / 3.0 - 0.5)).xyz;
  rgbA *= 0.5;

  var rgbB = textureSample(surface, surfaceSampler, in.m + dir * -0.5).xyz;
  rgbB += textureSample(surface, surfaceSampler, in.m + dir * 0.5).xyz;
  rgbB = rgbA * 0.5 + 0.25 * rgbB;

  var lumaB = dot(rgbB, luma);
  if (lumaB < lumaMin || lumaB > lumaMax) {
    return vec4f(rgbA, 1.0);
  } else {
    return vec4f(rgbB, 1.0);
  }
}
`;var Jt=Math.PI/180,$n=2,It=4,Xn=4*It,En=16*It,K,Vt,Qt,Ft,jt,Kt,Ot={},Z={x:0,y:0,prevX:0,prevY:0,deltaX:0,deltaY:0,button0:!1,button1:!1,button2:!1,wheel:0};addEventListener("keydown",u=>{Ot[u.code]=!0});addEventListener("keyup",u=>{Ot[u.code]=!1});addEventListener("mousedown",u=>{u.button===0?Z.button0=!0:u.button===1?Z.button1=!0:u.button===2&&(Z.button2=!0)});addEventListener("mouseup",u=>{u.button===0?Z.button0=!1:u.button===1?Z.button1=!1:u.button===2&&(Z.button2=!1)});addEventListener("wheel",u=>{Z.wheel=u.deltaY});addEventListener("mousemove",u=>{Z.x=u.clientX,Z.y=u.clientY});function kn(u,a,E){return u<a?a:u>E?E:u}var en=class{yaw;pitch=0;front=ct.create();right=ct.create();up=ct.create();positionA;positionB;constructor(a,E){this.positionA=ct.clone(a),this.positionB=ct.clone(a),this.yaw=E}update(){Z.button0&&(this.yaw+=Z.deltaX*.005,this.pitch-=Z.deltaY*.005,this.pitch=kn(this.pitch,-85*Jt,85*Jt)),this.front[0]=Math.cos(this.yaw)*Math.cos(this.pitch),this.front[1]=Math.sin(this.pitch),this.front[2]=Math.sin(this.yaw)*Math.cos(this.pitch),ct.normalize(this.front,this.front),ct.normalize(ct.cross(this.front,ct.create(0,1,0)),this.right),ct.normalize(ct.cross(this.right,this.front),this.up);let a=0,E=0,U=0,z;Ot.ShiftLeft?z=.1:z=.03,Ot.KeyW&&(a-=z),Ot.KeyS&&(a+=z),Ot.KeyA&&(E+=z),Ot.KeyD&&(E-=z),Ot.KeyQ&&(U+=z),(Ot.KeyE||Ot.Space)&&(U-=z),ct.add(this.positionB,ct.mulScalar(this.front,-a),this.positionB),ct.add(this.positionB,ct.mulScalar(ct.normalize(ct.cross(this.front,this.up)),-E),this.positionB),this.positionB[1]-=U,ct.lerp(this.positionA,this.positionB,.2,this.positionA)}view(a){return nn.lookAt(this.positionA,ct.add(this.positionA,this.front),this.up,a)}},sn=class u{vbuf;ibuf;indexCount;constructor(a){let E=new Map,U=[],z=[];for(let F=0;F<a.faces.length;F+=3){let C=a.faces[F+0],J=a.faces[F+1],tt=a.faces[F+2],ot=(BigInt(tt)<<32n|BigInt(J)<<16n|BigInt(C)).toString(),it=E.get(ot);if(it!==void 0)z.push(it);else{console.assert(U.length%8===0);let nt=U.length/8;E.set(ot,nt),z.push(nt),U.push(a.vertices[(C-1)*3+0]),U.push(a.vertices[(C-1)*3+1]),U.push(a.vertices[(C-1)*3+2]),U.push(a.normals[(tt-1)*3+0]),U.push(a.normals[(tt-1)*3+1]),U.push(a.normals[(tt-1)*3+2]),U.push(a.texcoords[(J-1)*2+0]),U.push(a.texcoords[(J-1)*2+1])}}if(this.vbuf=K.createBuffer({size:U.length*It,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),K.queue.writeBuffer(this.vbuf,0,new Float32Array(U),0,U.length),z.length%4!==0)for(console.warn("model indices aren't a multiple of 4");z.length%4!==0;)z.push(0);this.ibuf=K.createBuffer({size:z.length*$n,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),K.queue.writeBuffer(this.ibuf,0,new Uint16Array(z),0,z.length),this.indexCount=z.length}static async load(a){let E=await _t.load(a);return new u(E)}draw(a,E){a.setVertexBuffer(0,this.vbuf),a.setIndexBuffer(this.ibuf,"uint16"),a.drawIndexed(this.indexCount,E)}},cn=class u{constructor(a){this.canvas=a;this.context2D=a.getContext("2d")}beginTime=0;prevTime=0;textY=0;canvasWidth=0;context2D;static FONT_SIZE=13;beginFrame(a){this.prevTime=this.beginTime,this.beginTime=a}endFrame(){let a=Math.round(this.canvasWidth)+8,E=this.textY+8;(a!==this.canvas.width||E!==this.canvas.height)&&(this.canvas.width=a,this.canvas.height=E),this.canvasWidth=100,this.textY=0,this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2D.globalAlpha=.5,this.context2D.fillStyle="white",this.context2D.fillRect(0,0,this.canvas.width,this.canvas.height),this.context2D.globalAlpha=1,this.context2D.fillStyle="black",this.context2D.font=`bold ${u.FONT_SIZE}px monospace`;let U=this.beginTime-this.prevTime,z=1/U*1e3;this.draw(`ms/frame: ${U.toFixed(2)}ms (${Math.round(z)}fps)`);let F=performance.now()-this.beginTime,C=1/F*1e3;if(this.draw(`cpu: ${F.toFixed(2)}ms (${Math.round(C)}fps)`),Ft!==void 0){let ot=Ft.avg/1e3/1e3,it=1/ot*1e3;this.draw(`gpu: ${ot.toFixed(2)}ms (${Math.round(it)}fps)`)}let J=0,{memory:tt}=performance;tt!==void 0&&(J=tt.usedJSHeapSize/1024/1024),J!==0&&this.draw(`mem: ${J.toFixed(2)}mb`)}draw(a){this.textY+=u.FONT_SIZE,this.context2D.fillText(a,5,this.textY),this.canvasWidth=Math.max(this.canvasWidth,this.context2D.measureText(a).width+5)}},on=class u{index=0;querySet;resolve;result;avg=0;static MAX_QUERIES=64;constructor(){this.querySet=K.createQuerySet({type:"timestamp",count:2*u.MAX_QUERIES}),this.resolve=K.createBuffer({size:this.querySet.count*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.result=K.createBuffer({size:this.querySet.count*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}record(){console.assert(this.index<u.MAX_QUERIES);let a={querySet:this.querySet,beginningOfPassWriteIndex:this.index,endOfPassWriteIndex:this.index+1};return this.index+=2,a}endFrame(a){this.result.mapState==="unmapped"&&(a.resolveQuerySet(this.querySet,0,this.querySet.count,this.resolve,0),a.copyBufferToBuffer(this.resolve,0,this.result,0,this.result.size))}async measure(){if(this.result.mapState!=="unmapped")return;await this.result.mapAsync(GPUMapMode.READ);let a=0,E=new BigInt64Array(this.result.getMappedRange());for(let z=0;z<this.index;z+=2){let F=E[z+0],C=E[z+1];a+=Number(C-F)}this.result.unmap();let U=this.index/2;this.index=0,U>0&&(this.avg=a/U)}},rn=class u{bindGroupLayouts=new Map;bindGroups=[];samplers=[];step(){let a=0;for(;a<this.bindGroups.length;)this.bindGroups[a].lifetime--,this.bindGroups[a].lifetime===0?(this.bindGroups[a]=this.bindGroups[this.bindGroups.length-1],this.bindGroups.pop()):a++}getBindGroupLayout(a,E){let U=this.bindGroupLayouts.get(a);if(U===void 0){let F=a.getBindGroupLayout(E);return this.bindGroupLayouts.set(a,[F]),F}let z=U[E];if(z===void 0){let F=a.getBindGroupLayout(E);return U[E]=F,F}return z}createBindGroup(a){for(let z of this.bindGroups)if(u.sameBindGroup(z.descriptor,a))return z.resource;let U=K.createBindGroup(a);return this.bindGroups.push({resource:U,descriptor:a,lifetime:4}),U}static sameBindGroup(a,E){console.assert(a.layout===E.layout);let U=a.entries,z=E.entries;if(U.length!==z.length)return!1;for(let F=0;F<U.length;F++)if(!u.sameBindGroupEntry(U[F],z[F]))return!1;return!0}static sameBindGroupEntry(a,E){if(a.binding!==E.binding)return!1;if(a.resource!==E.resource){if(!a.resource.hasOwnProperty("buffer")||!E.resource.hasOwnProperty("buffer"))return!1;let U=a.resource,z=E.resource;if(U.buffer!==z.buffer||U.offset!==z.offset||U.size!==z.size)return!1}return!0}createSampler(a){for(let U of this.samplers)if(u.sameSampler(U.descriptor,a))return U.resource;let E=K.createSampler(a);return this.samplers.push({resource:E,descriptor:a}),E}static sameSampler(a,E){return a.addressModeU===E.addressModeU&&a.addressModeV===E.addressModeV&&a.addressModeW===E.addressModeW&&a.magFilter===E.magFilter&&a.minFilter===E.minFilter&&a.mipmapFilter===E.mipmapFilter&&a.lodMinClamp===E.lodMinClamp&&a.lodMaxClamp===E.lodMaxClamp&&a.compare===E.compare&&a.maxAnisotropy===E.maxAnisotropy}},un=class{pipeline;constructor(){let a=K.createShaderModule({code:jt+An});this.pipeline=K.createRenderPipeline({layout:"auto",primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{format:"depth24plus",depthCompare:"less-equal",depthWriteEnabled:!0},vertex:{module:a,entryPoint:"vp"},fragment:{module:a,entryPoint:"fp",targets:[{format:Vt}]}})}run(a){a.setPipeline(this.pipeline),a.draw(3)}},an=class u{pipeline;bindGroup;static SHELL_COUNT=64;constructor(){let a=K.createShaderModule({code:jt+Pn});this.pipeline=K.createRenderPipeline({layout:"auto",primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthCompare:"less",depthWriteEnabled:!0},vertex:{entryPoint:"vp",module:a,buffers:[{stepMode:"vertex",arrayStride:8*It,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:0,format:"float32x3"},{shaderLocation:2,offset:0,format:"float32x2"}]}],constants:{SHELL_COUNT:u.SHELL_COUNT}},fragment:{entryPoint:"fp",module:a,targets:[{format:Vt,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}],constants:{SHELL_COUNT:u.SHELL_COUNT}}}),this.bindGroup=K.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:Kt}}]})}run(a,E){a.setPipeline(this.pipeline),a.setBindGroup(0,this.bindGroup),E?.draw(a,u.SHELL_COUNT)}},fn=class{pipeline;constructor(){let a=K.createShaderModule({code:jt+Gn});this.pipeline=K.createRenderPipeline({layout:"auto",primitive:{topology:"triangle-list",cullMode:"back"},vertex:{module:a,entryPoint:"vp"},fragment:{module:a,entryPoint:"fp",targets:[{format:Vt}]}})}run(a,E){a.setPipeline(this.pipeline),a.setBindGroup(0,Qt.createBindGroup({layout:Qt.getBindGroupLayout(this.pipeline,0),entries:[{binding:0,resource:{buffer:Kt}},{binding:1,resource:E},{binding:2,resource:Qt.createSampler({minFilter:"linear",magFilter:"linear"})}]})),a.draw(3)}};async function Yn(){let u,a,E;try{let et=await navigator.gpu.requestAdapter();if(et===null)throw"no adapter";if(u=et,K=await u.requestDevice({requiredFeatures:["timestamp-query"]}),a=document.getElementById("canvas"),E=a.getContext("webgpu"),E===null)throw"no context"}catch{alert("Your browser doesn't support WebGPU");return}Vt=navigator.gpu.getPreferredCanvasFormat(),a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",a.width=window.innerWidth*window.devicePixelRatio,a.height=window.innerHeight*window.devicePixelRatio,addEventListener("resize",()=>{a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",a.width=window.innerWidth*window.devicePixelRatio,a.height=window.innerHeight*window.devicePixelRatio}),Z.prevX=a.width/2,Z.prevY=a.height/2,Z.x=Z.prevX,Z.y=Z.prevY,E.configure({device:K,format:Vt,alphaMode:"premultiplied"});let U=new cn(document.getElementById("stats"));u.features.has("timestamp-query")&&typeof K.createQuerySet=="function"&&(Ft=new on);let z=new ArrayBuffer(En+En+Xn),F={cameraView:new Float32Array(z,0,16),cameraProjection:new Float32Array(z,16*It,16),screenResolution:new Float32Array(z,32*It,4)};jt=`
struct Uniforms {
  cameraView: mat4x4f,
  cameraProjection: mat4x4f,
  screenResolution: vec2f,
}
`,Kt=K.createBuffer({size:z.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),Qt=new rn;let C=new an,J=new un,tt=new fn,ot=new en(ct.create(0,0,3),-90*Jt),it;sn.load("data/sphere.obj").then(et=>it=et);let nt,St,rt,At,wt=0,Mt=0;function zt(et){U.beginFrame(et);let{width:st,height:lt}=a;ot.update(),Z.deltaX=Z.x-Z.prevX,Z.deltaY=Z.y-Z.prevY,Z.prevX=Z.x,Z.prevY=Z.y,Z.wheel=0,ot.view(F.cameraView),nn.perspective(60*Jt,st/lt,.1,50,F.cameraProjection),vn.set(st,lt,F.screenResolution),K.queue.writeBuffer(Kt,0,z,0,z.byteLength),wt!==st&&Mt!==lt&&(wt=st,Mt=lt,nt?.destroy(),rt?.destroy(),nt=K.createTexture({size:[st,lt,1],usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,format:Vt}),St=nt.createView(),rt=K.createTexture({size:[st,lt,1],usage:GPUTextureUsage.RENDER_ATTACHMENT,format:"depth24plus"}),At=rt.createView());let ht=K.createCommandEncoder(),Pt=E.getCurrentTexture().createView();{let ut=ht.beginRenderPass({label:"forward rendering pass",timestampWrites:Ft?.record(),colorAttachments:[{view:St,clearValue:[.7,.8,.9,1],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:At,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",depthReadOnly:!1}});J.run(ut),C.run(ut,it),ut.end()}{let ut=ht.beginRenderPass({label:"fxaa pass",timestampWrites:Ft?.record(),colorAttachments:[{view:Pt,clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]});tt.run(ut,St),ut.end()}Ft?.endFrame(ht),K.queue.submit([ht.finish()]),Ft?.measure(),U.endFrame(),requestAnimationFrame(zt)}requestAnimationFrame(zt)}Yn();})();
//# sourceMappingURL=index.js.map
